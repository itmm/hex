<!doctype html>
<html lang="de">
<head>
<meta charset="utf-8">
<title>HTML-Präsentation generieren</title>
<link rel="stylesheet" type="text/css" href="slides/slides.css"></head>
<body>
<h1>HTML-Präsentation generieren</h1>
<div class="slides">
<div><div>
<h1>HTML-Präsentation generieren</h1>
</div>
<ul><li>
Diese Datei beschreibt Code, um aus den <code><span class="var">x</span></code>-Quelldateien
  HTML-Präsentationen zu erzeugen
</li></ul>
</div>
<div><div>
<code>
<span class="macro">@Def(<span class="name">write HTML file</span>)</span><br/>
<span class="in1"></span><span class="keyword">for</span> (<span class="type">auto</span> &amp;<span class="var">cur</span> : <span class="var">inputs</span>) {<br/>
<span class="in2"></span><span class="macro">@put(<span class="name">write cur HTML file</span>)</span>;<br/>
<span class="in1"></span>}<br/>
<span class="macro">@end(<span class="name">write HTML file</span>)</span><br/>
</code></div>
<ul><li>
Alle bisher prozessierten Dateien werden erneut durchgegangen
</li><li>
Nach der Abarbeitung einer Datei wird deren Speicher freigegeben
</li></ul>
</div>
<div><div>
<code>
<span class="macro">@def(<span class="name">write cur HTML file</span>)</span><br/>
<span class="in1"></span><span class="type">const</span> <span class="type">std</span>::<span class="type">string</span> &amp;<span class="var">name</span> { <span class="var">cur</span>-&gt;<span class="var">name</span> };<br/>
<span class="in1"></span><span class="type">std</span>::<span class="type">string</span> <span class="var">outPath</span> {<br/>
<span class="in2"></span><span class="var">name</span>.<span class="fn">substr</span>(<span class="num">0</span>, <span class="var">name</span>.<span class="fn">size</span>() - <span class="num">2</span>) +<br/>
<span class="in2"></span><span class="str">".html"</span><br/>
<span class="in1"></span>};<br/>
<span class="in1"></span><span class="type">std</span>::<span class="var">ofstream</span> <span class="var">out</span> { <span class="var">outPath</span>.<span class="fn">c_str</span>() };<br/>
<span class="in1"></span><span class="macro">@put(<span class="name">write cur HTML file to out</span>)</span>;<br/>
<span class="in1"></span><span class="var">out</span>.<span class="fn">close</span>();<br/>
<span class="macro">@end(<span class="name">write cur HTML file</span>)</span><br/>
</code></div>
<ul><li>
Die HTML hat den gleichen Pfad mit der Endung <code>.<span class="var">html</span></code> anstatt <code>.<span class="var">x</span></code>
</li></ul>
</div>
<div><div>
<code>
<span class="macro">@def(<span class="name">write cur HTML file to out</span>)</span><br/>
<span class="in1"></span><span class="type">std</span>::<span class="var">ifstream</span> <span class="keyword">in</span> {<br/>
<span class="in2"></span><span class="var">cur</span>-&gt;<span class="var">name</span>.<span class="fn">c_str</span>()<br/>
<span class="in1"></span>};<br/>
<span class="in1"></span><span class="macro">@put(<span class="name">write from in to out</span>)</span>;<br/>
<span class="in1"></span><span class="keyword">in</span>.<span class="fn">close</span>();<br/>
<span class="macro">@end(<span class="name">write cur HTML file to out</span>)</span><br/>
</code></div>
<ul><li>
Zuerst wird die Eingabe-Datei zum Lesen geöffnet
</li></ul>
</div>
<div><div>
<code>
<span class="macro">@Add(<span class="name">global elements</span>)</span><br/>
<span class="in1"></span><span class="type">enum</span> <span class="keyword">class</span> <span class="type">HtmlState</span> {<br/>
<span class="in2"></span><span class="var">nothing</span>,<br/>
<span class="in2"></span><span class="var">inSlide</span>,<br/>
<span class="in2"></span><span class="var">afterSlide</span>,<br/>
<span class="in2"></span><span class="var">afterSlides</span><br/>
<span class="in2"></span><span class="macro">@put(<span class="name">html state enums</span>)</span><br/>
<span class="in1"></span>};<br/>
<span class="macro">@end(<span class="name">global elements</span>)</span><br/>
</code></div>
<ul><li>
In einem Zustands-Automaten wird abgelegt, in welchem Modus sich die
  gerade generierte HTML-Datei befindet
</li><li>
Vor dem ersten Element muss der HTML-Header geschrieben werden
</li><li>
Ansonsten wird unterschieden, ob eine Folie bereits geöffnet wurde
</li><li>
Oder ob gerade keine Folie offen ist
</li></ul>
</div>
<div><div>
<code>
<span class="macro">@Add(<span class="name">global elements</span>)</span><br/>
<span class="in1"></span><span class="type">struct</span> <span class="type">HtmlStatus</span> {<br/>
<span class="in2"></span><span class="macro">@put(<span class="name">html state elements</span>)</span><br/>
<span class="in1"></span>};<br/>
<span class="macro">@end(<span class="name">global elements</span>)</span><br/>
</code></div>
<ul><li>
Der aktuelle Status wird in <code><span class="type">HtmlStatus</span></code> abgelegt
</li></ul>
</div>
<div><div>
<code>
<span class="macro">@def(<span class="name">html state elements</span>)</span><br/>
<span class="in1"></span><span class="fn">HtmlStatus</span>();<br/>
<span class="in1"></span><span class="type">HtmlState</span> <span class="var">state</span>;<br/>
<span class="macro">@end(<span class="name">html state elements</span>)</span><br/>
</code></div>
<ul><li>
Status hat einen Konstruktor
</li><li>
Der aktuelle Zustand wird im Status abgelegt
</li></ul>
</div>
<div><div>
<code>
<span class="macro">@Add(<span class="name">global elements</span>)</span><br/>
<span class="in1"></span><span class="var">inline</span> <span class="type">HtmlStatus</span>::<span class="fn">HtmlStatus</span>():<br/>
<span class="in2"></span><span class="var">state</span> {<br/>
<span class="in3"></span><span class="type">HtmlState</span>::<span class="var">nothing</span><br/>
<span class="in2"></span>}<br/>
<span class="in1"></span>{ }<br/>
<span class="macro">@end(<span class="name">global elements</span>)</span><br/>
</code></div>
<ul><li>
Der initiale Zustand signalisiert, dass noch nichts geschrieben wurde
</li></ul>
</div>
<div><div>
<code>
<span class="macro">@Add(<span class="name">includes</span>)</span><br/>
<span class="in1"></span><span class="keyword">#include</span> &lt;<span class="type">string</span>&gt;<br/>
<span class="macro">@end(<span class="name">includes</span>)</span><br/>
</code></div>
<ul><li>
Die Anwendung verwendet <code><span class="type">std</span>::<span class="type">string</span></code> überall
</li></ul>
</div>
<div><div>
<code>
<span class="macro">@def(<span class="name">write from in to out</span>)</span><br/>
<span class="in1"></span><span class="type">HtmlStatus</span> <span class="var">status</span>;<br/>
<span class="in1"></span><span class="type">std</span>::<span class="type">string</span> <span class="var">ident</span>;<br/>
<span class="in1"></span><span class="type">std</span>::<span class="type">string</span> <span class="var">line</span>;<br/>
<span class="in1"></span><span class="keyword">while</span> (<span class="type">std</span>::<span class="fn">getline</span>(<span class="keyword">in</span>, <span class="var">line</span>)) {<br/>
<span class="in2"></span><span class="macro">@put(<span class="name">process line</span>)</span>;<br/>
<span class="in1"></span>}<br/>
<span class="macro">@end(<span class="name">write from in to out</span>)</span><br/>
</code></div>
<ul><li>
Beim Schreiben einer Datei wird zuerst der Status initialisiert
</li><li>
Die Eingabe wird Zeile für Zeile abgearbeitet
</li><li>
Bis das Datei-Ende erreicht ist
</li></ul>
</div>
<div><div>
<code>
<span class="macro">@Add(<span class="name">global elements</span>)</span><br/>
<span class="in1"></span><span class="type">bool</span> <span class="fn">in_code</span>(<br/>
<span class="in2"></span><span class="type">HtmlStatus</span> *<span class="var">s</span><br/>
<span class="in1"></span>) {<br/>
<span class="in2"></span><span class="macro">@put(<span class="name">check html special state</span>)</span>;<br/>
<span class="in2"></span><span class="keyword">return</span> <span class="num">false</span>;<br/>
<span class="in1"></span>}<br/>
<span class="macro">@end(<span class="name">global elements</span>)</span><br/>
</code></div>
<ul><li>
Die Funktion <code><span class="fn">in_code</span></code> liefert <code><span class="num">true</span></code>, wenn sich
  der Zustands-Automat gerade in einem Fragment befindet
</li></ul>
</div>
<div><div>
<code>
<span class="macro">@def(<span class="name">process line</span>)</span><br/>
<span class="in1"></span><span class="keyword">if</span> (<span class="fn">in_code</span>(&amp;<span class="var">status</span>)) {<br/>
<span class="in2"></span><span class="macro">@put(<span class="name">process code</span>)</span>;<br/>
<span class="in2"></span><span class="keyword">continue</span>;<br/>
<span class="in1"></span>}<br/>
<span class="macro">@end(<span class="name">process line</span>)</span><br/>
</code></div>
<ul><li>
Während Code bearbeitet wird, gelten viele andere Regeln nicht mehr
</li><li>
Daher wird dieser Block als erstes abgehandelt
</li></ul>
</div>
<div><div>
<code>
<span class="macro">@add(<span class="name">process line</span>)</span><br/>
<span class="in1"></span><span class="keyword">if</span> (<span class="var">line</span> == <span class="str">""</span>) {<br/>
<span class="in2"></span><span class="macro">@put(<span class="name">close specials</span>)</span>;<br/>
<span class="in2"></span><span class="keyword">switch</span> (<span class="var">status</span>.<span class="var">state</span>) {<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="type">HtmlState</span>::<span class="var">afterSlide</span>:<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="type">HtmlState</span>::<span class="var">afterSlides</span>:<br/>
<span class="in3"></span><span class="keyword">case</span> <span class="type">HtmlState</span>::<span class="var">nothing</span>:<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span><span class="keyword">default</span>:<br/>
<span class="in4"></span><span class="macro">@put(<span class="name">close slide</span>)</span>;<br/>
<span class="in2"></span>}<br/>
<span class="in2"></span><span class="keyword">continue</span>;<br/>
<span class="in1"></span>}<br/>
<span class="macro">@end(<span class="name">process line</span>)</span><br/>
</code></div>
<ul><li>
Eine leere Seite schließt eine offene Folie ab
</li></ul>
</div>
<div><div>
<code>
<span class="macro">@def(<span class="name">close slide</span>)</span><br/>
<span class="in1"></span><span class="var">out</span> &lt;&lt; <span class="str">"&lt;/div&gt;\n"</span>;<br/>
<span class="in1"></span><span class="var">status</span>.<span class="var">state</span> = <span class="type">HtmlState</span>::<span class="var">afterSlide</span>;<br/>
<span class="macro">@end(<span class="name">close slide</span>)</span><br/>
</code></div>
<ul><li>
Die Funktion schreibt das schließende <code>&lt;/<span class="var">div</span>&gt;</code>
</li><li>
Und setzt den Zustand passend
</li></ul>
</div>
</div>
<h1>Überschriften</h1>
<div class="slides">
<div><div>
<h1>Überschriften</h1>
</div>
<ul><li>
Überschriften beginnen mit Rauten <code><span class="keyword">#</span></code>
</li></ul>
</div>
<div><div>
<code>
<span class="macro">@add(<span class="name">process line</span>)</span><br/>
<span class="in1"></span><span class="keyword">if</span> (<span class="var">line</span>[<span class="num">0</span>] == <span class="str">'#'</span>) {<br/>
<span class="in2"></span><span class="macro">@put(<span class="name">process header</span>)</span>;<br/>
<span class="in2"></span><span class="var">status</span>.<span class="var">state</span> = <span class="type">HtmlState</span>::<span class="var">inSlide</span>;<br/>
<span class="in2"></span><span class="keyword">continue</span>;<br/>
<span class="in1"></span>}<br/>
<span class="macro">@end(<span class="name">process line</span>)</span><br/>
</code></div>
<ul><li>
Wenn am Anfang einer Zeile eine Raute gelesen wird, dann beginnt eine
  Überschrift
</li></ul>
</div>
<div><div>
<code>
<span class="macro">@def(<span class="name">process header</span>)</span><br/>
<span class="in1"></span><span class="type">int</span> <span class="var">level</span> = <span class="num">1</span>;<br/>
<span class="in1"></span><span class="keyword">while</span> (<br/>
<span class="in2"></span><span class="var">level</span> &lt; (<span class="type">int</span>) <span class="var">line</span>.<span class="fn">size</span>() &amp;&amp;<br/>
<span class="in3"></span><span class="var">line</span>[<span class="var">level</span>] == <span class="str">'#'</span><br/>
<span class="in1"></span>) {<br/>
<span class="in2"></span>++<span class="var">level</span>;<br/>
<span class="in1"></span>}<br/>
<span class="macro">@end(<span class="name">process header</span>)</span><br/>
</code></div>
<ul><li>
Solange weitere Rauten folgen, wird der Level erhöht
</li></ul>
</div>
<div><div>
<code>
<span class="macro">@add(<span class="name">process header</span>)</span><br/>
<span class="in1"></span><span class="type">auto</span> <span class="var">e</span> = <span class="var">line</span>.<span class="fn">end</span>();<br/>
<span class="in1"></span><span class="type">auto</span> <span class="var">b</span> = <span class="var">line</span>.<span class="fn">begin</span>() + <span class="var">level</span>;<br/>
<span class="in1"></span><span class="keyword">while</span> (<span class="var">b</span> != <span class="var">e</span> &amp;&amp; *<span class="var">b</span> &lt;= <span class="str">' '</span>) {<br/>
<span class="in2"></span>++<span class="var">b</span>;<br/>
<span class="in1"></span>}<br/>
<span class="macro">@end(<span class="name">process header</span>)</span><br/>
</code></div>
<ul><li>
Nach den Rauten dürfen beliebig viele Leerzeichen vorkommen
</li></ul>
</div>
<div><div>
<code>
<span class="macro">@add(<span class="name">process header</span>)</span><br/>
<span class="in1"></span><span class="fn">ASSERT</span>(<span class="var">b</span> != <span class="var">e</span>);<br/>
<span class="in1"></span><span class="type">std</span>::<span class="type">string</span> <span class="var">name</span> {<span class="var">b</span>, <span class="var">e</span>};<br/>
<span class="in1"></span><span class="macro">@put(<span class="name">close previous HTML page</span>)</span>;<br/>
<span class="in1"></span><span class="macro">@mul(<span class="name">write header tag</span>)</span>;<br/>
<span class="in1"></span><span class="var">out</span> &lt;&lt; <span class="str">"&lt;div class=\"slides\"&gt;\n"</span>;<br/>
<span class="in1"></span><span class="var">out</span> &lt;&lt; <span class="str">"&lt;div&gt;&lt;div&gt;\n"</span>;<br/>
<span class="in1"></span><span class="macro">@mul(<span class="name">write header tag</span>)</span>;<br/>
<span class="in1"></span><span class="var">out</span> &lt;&lt; <span class="str">"&lt;/div&gt;\n"</span>;<br/>
<span class="macro">@end(<span class="name">process header</span>)</span><br/>
</code></div>
<ul><li>
Falls schon eine Seite offen ist, dann wird diese geschlossen
</li><li>
Dann wird eine HTML-Überschrift ausgegeben
</li><li>
Und eine Folie mit einer HTML-Überschrift wird erzeugt
</li></ul>
</div>
<div><div>
<code>
<span class="macro">@Add(<span class="name">global elements</span>)</span> <br/>
<span class="in1"></span><span class="type">void</span> <span class="fn">writeOneEscaped</span>(<br/>
<span class="in2"></span><span class="type">std</span>::<span class="var">ostream</span> &amp;<span class="var">out</span>, <span class="type">char</span> <span class="var">ch</span><br/>
<span class="in1"></span>) {<br/>
<span class="in2"></span><span class="keyword">switch</span> (<span class="var">ch</span>) {<br/>
<span class="in3"></span><span class="macro">@put(<span class="name">escape special</span>)</span><br/>
<span class="in3"></span><span class="keyword">default</span>:<br/>
<span class="in4"></span><span class="var">out</span> &lt;&lt; <span class="var">ch</span>;<br/>
<span class="in2"></span>}<br/>
<span class="in1"></span>}<br/>
<span class="macro">@end(<span class="name">global elements</span>)</span><br/>
</code></div>
<ul><li>
Schreibt ein Zeichen
</li><li>
Zeichen mit besonderer Bedeutung in HTML ersetzt die Funktion durch
  Entitäten
</li></ul>
</div>
<div><div>
<code>
<span class="macro">@Add(<span class="name">global elements</span>)</span><br/>
<span class="in1"></span><span class="type">void</span> <span class="fn">writeEscaped</span>(<br/>
<span class="in2"></span><span class="type">std</span>::<span class="var">ostream</span> &amp;<span class="var">out</span>,<br/>
<span class="in2"></span><span class="type">const</span> <span class="type">std</span>::<span class="type">string</span> &amp;<span class="var">str</span><br/>
<span class="in1"></span>) {<br/>
<span class="in2"></span><span class="keyword">for</span> (<span class="type">char</span> <span class="var">ch</span> : <span class="var">str</span>) {<br/>
<span class="in3"></span><span class="fn">writeOneEscaped</span>(<span class="var">out</span>, <span class="var">ch</span>);<br/>
<span class="in2"></span>}<br/>
<span class="in1"></span>}<br/>
<span class="macro">@end(<span class="name">global elements</span>)</span><br/>
</code></div>
<ul><li>
Schreibt mehrere Zeichen
</li><li>
Zeichen mit besonderer Bedeutung in HTML ersetzt die Funktion durch
  Entitäten
</li></ul>
</div>
<div><div>
<code>
<span class="macro">@def(<span class="name">escape special</span>)</span><br/>
<span class="in1"></span><span class="keyword">case</span> <span class="str">'&lt;'</span>:<br/>
<span class="in2"></span><span class="var">out</span> &lt;&lt; <span class="str">"&amp;lt;"</span>;<br/>
<span class="in2"></span><span class="keyword">break</span>;<br/>
<span class="in1"></span><span class="keyword">case</span> <span class="str">'&gt;'</span>:<br/>
<span class="in2"></span><span class="var">out</span> &lt;&lt; <span class="str">"&amp;gt;"</span>;<br/>
<span class="in2"></span><span class="keyword">break</span>;<br/>
<span class="in1"></span><span class="keyword">case</span> <span class="str">'&amp;'</span>:<br/>
<span class="in2"></span><span class="var">out</span> &lt;&lt; <span class="str">"&amp;amp;"</span>;<br/>
<span class="in2"></span><span class="keyword">break</span>;<br/>
<span class="macro">@end(<span class="name">escape special</span>)</span><br/>
</code></div>
<ul><li>
Die Zeichen <code>&lt;</code>, <code>&gt;</code> und <code>&amp;</code> werden ersetzt
</li></ul>
</div>
<div><div>
<code>
<span class="macro">@Add(<span class="name">global elements</span>)</span><br/>
<span class="in1"></span><span class="macro">@put(<span class="name">process code helper</span>)</span>;<br/>
<span class="in1"></span><span class="type">void</span> <span class="fn">process_code</span>(<br/>
<span class="in2"></span><span class="type">std</span>::<span class="var">ostream</span> &amp;<span class="var">out</span>,<br/>
<span class="in2"></span><span class="var">SI</span> <span class="var">begin</span>, <span class="var">SI</span> <span class="var">end</span><br/>
<span class="in1"></span>) {<br/>
<span class="in2"></span><span class="macro">@put(<span class="name">do code</span>)</span>;<br/>
<span class="in1"></span>}<br/>
<span class="macro">@end(<span class="name">global elements</span>)</span><br/>
</code></div>
<ul><li>
Verarbeitet ein Code-Fragment
</li><li>
Dies Funktion wird im Code Modus verwendet
</li><li>
Und wenn in Notizen Code-Fragmente eingebettet sind
</li></ul>
</div>
<div><div>
<code>
<span class="macro">@Add(<span class="name">global elements</span>)</span><br/>
<span class="in1"></span><span class="type">void</span> <span class="fn">process_content</span>(<br/>
<span class="in2"></span><span class="type">std</span>::<span class="var">ostream</span> &amp;<span class="var">out</span>,<br/>
<span class="in2"></span><span class="var">SI</span> <span class="var">begin</span>, <span class="var">SI</span> <span class="var">end</span><br/>
<span class="in1"></span>) {<br/>
<span class="in2"></span><span class="macro">@put(<span class="name">process content line</span>)</span>;<br/>
<span class="in1"></span>}<br/>
<span class="macro">@end(<span class="name">global elements</span>)</span><br/>
</code></div>
<ul><li>
Diese Funktion formatiert beliebigen Markdown-Text als HTML
</li><li>
Code-Schnippsel werden ebenfalls formatiert
</li></ul>
</div>
<div><div>
<code>
<span class="macro">@def(<span class="name">write header tag</span>)</span><br/>
<span class="in1"></span><span class="var">out</span> &lt;&lt; <span class="str">"&lt;h"</span> &lt;&lt; <span class="var">level</span> &lt;&lt; <span class="str">'&gt;'</span>;<br/>
<span class="in1"></span><span class="fn">process_content</span>(<span class="var">out</span>, <span class="var">name</span>.<span class="fn">begin</span>(), <span class="var">name</span>.<span class="fn">end</span>());<br/>
<span class="in1"></span><span class="var">out</span> &lt;&lt; <span class="str">"&lt;/h"</span> &lt;&lt; <span class="var">level</span> &lt;&lt; <span class="str">"&gt;\n"</span>;<br/>
<span class="macro">@end(<span class="name">write header tag</span>)</span><br/>
</code></div>
<ul><li>
Die HTML-Überschrift enthält den eingelesenen Level
</li></ul>
</div>
<div><div>
<code>
<span class="macro">@def(<span class="name">close previous HTML page</span>)</span><br/>
<span class="in1"></span><span class="keyword">switch</span> (<span class="var">status</span>.<span class="var">state</span>) {<br/>
<span class="in2"></span><span class="keyword">case</span> <span class="type">HtmlState</span>::<span class="var">nothing</span>: {<br/>
<span class="in3"></span><span class="macro">@put(<span class="name">write HTML header</span>)</span>;<br/>
<span class="in3"></span><span class="keyword">break</span>;<br/>
<span class="in2"></span>}<br/>
<span class="in2"></span><span class="keyword">case</span> <span class="type">HtmlState</span>::<span class="var">inSlide</span>: {<br/>
<span class="in3"></span><span class="var">out</span> &lt;&lt; <span class="str">"&lt;/div&gt;\n"</span>;<br/>
<span class="in3"></span>// <span class="var">fallthrough</span><br/>
<span class="in2"></span>}<br/>
<span class="in2"></span><span class="keyword">default</span>: {<br/>
<span class="in3"></span><span class="var">out</span> &lt;&lt; <span class="str">"&lt;/div&gt;\n"</span>;<br/>
<span class="in2"></span>}<br/>
<span class="in1"></span>}<br/>
<span class="macro">@end(<span class="name">close previous HTML page</span>)</span><br/>
</code></div>
<ul><li>
Je nach Zustand müssen unterschiedlich viele HTML-Tags geschlossen
  werden
</li></ul>
</div>
<div><div>
<code>
<span class="macro">@def(<span class="name">write HTML header</span>)</span><br/>
<span class="in1"></span><span class="var">out</span> &lt;&lt; <span class="str">"&lt;!doctype html&gt;\n"</span>;<br/>
<span class="in1"></span><span class="var">out</span> &lt;&lt; <span class="str">"&lt;html lang=\"de\"&gt;\n"</span>;<br/>
<span class="in1"></span><span class="var">out</span> &lt;&lt; <span class="str">"&lt;head&gt;\n"</span>;<br/>
<span class="in1"></span><span class="macro">@put(<span class="name">write HTML header entries</span>)</span>;<br/>
<span class="in1"></span><span class="var">out</span> &lt;&lt; <span class="str">"&lt;/head&gt;\n"</span>;<br/>
<span class="in1"></span><span class="var">out</span> &lt;&lt; <span class="str">"&lt;body&gt;\n"</span>;<br/>
<span class="macro">@end(<span class="name">write HTML header</span>)</span><br/>
</code></div>
<ul><li>
Dies wird am Anfang der HTML-Datei ausgegeben
</li><li>
Dafür muss jede <code>.<span class="var">x</span></code>-Datei mit einer Überschrift beginnen
</li><li>
Diese Überschrift ist dann auch der Titel der HTML-Datei
</li></ul>
</div>
<div><div>
<code>
<span class="macro">@def(<span class="name">write HTML header entries</span>)</span><br/>
<span class="in1"></span><span class="var">out</span> &lt;&lt; <span class="str">"&lt;meta charset=\"utf-8\"&gt;\n"</span>;<br/>
<span class="in1"></span><span class="var">out</span> &lt;&lt; <span class="str">"&lt;title&gt;"</span>;<br/>
<span class="in1"></span><span class="fn">writeEscaped</span>(<span class="var">out</span>, <span class="var">name</span>);<br/>
<span class="in1"></span><span class="var">out</span> &lt;&lt; <span class="str">"&lt;/title&gt;\n"</span>;<br/>
<span class="in1"></span><span class="var">out</span> &lt;&lt; <span class="str">"&lt;link rel=\"stylesheet\" "</span><br/>
<span class="in2"></span><span class="str">"type=\"text/css\" href=\""</span><br/>
<span class="in2"></span>&lt;&lt; <span class="var">stylesheet</span> &lt;&lt; <span class="str">"\"&gt;"</span>;<br/>
<span class="macro">@end(<span class="name">write HTML header entries</span>)</span><br/>
</code></div>
<ul><li>
Im Header wird das Zeichenformat auf UTF-8 gesetzt
</li><li>
Und der Titel ausgegeben
</li><li>
Und die Stylesheet-Datei eingebunden
</li></ul>
</div>
</div>
<h1>Code formatieren</h1>
<div class="slides">
<div><div>
<h1>Code formatieren</h1>
</div>
<ul><li>
Code kann auf Seiten oder in den Notizen ausgegeben werden
</li></ul>
</div>
<div><div>
<code>
<span class="macro">@def(<span class="name">html state enums</span>)</span><br/>
<span class="in1"></span>, <span class="var">inCode</span><br/>
<span class="macro">@end(<span class="name">html state enums</span>)</span><br/>
</code></div>
<ul><li>
Es gibt einen eigenen Zustand, wenn Code ausgegeben wird
</li></ul>
</div>
<div><div>
<code>
<span class="macro">@def(<span class="name">check html special state</span>)</span><br/>
<span class="in1"></span><span class="keyword">if</span> (<span class="var">s</span>-&gt;<span class="var">state</span> == <span class="type">HtmlState</span>::<span class="var">inCode</span>) {<br/>
<span class="in2"></span><span class="keyword">return</span> <span class="num">true</span>;<br/>
<span class="in1"></span>}<br/>
<span class="macro">@end(<span class="name">check html special state</span>)</span><br/>
</code></div>
<ul><li>
Die Code-Ausgabe ist ein besonderer Zustand
</li></ul>
</div>
<div><div>
<code>
<span class="macro">@add(<span class="name">process line</span>)</span><br/>
<span class="in1"></span><span class="keyword">if</span> (<span class="var">line</span> == <span class="str">"```"</span>) {<br/>
<span class="in2"></span><span class="macro">@put(<span class="name">open code page</span>)</span>;<br/>
<span class="in2"></span><span class="keyword">continue</span>;<br/>
<span class="in1"></span>}<br/>
<span class="macro">@end(<span class="name">process line</span>)</span><br/>
</code></div>
<ul><li>
Eine Zeile mit drei Backticks wechselt in den Code Modus
</li></ul>
</div>
<div><div>
<code>
<span class="macro">@def(<span class="name">open code page</span>)</span><br/>
<span class="in1"></span><span class="keyword">if</span> (<br/>
<span class="in2"></span><span class="var">status</span>.<span class="var">state</span> == <span class="type">HtmlState</span>::<span class="var">afterSlides</span><br/>
<span class="in1"></span>) {<br/>
<span class="in2"></span><span class="var">out</span> &lt;&lt; <span class="str">"&lt;div class=\"slides\"&gt;\n"</span>;<br/>
<span class="in1"></span>}<br/>
<span class="in1"></span><span class="keyword">if</span> (<br/>
<span class="in2"></span><span class="var">status</span>.<span class="var">state</span> == <span class="type">HtmlState</span>::<span class="var">inSlide</span><br/>
<span class="in1"></span>) {<br/>
<span class="in2"></span><span class="var">out</span> &lt;&lt; <span class="str">"&lt;/div&gt;\n"</span>;<br/>
<span class="in1"></span>}<br/>
<span class="in1"></span><span class="var">out</span> &lt;&lt; <span class="str">"&lt;div&gt;&lt;div&gt;\n"</span>;<br/>
<span class="in1"></span><span class="var">out</span> &lt;&lt; <span class="str">"&lt;code&gt;\n"</span>;<br/>
<span class="in1"></span><span class="var">status</span>.<span class="var">state</span> = <span class="type">HtmlState</span>::<span class="var">inCode</span>;<br/>
<span class="macro">@end(<span class="name">open code page</span>)</span><br/>
</code></div>
<ul><li>
Beim Betreten wird eine Seite mit einem <code>&lt;<span class="var">code</span>&gt;</code>-Tag geöffnet
</li><li>
Und der Zustand passend gesetzt
</li></ul>
</div>
<div><div>
<code>
<span class="macro">@def(<span class="name">process code</span>)</span><br/>
<span class="in1"></span><span class="keyword">if</span> (<span class="var">line</span> == <span class="str">"```"</span>) {<br/>
<span class="in2"></span><span class="macro">@put(<span class="name">close code page</span>)</span>;<br/>
<span class="in2"></span><span class="keyword">continue</span>;<br/>
<span class="in1"></span>}<br/>
<span class="macro">@end(<span class="name">process code</span>)</span><br/>
</code></div>
<ul><li>
Eine Zeile mit drei Backticks wechselt aus dem Code Modus zurück
</li></ul>
</div>
<div><div>
<code>
<span class="macro">@def(<span class="name">close code page</span>)</span><br/>
<span class="in1"></span><span class="var">out</span> &lt;&lt; <span class="str">"&lt;/code&gt;&lt;/div&gt;\n"</span>;<br/>
<span class="in1"></span><span class="var">status</span>.<span class="var">state</span> = <span class="type">HtmlState</span>::<span class="var">inSlide</span>;<br/>
<span class="macro">@end(<span class="name">close code page</span>)</span><br/>
</code></div>
<ul><li>
Beim Verlassen wird die Folie (aber nicht die Seite) geschlossen
</li></ul>
</div>
<div><div>
<code>
<span class="macro">@add(<span class="name">write from in to out</span>)</span><br/>
<span class="in1"></span><span class="keyword">if</span> (<br/>
<span class="in2"></span><span class="var">status</span>.<span class="var">state</span> == <span class="type">HtmlState</span>::<span class="var">inCode</span><br/>
<span class="in1"></span>) {<br/>
<span class="in2"></span><span class="type">std</span>::<span class="var">cerr</span> &lt;&lt;<br/>
<span class="in3"></span><span class="str">"unterminated code block\n"</span>;<br/>
<span class="in1"></span>}<br/>
<span class="macro">@end(<span class="name">write from in to out</span>)</span><br/>
</code></div>
<ul><li>
Wenn wir beim Beenden des Parsens noch im Code-Modus sind, dann
  stimmt etwas nicht
</li><li>
Eine Fehlermeldung wird ausgegeben
</li></ul>
</div>
<div><div>
<code>
<span class="macro">@add(<span class="name">write from in to out</span>)</span><br/>
<span class="in1"></span><span class="keyword">if</span> (<br/>
<span class="in2"></span><span class="var">status</span>.<span class="var">state</span> != <span class="type">HtmlState</span>::<span class="var">nothing</span><br/>
<span class="in1"></span>) {<br/>
<span class="in2"></span><span class="var">out</span> &lt;&lt; <span class="str">"&lt;/body&gt;\n&lt;/html&gt;\n"</span>;<br/>
<span class="in1"></span>}<br/>
<span class="macro">@end(<span class="name">write from in to out</span>)</span><br/>
</code></div>
<ul><li>
Am Ende der Datei schließt die Funktion
  die HTML-Tags
</li></ul>
</div>
<div><div>
<code>
<span class="macro">@add(<span class="name">process code</span>)</span><br/>
<span class="in1"></span><span class="fn">process_code</span>(<br/>
<span class="in2"></span><span class="var">out</span>, <span class="var">line</span>.<span class="fn">begin</span>(), <span class="var">line</span>.<span class="fn">end</span>()<br/>
<span class="in1"></span>);<br/>
<span class="in1"></span><span class="var">out</span> &lt;&lt; <span class="str">"&lt;br/&gt;\n"</span>;<br/>
<span class="macro">@end(<span class="name">process code</span>)</span><br/>
</code></div>
<ul><li>
Im Code Modus wird die Funktion aufgerufen
</li><li>
Und danach ein Zeilenumbruch ausgegeben
</li></ul>
</div>
<div><div>
<code>
<span class="macro">@def(<span class="name">do code</span>)</span><br/>
<span class="in1"></span><span class="type">int</span> <span class="var">indent</span> = <span class="num">0</span>;<br/>
<span class="in1"></span><span class="keyword">while</span> (<br/>
<span class="in2"></span><span class="var">begin</span> != <span class="var">end</span> &amp;&amp; *<span class="var">begin</span> == <span class="str">'\t'</span><br/>
<span class="in1"></span>) {<br/>
<span class="in2"></span>++<span class="var">indent</span>; ++<span class="var">begin</span>;<br/>
<span class="in1"></span>}<br/>
<span class="in1"></span><span class="keyword">if</span> (<span class="var">indent</span>) {<br/>
<span class="in2"></span><span class="var">out</span> &lt;&lt; <span class="str">"&lt;span class=\"in"</span><br/>
<span class="in3"></span>&lt;&lt; <span class="var">indent</span><br/>
<span class="in3"></span>&lt;&lt; <span class="str">"\"&gt;&lt;/span&gt;"</span>;<br/>
<span class="in1"></span>}<br/>
<span class="macro">@end(<span class="name">do code</span>)</span><br/>
</code></div>
<ul><li>
Die Funktion zählt Tabulatoren am Anfang der Zeile
</li><li>
Und gibt ein Tag für die passende Einrückung aus
</li></ul>
</div>
<div><div>
<code>
<span class="macro">@add(<span class="name">do code</span>)</span><br/>
<span class="in1"></span><span class="keyword">for</span> (; <span class="var">begin</span> != <span class="var">end</span>; ++<span class="var">begin</span>) {<br/>
<span class="in2"></span><span class="macro">@put(<span class="name">process code ch</span>)</span>;<br/>
<span class="in2"></span><span class="fn">writeOneEscaped</span>(<span class="var">out</span>, *<span class="var">begin</span>);<br/>
<span class="in1"></span>}<br/>
<span class="macro">@end(<span class="name">do code</span>)</span><br/>
</code></div>
<ul><li>
Danach wird die Zeile Zeichen für Zeichen verarbeitet
</li><li>
Wenn keine besondere Verarbeitung geschieht, gibt die Funktion das
  Zeichen direkt aus
</li></ul>
</div>
<div><div>
<code>
<span class="macro">@def(<span class="name">process code ch</span>)</span><br/>
<span class="in1"></span><span class="keyword">if</span> (<br/>
<span class="in2"></span>*<span class="var">begin</span> == <span class="str">'`'</span> ||<br/>
<span class="in2"></span>*<span class="var">begin</span> == <span class="str">'\''</span> ||<br/>
<span class="in2"></span>*<span class="var">begin</span> == <span class="str">'"'</span><br/>
<span class="in1"></span>) {<br/>
<span class="in2"></span><span class="macro">@put(<span class="name">process string</span>)</span>;<br/>
<span class="in2"></span><span class="keyword">continue</span>;<br/>
<span class="in1"></span>}<br/>
<span class="macro">@end(<span class="name">process code ch</span>)</span><br/>
</code></div>
<ul><li>
Wenn ein Zeichen eine Zeichenkette einleitet, wird diese geparst
</li></ul>
</div>
<div><div>
<code>
<span class="macro">@def(<span class="name">process string</span>)</span><br/>
<span class="in1"></span><span class="type">auto</span> <span class="var">w</span> = <span class="var">begin</span> + <span class="num">1</span>;<br/>
<span class="in1"></span><span class="keyword">while</span> (<span class="var">w</span> != <span class="var">end</span> &amp;&amp; *<span class="var">w</span> != *<span class="var">begin</span>) {<br/>
<span class="in2"></span><span class="keyword">if</span> (*<span class="var">w</span> == <span class="str">'\\'</span>) {<br/>
<span class="in3"></span>++<span class="var">w</span>;<br/>
<span class="in3"></span><span class="keyword">if</span> (<span class="var">w</span> == <span class="var">end</span>) { <span class="keyword">break</span>; }<br/>
<span class="in2"></span>}<br/>
<span class="in2"></span>++<span class="var">w</span>;<br/>
<span class="in1"></span>}<br/>
<span class="in1"></span><span class="keyword">if</span> (<span class="var">w</span> == <span class="var">end</span>) {<br/>
<span class="in2"></span><span class="fn">writeOneEscaped</span>(<span class="var">out</span>, *<span class="var">begin</span>);<br/>
<span class="in2"></span><span class="keyword">continue</span>;<br/>
<span class="in1"></span>}<br/>
<span class="macro">@end(<span class="name">process string</span>)</span><br/>
</code></div>
<ul><li>
Die Zeichenkette endet mit dem gleichen Zeichen, mit dem sie angefangen
  hat
</li><li>
Wenn dieses nicht durch einen Backslash escaped ist
</li></ul>
</div>
<div><div>
<code>
<span class="macro">@def(<span class="name">process code helper</span>)</span><br/>
<span class="in1"></span><span class="type">void</span> <span class="fn">span_str</span>(<br/>
<span class="in2"></span><span class="type">std</span>::<span class="var">ostream</span> &amp;<span class="var">out</span>,<br/>
<span class="in2"></span><span class="type">const</span> <span class="type">char</span> *<span class="var">cls</span>,<br/>
<span class="in2"></span><span class="type">const</span> <span class="type">std</span>::<span class="type">string</span> &amp;<span class="var">s</span><br/>
<span class="in1"></span>) {<br/>
<span class="in2"></span><span class="var">out</span> &lt;&lt; <span class="str">"&lt;span class=\""</span> &lt;&lt;<br/>
<span class="in3"></span><span class="var">cls</span> &lt;&lt; <span class="str">"\"&gt;"</span>;<br/>
<span class="in2"></span><span class="fn">writeEscaped</span>(<span class="var">out</span>, <span class="var">s</span>);<br/>
<span class="in2"></span><span class="var">out</span> &lt;&lt; <span class="str">"&lt;/span&gt;"</span>;<br/>
<span class="in1"></span>}<br/>
<span class="macro">@end(<span class="name">process code helper</span>)</span><br/>
</code></div>
<ul><li>
Diese Hilfsfunktion umgibt einen Bezeichner mit einem <code>&lt;<span class="var">span</span>&gt;</code>-Tag
  einer bestimmten Klasse
</li></ul>
</div>
<div><div>
<code>
<span class="macro">@add(<span class="name">process string</span>)</span><br/>
<span class="in1"></span><span class="type">std</span>::<span class="type">string</span> <span class="var">name</span> {<span class="var">begin</span>, <span class="var">w</span> + <span class="num">1</span>};<br/>
<span class="in1"></span><span class="fn">span_str</span>(<span class="var">out</span>, <span class="str">"str"</span>, <span class="var">name</span>);<br/>
<span class="in1"></span><span class="var">begin</span> = <span class="var">w</span>;<br/>
<span class="macro">@end(<span class="name">process string</span>)</span><br/>
</code></div>
<ul><li>
Die Funktion gibt die Zeichenkette als <code>&lt;<span class="var">span</span>&gt;</code> mit der Klasse <code><span class="str">str</span></code>
  aus
</li></ul>
</div>
<div><div>
<code>
<span class="macro">@add(<span class="name">process code ch</span>)</span><br/>
<span class="in1"></span><span class="keyword">if</span> (*<span class="var">begin</span> == <span class="str">'@'</span>) {<br/>
<span class="in2"></span><span class="type">auto</span> <span class="var">nb</span> = <span class="var">begin</span> + <span class="num">1</span>;<br/>
<span class="in2"></span><span class="type">auto</span> <span class="var">ne</span> = <span class="var">nb</span>;<br/>
<span class="in2"></span><span class="keyword">while</span> (<span class="var">ne</span> != <span class="var">end</span> &amp;&amp; *<span class="var">ne</span> != <span class="str">'('</span>) {<br/>
<span class="in3"></span><span class="keyword">if</span> (! <span class="fn">isalpha</span>(*<span class="var">ne</span>)) {<br/>
<span class="in4"></span><span class="var">ne</span> = <span class="var">end</span>;<br/>
<span class="in4"></span><span class="keyword">break</span>;<br/>
<span class="in3"></span>}<br/>
<span class="in3"></span>++<span class="var">ne</span>;<br/>
<span class="in2"></span>}<br/>
<span class="in2"></span><span class="keyword">if</span> (<span class="var">ne</span> != <span class="var">end</span>) {<br/>
<span class="in3"></span><span class="type">std</span>::<span class="type">string</span> <span class="var">name</span> {<span class="var">nb</span>, <span class="var">ne</span>};<br/>
<span class="in3"></span><span class="type">auto</span> <span class="var">ab</span> = <span class="var">ne</span> + <span class="num">1</span>;<br/>
<span class="in3"></span><span class="type">auto</span> <span class="var">ae</span> = <span class="var">ab</span>;<br/>
<span class="in3"></span><span class="macro">@put(<span class="name">macro loop</span>)</span>;<br/>
<span class="in2"></span>}<br/>
<span class="in1"></span>}<br/>
<span class="macro">@end(<span class="name">process code ch</span>)</span><br/>
</code></div>
</div>
<div><div>
<code>
<span class="macro">@def(<span class="name">macro loop</span>)</span><br/>
<span class="in1"></span><span class="keyword">while</span> (<span class="var">ae</span> != <span class="var">end</span> &amp;&amp; *<span class="var">ae</span> != <span class="str">')'</span>) {<br/>
<span class="in2"></span><span class="keyword">if</span> (*<span class="var">ae</span> == <span class="str">'@'</span>) {<br/>
<span class="in3"></span>++<span class="var">ae</span>;<br/>
<span class="in3"></span><span class="keyword">if</span> (<span class="var">ae</span> == <span class="var">end</span>) { <span class="keyword">break</span>; }<br/>
<span class="in2"></span>}<br/>
<span class="in2"></span>++<span class="var">ae</span>;<br/>
<span class="in1"></span>}<br/>
<span class="in1"></span><span class="keyword">if</span> (<span class="var">ae</span> != <span class="var">end</span>) {<br/>
<span class="in2"></span><span class="type">std</span>::<span class="type">string</span> <span class="var">arg</span> {<span class="var">ab</span>, <span class="var">ae</span>};<br/>
<span class="in2"></span><span class="macro">@put(<span class="name">got macro</span>)</span>;<br/>
<span class="in2"></span><span class="keyword">continue</span>;<br/>
<span class="in1"></span>}<br/>
<span class="macro">@end(<span class="name">macro loop</span>)</span><br/>
</code></div>
</div>
<div><div>
<code>
<span class="macro">@def(<span class="name">got macro</span>)</span><br/>
<span class="in1"></span><span class="var">do</span> {<br/>
<span class="in2"></span><span class="macro">@put(<span class="name">special macro</span>)</span>;<br/>
<span class="in2"></span><span class="macro">@put(<span class="name">macro default</span>)</span>;<br/>
<span class="in1"></span>} <span class="keyword">while</span> (<span class="num">false</span>);<br/>
<span class="in1"></span><span class="var">begin</span> = <span class="var">ae</span>;<br/>
<span class="macro">@end(<span class="name">got macro</span>)</span><br/>
</code></div>
</div>
<div><div>
<code>
<span class="macro">@def(<span class="name">macro default</span>)</span><br/>
<span class="in1"></span><span class="type">std</span>::<span class="var">cerr</span> &lt;&lt; <span class="str">"unknown macro @"</span> &lt;&lt;<br/>
<span class="in2"></span><span class="var">name</span> &lt;&lt; <span class="str">'('</span> &lt;&lt; <span class="var">arg</span> &lt;&lt; <span class="str">")\n"</span>;<br/>
<span class="in1"></span><span class="fn">writeOneEscaped</span>(<span class="var">out</span>, <span class="str">'@'</span>);<br/>
<span class="in1"></span><span class="fn">writeEscaped</span>(<span class="var">out</span>, <span class="var">name</span>);<br/>
<span class="in1"></span><span class="fn">writeOneEscaped</span>(<span class="var">out</span>, <span class="str">'('</span>);<br/>
<span class="in1"></span><span class="fn">writeEscaped</span>(<span class="var">out</span>, <span class="var">arg</span>);<br/>
<span class="in1"></span><span class="fn">writeOneEscaped</span>(<span class="var">out</span>, <span class="str">')'</span>);<br/>
<span class="macro">@end(<span class="name">macro default</span>)</span><br/>
</code></div>
</div>
<div><div>
<code>
<span class="macro">@def(<span class="name">special macro</span>)</span><br/>
<span class="in1"></span><span class="keyword">static</span> <span class="type">Set</span> <span class="var">macros</span> = {<br/>
<span class="in2"></span><span class="str">"def"</span>, <span class="str">"end"</span>, <span class="str">"add"</span>, <span class="str">"put"</span>, <span class="str">"mul"</span>,<br/>
<span class="in2"></span><span class="str">"Def"</span>, <span class="str">"Add"</span>, <span class="str">"Mul"</span>, <span class="str">"rep"</span>, <span class="str">"Rep"</span>,<br/>
<span class="in2"></span><span class="str">"Put"</span>, <span class="str">"End"</span><br/>
<span class="in1"></span>};<br/>
<span class="in1"></span><span class="keyword">if</span> (<br/>
<span class="in2"></span><span class="var">macros</span>.<span class="fn">find</span>(<span class="var">name</span>) != <span class="var">macros</span>.<span class="fn">end</span>()<br/>
<span class="in1"></span>) {<br/>
<span class="in2"></span><span class="fn">writeMacroHeader</span>(<span class="var">out</span>, <span class="var">name</span>);<br/>
<span class="in2"></span><span class="fn">writeEscaped</span>(<span class="var">out</span>, <span class="var">arg</span>);<br/>
<span class="in2"></span><span class="var">out</span> &lt;&lt; <span class="str">"&lt;/span&gt;)&lt;/span&gt;"</span>;<br/>
<span class="in2"></span><span class="keyword">break</span>;<br/>
<span class="in1"></span>}<br/>
<span class="macro">@end(<span class="name">special macro</span>)</span><br/>
</code></div>
</div>
<div><div>
<code>
<span class="macro">@add(<span class="name">special macro</span>)</span><br/>
<span class="in1"></span><span class="keyword">if</span> (<span class="var">name</span> == <span class="str">"inc"</span>) {<br/>
<span class="in2"></span><span class="macro">@put(<span class="name">write include</span>)</span>;<br/>
<span class="in2"></span><span class="keyword">break</span>;<br/>
<span class="in1"></span>}<br/>
<span class="macro">@end(<span class="name">special macro</span>)</span><br/>
</code></div>
</div>
<div><div>
<code>
<span class="macro">@def(<span class="name">write include</span>)</span><br/>
<span class="in1"></span><span class="type">auto</span> <span class="var">ext</span> = <span class="var">arg</span>.<span class="fn">find_last_of</span>(<span class="str">'.'</span>);<br/>
<span class="in1"></span><span class="fn">ASSERT_MSG</span>(<br/>
<span class="in2"></span><span class="var">ext</span> != <span class="type">std</span>::<span class="type">string</span>::<span class="var">npos</span>,<br/>
<span class="in2"></span><span class="str">"no period"</span><br/>
<span class="in1"></span>);<br/>
<span class="in1"></span><span class="fn">writeMacroHeader</span>(<span class="var">out</span>, <span class="var">name</span>);<br/>
<span class="in1"></span><span class="var">out</span> &lt;&lt; <span class="str">"&lt;a href=\""</span> &lt;&lt;<br/>
<span class="in2"></span><span class="var">arg</span>.<span class="fn">substr</span>(<span class="num">0</span>, <span class="var">ext</span>) &lt;&lt;<br/>
<span class="in2"></span><span class="str">".html\"&gt;"</span>;<br/>
<span class="in1"></span><span class="var">out</span> &lt;&lt; <span class="var">arg</span> &lt;&lt;<br/>
<span class="in2"></span><span class="str">"&lt;/a&gt;&lt;/span&gt;)&lt;/span&gt;"</span>;<br/>
<span class="macro">@end(<span class="name">write include</span>)</span><br/>
</code></div>
<ul><li>
Die Datei-Extension wird beim generierten Link durch <code><span class="str">.html</span></code>
  ersetzt
</li></ul>
</div>
<div><div>
<code>
<span class="macro">@add(<span class="name">special macro</span>)</span><br/>
<span class="in1"></span><span class="keyword">if</span> (<span class="var">name</span> == <span class="str">"s"</span> || <span class="var">name</span> == <span class="str">"str"</span>) {<br/>
<span class="in2"></span><span class="fn">writeMacroClass</span>(<span class="var">out</span>, <span class="str">"str"</span>);<br/>
<span class="in2"></span><span class="keyword">for</span> (<span class="type">auto</span> <span class="var">x</span> = <span class="var">arg</span>.<span class="fn">begin</span>();; ++<span class="var">x</span>) {<br/>
<span class="in3"></span><span class="keyword">if</span> (*<span class="var">x</span> == <span class="str">'@'</span>) {<br/>
<span class="in4"></span>++<span class="var">x</span>;<br/>
<span class="in3"></span>}<br/>
<span class="in3"></span><span class="keyword">if</span> (<span class="var">x</span> == <span class="var">arg</span>.<span class="fn">end</span>()) { <span class="keyword">break</span>; }<br/>
<span class="in3"></span><span class="fn">writeOneEscaped</span>(<span class="var">out</span>, *<span class="var">x</span>);<br/>
<span class="in2"></span>}<br/>
<span class="in2"></span><span class="var">out</span> &lt;&lt; <span class="str">"&lt;/span&gt;"</span>;<br/>
<span class="in2"></span><span class="keyword">break</span>;<br/>
<span class="in1"></span>}<br/>
<span class="macro">@end(<span class="name">special macro</span>)</span><br/>
</code></div>
</div>
<div><div>
<code>
<span class="macro">@add(<span class="name">special macro</span>)</span><br/>
<span class="in1"></span><span class="keyword">if</span> (<span class="var">name</span> == <span class="str">"f"</span> || <span class="var">name</span> == <span class="str">"fn"</span>) {<br/>
<span class="in2"></span><span class="fn">writeMacroClass</span>(<span class="var">out</span>, <span class="str">"fn"</span>);<br/>
<span class="in2"></span><span class="fn">writeEscaped</span>(<span class="var">out</span>, <span class="var">arg</span>);<br/>
<span class="in2"></span><span class="var">out</span> &lt;&lt; <span class="str">"&lt;/span&gt;"</span>;<br/>
<span class="in2"></span><span class="keyword">break</span>;<br/>
<span class="in1"></span>}<br/>
<span class="macro">@end(<span class="name">special macro</span>)</span><br/>
</code></div>
<ul><li>
Der Bezeichner <code><span class="str">f</span></code> steht für eine Funktion-Formatierung
</li></ul>
</div>
<div><div>
<code>
<span class="macro">@add(<span class="name">special macro</span>)</span><br/>
<span class="in1"></span><span class="keyword">if</span> (<span class="var">name</span> == <span class="str">"v"</span> || <span class="var">name</span> == <span class="str">"var"</span>) {<br/>
<span class="in2"></span><span class="fn">writeMacroClass</span>(<span class="var">out</span>, <span class="str">"var"</span>);<br/>
<span class="in2"></span><span class="fn">writeEscaped</span>(<span class="var">out</span>, <span class="var">arg</span>);<br/>
<span class="in2"></span><span class="var">out</span> &lt;&lt; <span class="str">"&lt;/span&gt;"</span>;<br/>
<span class="in2"></span><span class="keyword">break</span>;<br/>
<span class="in1"></span>}<br/>
<span class="macro">@end(<span class="name">special macro</span>)</span><br/>
</code></div>
<ul><li>
Der Bezeichner <code><span class="str">v</span></code> steht für eine Variablen-Formatierung
</li></ul>
</div>
<div><div>
<code>
<span class="macro">@add(<span class="name">special macro</span>)</span><br/>
<span class="in1"></span><span class="keyword">if</span> (<span class="var">name</span> == <span class="str">"k"</span> || <span class="var">name</span> == <span class="str">"key"</span>) {<br/>
<span class="in2"></span><span class="fn">writeMacroClass</span>(<span class="var">out</span>, <span class="str">"keyword"</span>);<br/>
<span class="in2"></span><span class="fn">writeEscaped</span>(<span class="var">out</span>, <span class="var">arg</span>);<br/>
<span class="in2"></span><span class="var">out</span> &lt;&lt; <span class="str">"&lt;/span&gt;"</span>;<br/>
<span class="in2"></span><span class="keyword">break</span>;<br/>
<span class="in1"></span>}<br/>
<span class="macro">@end(<span class="name">special macro</span>)</span><br/>
</code></div>
<ul><li>
Der Bezeichner <code><span class="str">k</span></code> steht für eine Schlüsselwort-Formatierung
</li></ul>
</div>
<div><div>
<code>
<span class="macro">@add(<span class="name">special macro</span>)</span><br/>
<span class="in1"></span><span class="keyword">if</span> (<span class="var">name</span> == <span class="str">"n"</span> || <span class="var">name</span> == <span class="str">"num"</span>) {<br/>
<span class="in2"></span><span class="fn">writeMacroClass</span>(<span class="var">out</span>, <span class="str">"num"</span>);<br/>
<span class="in2"></span><span class="fn">writeEscaped</span>(<span class="var">out</span>, <span class="var">arg</span>);<br/>
<span class="in2"></span><span class="var">out</span> &lt;&lt; <span class="str">"&lt;/span&gt;"</span>;<br/>
<span class="in2"></span><span class="keyword">break</span>;<br/>
<span class="in1"></span>}<br/>
<span class="macro">@end(<span class="name">special macro</span>)</span><br/>
</code></div>
<ul><li>
Der Bezeichner <code><span class="str">n</span></code> steht für eine Wert-Formatierung
</li></ul>
</div>
<div><div>
<code>
<span class="macro">@add(<span class="name">special macro</span>)</span><br/>
<span class="in1"></span><span class="keyword">if</span> (<span class="var">name</span> == <span class="str">"t"</span> || <span class="var">name</span> == <span class="str">"typ"</span>) {<br/>
<span class="in2"></span><span class="fn">writeMacroClass</span>(<span class="var">out</span>, <span class="str">"type"</span>);<br/>
<span class="in2"></span><span class="fn">writeEscaped</span>(<span class="var">out</span>, <span class="var">arg</span>);<br/>
<span class="in2"></span><span class="var">out</span> &lt;&lt; <span class="str">"&lt;/span&gt;"</span>;<br/>
<span class="in2"></span><span class="keyword">break</span>;<br/>
<span class="in1"></span>}<br/>
<span class="macro">@end(<span class="name">special macro</span>)</span><br/>
</code></div>
<ul><li>
Der Bezeichner <code><span class="str">t</span></code> steht für eine Typ-Formatierung
</li></ul>
</div>
<div><div>
<code>
<span class="macro">@add(<span class="name">special macro</span>)</span><br/>
<span class="in1"></span><span class="keyword">if</span> (<span class="var">name</span> == <span class="str">"b"</span> || <span class="var">name</span> == <span class="str">"br"</span>) {<br/>
<span class="in2"></span><span class="fn">writeMacroClass</span>(<span class="var">out</span>, <span class="str">"virt"</span>);<br/>
<span class="in2"></span><span class="var">out</span> &lt;&lt; <span class="str">"&lt;/span&gt;&lt;br/&gt;"</span>;<br/>
<span class="in2"></span><span class="keyword">break</span>;<br/>
<span class="in1"></span>}<br/>
<span class="macro">@end(<span class="name">special macro</span>)</span><br/>
</code></div>
<ul><li>
Der Bezeichner <code><span class="str">b</span></code> wird als Zeilenumbruch dargestellt
</li></ul>
</div>
<div><div>
<code>
<span class="macro">@add(<span class="name">special macro</span>)</span><br/>
<span class="in1"></span><span class="keyword">if</span> (<span class="var">name</span> == <span class="str">"priv"</span>) {<br/>
<span class="in2"></span><span class="fn">writeMacroClass</span>(<span class="var">out</span>, <span class="str">"var"</span>);<br/>
<span class="in2"></span><span class="var">out</span> &lt;&lt; <span class="str">"@priv(&lt;span&gt;"</span>;<br/>
<span class="in2"></span><span class="fn">writeEscaped</span>(<span class="var">out</span>, <span class="var">arg</span>);<br/>
<span class="in2"></span><span class="var">out</span> &lt;&lt; <span class="str">"&lt;/span&gt;)&lt;/span&gt;"</span>;<br/>
<span class="in2"></span><span class="keyword">break</span>;<br/>
<span class="in1"></span>}<br/>
<span class="macro">@end(<span class="name">special macro</span>)</span><br/>
</code></div>
<ul><li>
<code>@<span class="var">priv</span></code>-Makro ist ein Bezeichner
</li></ul>
</div>
<div><div>
<code>
<span class="macro">@add(<span class="name">special macro</span>)</span><br/>
<span class="in1"></span><span class="keyword">if</span> (<span class="var">name</span> == <span class="str">"magic"</span>) {<br/>
<span class="in2"></span><span class="fn">writeMacroClass</span>(<span class="var">out</span>, <span class="str">"num"</span>);<br/>
<span class="in2"></span><span class="var">out</span> &lt;&lt; <span class="str">"@magic(&lt;span&gt;"</span>;<br/>
<span class="in2"></span><span class="fn">writeEscaped</span>(<span class="var">out</span>, <span class="var">arg</span>);<br/>
<span class="in2"></span><span class="var">out</span> &lt;&lt; <span class="str">"&lt;/span&gt;)&lt;/span&gt;"</span>;<br/>
<span class="in2"></span><span class="keyword">break</span>;<br/>
<span class="in1"></span>}<br/>
<span class="macro">@end(<span class="name">special macro</span>)</span><br/>
</code></div>
<ul><li>
<code>@<span class="var">magic</span></code>-Makro ist ein Wert
</li></ul>
</div>
<div><div>
<code>
<span class="macro">@Add(<span class="name">includes</span>)</span><br/>
<span class="in1"></span><span class="keyword">#include</span> &lt;<span class="var">cctype</span>&gt;<br/>
<span class="macro">@end(<span class="name">includes</span>)</span><br/>
</code></div>
<ul><li>
Die Funktion verwendet <code><span class="type">std</span>::<span class="var">isalnum</span></code>
</li></ul>
</div>
<div><div>
<code>
<span class="macro">@add(<span class="name">process code ch</span>)</span><br/>
<span class="in1"></span><span class="type">auto</span> <span class="var">w</span> = <span class="var">begin</span>;<br/>
<span class="in1"></span><span class="macro">@put(<span class="name">find identifier end</span>)</span>;<br/>
<span class="in1"></span><span class="keyword">if</span> (<span class="var">w</span> != <span class="var">begin</span>) {<br/>
<span class="in2"></span><span class="macro">@put(<span class="name">process identifier</span>)</span>;<br/>
<span class="in2"></span><span class="keyword">continue</span>;<br/>
<span class="in1"></span>}<br/>
<span class="macro">@end(<span class="name">process code ch</span>)</span><br/>
</code></div>
<ul><li>
An der aktuellen Position wird ein Identifier gesucht
</li><li>
Wenn dieser gefunden wird, dann wird er abgearbeitet
</li></ul>
</div>
<div><div>
<code>
<span class="macro">@def(<span class="name">find identifier end</span>)</span><br/>
<span class="in1"></span><span class="keyword">while</span> (<span class="var">w</span> != <span class="var">end</span> &amp;&amp; (<br/>
<span class="in2"></span><span class="type">std</span>::<span class="fn">isalnum</span>(*<span class="var">w</span>) ||<br/>
<span class="in3"></span>*<span class="var">w</span> == <span class="str">'_'</span> || *<span class="var">w</span> == <span class="str">'$'</span> ||<br/>
<span class="in3"></span>*<span class="var">w</span> == <span class="str">'#'</span><br/>
<span class="in1"></span>)) {<br/>
<span class="in2"></span>++<span class="var">w</span>;<br/>
<span class="in1"></span>}<br/>
<span class="macro">@end(<span class="name">find identifier end</span>)</span><br/>
</code></div>
<ul><li>
Zeichen und Ziffern können einen Identifier bilden
</li><li>
Zusätzlich noch der Unterstrich und das Dollar-Zeichen
</li></ul>
</div>
<div><div>
<code>
<span class="macro">@def(<span class="name">process identifier</span>)</span><br/>
<span class="in1"></span><span class="type">std</span>::<span class="type">string</span> <span class="var">ident</span> {<span class="var">begin</span>, <span class="var">w</span>};<br/>
<span class="in1"></span><span class="var">begin</span> = <span class="var">w</span> - <span class="num">1</span>;<br/>
<span class="in1"></span><span class="fn">process_ident</span>(<br/>
<span class="in2"></span><span class="var">out</span>, <span class="var">ident</span>,<br/>
<span class="in2"></span><span class="var">w</span> != <span class="var">end</span> ? *<span class="var">w</span> : <span class="str">' '</span><br/>
<span class="in1"></span>);<br/>
<span class="macro">@end(<span class="name">process identifier</span>)</span><br/>
</code></div>
<ul><li>
<code><span class="var">begin</span></code> wird am Anfang gesetzt, da die Makro-Verarbeitung dieses ggf.
  korrigiert
</li><li>
Sonst wird der Identifier normal verarbeitet
</li><li>
Bei der normalen Verarbeitung ist wichtig, welches Zeichen dem
  Identifier folgt
</li></ul>
</div>
<div><div>
<code>
<span class="macro">@Add(<span class="name">includes</span>)</span><br/>
<span class="in1"></span><span class="keyword">#include</span> &lt;<span class="var">set</span>&gt;<br/>
<span class="macro">@end(<span class="name">includes</span>)</span><br/>
</code></div>
<ul><li>
Besondere Bezeichner werden in <code><span class="type">std</span>::<span class="var">set</span></code> abgelegt
</li></ul>
</div>
<div><div>
<code>
<span class="macro">@add(<span class="name">process code helper</span>)</span><br/>
<span class="in1"></span><span class="keyword">using</span> <span class="type">Set</span> = <span class="type">std</span>::<span class="var">set</span>&lt;<span class="type">std</span>::<span class="type">string</span>&gt;;<br/>
<br/>
<span class="in1"></span><span class="type">bool</span> <span class="fn">isKeyword</span>(<span class="type">const</span> <span class="type">std</span>::<span class="type">string</span> &amp;<span class="var">s</span>) {<br/>
<span class="in2"></span><span class="keyword">static</span> <span class="type">Set</span> <span class="var">reserved</span> {<br/>
<span class="in3"></span><span class="macro">@put(<span class="name">keywords</span>)</span><br/>
<span class="in2"></span>};<br/>
<span class="in2"></span><span class="keyword">return</span><br/>
<span class="in3"></span><span class="var">reserved</span>.<span class="fn">find</span>(<span class="var">s</span>) !=<br/>
<span class="in4"></span><span class="var">reserved</span>.<span class="fn">end</span>() ||<br/>
<span class="in5"></span>(<span class="var">s</span>.<span class="fn">size</span>() &amp;&amp; <span class="var">s</span>[<span class="num">0</span>] == <span class="str">'#'</span>);<br/>
<span class="in1"></span>}<br/>
<span class="macro">@end(<span class="name">process code helper</span>)</span><br/>
</code></div>
<ul><li>
Prüft ob ein Bezeichner ein reserviertes Schlüsselwort ist
</li></ul>
</div>
<div><div>
<code>
<span class="macro">@def(<span class="name">keywords</span>)</span><br/>
<span class="in1"></span><span class="str">"break"</span>, <span class="str">"case"</span>, <span class="str">"catch"</span>, <span class="str">"continue"</span>,<br/>
<span class="in1"></span><span class="str">"default"</span>, <span class="str">"delete"</span>, <span class="str">"else"</span>, <span class="str">"for"</span>,<br/>
<span class="in1"></span><span class="str">"if"</span>, <span class="str">"in"</span>, <span class="str">"new"</span>, <span class="str">"return"</span>, <span class="str">"static"</span>,<br/>
<span class="in1"></span><span class="str">"switch"</span>, <span class="str">"try"</span>, <span class="str">"typeof"</span>, <span class="str">"while"</span>,<br/>
<span class="in1"></span><span class="str">"class"</span>, <span class="str">"public"</span>, <span class="str">"private"</span>,<br/>
<span class="in1"></span><span class="str">"template"</span>, <span class="str">"typename"</span>, <span class="str">"using"</span>,<br/>
<span class="in1"></span><span class="str">"function"</span><br/>
<span class="macro">@end(<span class="name">keywords</span>)</span><br/>
</code></div>
<ul><li>
Reservierte Schlüsselwörter
</li></ul>
</div>
<div><div>
<code>
<span class="macro">@add(<span class="name">process code helper</span>)</span><br/>
<span class="in1"></span><span class="type">bool</span> <span class="fn">isType</span>(<span class="type">const</span> <span class="type">std</span>::<span class="type">string</span> &amp;<span class="var">s</span>) {<br/>
<span class="in2"></span><span class="macro">@put(<span class="name">is type</span>)</span>;<br/>
<span class="in2"></span><span class="keyword">return</span> <span class="num">false</span>;<br/>
<span class="in1"></span>}<br/>
<span class="macro">@end(<span class="name">process code helper</span>)</span><br/>
</code></div>
<ul><li>
Prüft, ob ein Bezeichner ein Typ ist
</li></ul>
</div>
<div><div>
<code>
<span class="macro">@def(<span class="name">is type</span>)</span><br/>
<span class="in1"></span><span class="keyword">static</span> <span class="type">Set</span> <span class="var">reserved</span> {<br/>
<span class="in2"></span><span class="macro">@put(<span class="name">types</span>)</span><br/>
<span class="in1"></span>};<br/>
<span class="in1"></span><span class="keyword">if</span> (<span class="var">reserved</span>.<span class="fn">find</span>(<span class="var">s</span>) !=<br/>
<span class="in2"></span><span class="var">reserved</span>.<span class="fn">end</span>()<br/>
<span class="in1"></span>) {<br/>
<span class="in2"></span><span class="keyword">return</span> <span class="num">true</span>;<br/>
<span class="in1"></span>}<br/>
<span class="macro">@end(<span class="name">is type</span>)</span><br/>
</code></div>
<ul><li>
Wenn der Bezeichner ein reservierter Typ ist, liefert die Funktion
  <code><span class="num">true</span></code>
</li></ul>
</div>
<div><div>
<code>
<span class="macro">@def(<span class="name">types</span>)</span><br/>
<span class="in1"></span><span class="str">"FILE"</span>, <span class="str">"auto"</span>, <span class="str">"bool"</span>, <span class="str">"char"</span>,<br/>
<span class="in1"></span><span class="str">"const"</span>, <span class="str">"enum"</span>, <span class="str">"extern"</span>, <span class="str">"int"</span>,<br/>
<span class="in1"></span><span class="str">"let"</span>, <span class="str">"long"</span>, <span class="str">"signed"</span>, <span class="str">"struct"</span>,<br/>
<span class="in1"></span><span class="str">"union"</span>, <span class="str">"unsigned"</span>, <span class="str">"void"</span>, <span class="str">"double"</span>,<br/>
<span class="in1"></span><span class="str">"string"</span>, <span class="str">"std"</span><br/>
<span class="macro">@end(<span class="name">types</span>)</span><br/>
</code></div>
<ul><li>
Reservierte Typen
</li></ul>
</div>
<div><div>
<code>
<span class="macro">@add(<span class="name">is type</span>)</span><br/>
<span class="in1"></span><span class="keyword">if</span> (<span class="var">s</span>.<span class="fn">size</span>() &gt;= <span class="num">2</span>) {<br/>
<span class="in2"></span><span class="keyword">if</span> (<span class="fn">isupper</span>(<span class="var">s</span>[<span class="num">0</span>]) &amp;&amp;<br/>
<span class="in3"></span><span class="fn">islower</span>(<span class="var">s</span>[<span class="num">1</span>])<br/>
<span class="in2"></span>) {<br/>
<span class="in3"></span><span class="keyword">return</span> <span class="num">true</span>;<br/>
<span class="in2"></span>}<br/>
<span class="in1"></span>}<br/>
<span class="macro">@end(<span class="name">is type</span>)</span><br/>
</code></div>
<ul><li>
Ein Bezeichner ist zusätzlich ein Typ, wenn das sei erstes Zeichen
  groß geschrieben ist
</li><li>
und das zweite Zeichen klein geschrieben ist
</li></ul>
</div>
<div><div>
<code>
<span class="macro">@add(<span class="name">process code helper</span>)</span><br/>
<span class="in1"></span><span class="type">bool</span> <span class="fn">isNum</span>(<span class="type">const</span> <span class="type">std</span>::<span class="type">string</span> &amp;<span class="var">s</span>) {<br/>
<span class="in2"></span><span class="keyword">static</span> <span class="type">Set</span> <span class="var">reserved</span> {<br/>
<span class="in3"></span><span class="str">"EOF"</span>, <span class="str">"NULL"</span>, <span class="str">"nullptr"</span>,<br/>
<span class="in3"></span><span class="str">"false"</span>, <span class="str">"null"</span>, <span class="str">"true"</span>,<br/>
<span class="in3"></span><span class="str">"undefined"</span><br/>
<span class="in2"></span>};<br/>
<span class="in2"></span><span class="keyword">if</span> (<span class="type">std</span>::<span class="fn">isdigit</span>(<span class="var">s</span>[<span class="num">0</span>])) {<br/>
<span class="in3"></span><span class="keyword">return</span> <span class="num">true</span>;<br/>
<span class="in2"></span>}<br/>
<span class="in2"></span><span class="keyword">return</span> <span class="var">reserved</span>.<span class="fn">find</span>(<span class="var">s</span>) !=<br/>
<span class="in3"></span><span class="var">reserved</span>.<span class="fn">end</span>();<br/>
<span class="in1"></span>}<br/>
<span class="macro">@end(<span class="name">process code helper</span>)</span><br/>
</code></div>
<ul><li>
Ein Bezeichner ist eine Zahl, wenn er mit einer Ziffer beginnt
</li><li>
Oder wenn er einen reservierten Namen hat
</li></ul>
</div>
<div><div>
<code>
<span class="macro">@add(<span class="name">process code helper</span>)</span><br/>
<span class="in1"></span><span class="type">void</span> <span class="fn">process_ident</span>(<br/>
<span class="in2"></span><span class="type">std</span>::<span class="var">ostream</span> &amp;<span class="var">out</span>,<br/>
<span class="in2"></span><span class="type">const</span> <span class="type">std</span>::<span class="type">string</span> <span class="var">ident</span>,<br/>
<span class="in2"></span><span class="type">char</span> <span class="var">w</span><br/>
<span class="in1"></span>) {<br/>
<span class="in2"></span><span class="keyword">if</span> (<span class="fn">isKeyword</span>(<span class="var">ident</span>)) {<br/>
<span class="in3"></span><span class="fn">span_str</span>(<span class="var">out</span>, <span class="str">"keyword"</span>, <span class="var">ident</span>);<br/>
<span class="in2"></span>} <span class="keyword">else</span> <span class="keyword">if</span> (<span class="var">w</span> == <span class="str">'('</span>) {<br/>
<span class="in3"></span><span class="fn">span_str</span>(<span class="var">out</span>, <span class="str">"fn"</span>, <span class="var">ident</span>);<br/>
<span class="in2"></span><span class="macro">@put(<span class="name">special ident classes</span>)</span><br/>
<span class="in2"></span>} <span class="keyword">else</span> {<br/>
<span class="in3"></span><span class="fn">span_str</span>(<span class="var">out</span>, <span class="str">"var"</span>, <span class="var">ident</span>);<br/>
<span class="in2"></span>}<br/>
<span class="in1"></span>}<br/>
<span class="macro">@end(<span class="name">process code helper</span>)</span><br/>
</code></div>
<ul><li>
Ein Bezeichner, dem eine öffnende Klammer folgt, wird immer als
  Funktion dargestellt
</li><li>
Wenn keine andere Regel greift, wird der Bezeichner als Variable
  formatiert
</li></ul>
</div>
<div><div>
<code>
<span class="macro">@def(<span class="name">special ident classes</span>)</span><br/>
<span class="in1"></span>} <span class="keyword">else</span> <span class="keyword">if</span> (<span class="fn">isType</span>(<span class="var">ident</span>)) {<br/>
<span class="in2"></span><span class="fn">span_str</span>(<span class="var">out</span>, <span class="str">"type"</span>, <span class="var">ident</span>);<br/>
<span class="in1"></span>} <span class="keyword">else</span> <span class="keyword">if</span> (<span class="fn">isNum</span>(<span class="var">ident</span>)) {<br/>
<span class="in2"></span><span class="fn">span_str</span>(<span class="var">out</span>, <span class="str">"num"</span>, <span class="var">ident</span>);<br/>
<span class="macro">@end(<span class="name">special ident classes</span>)</span><br/>
</code></div>
<ul><li>
Schlüsselwörter, Typen und Zahlen werden durch die Hilfsfunktionen
  identifiziert
</li></ul>
</div>
<div><div>
<code>
<span class="macro">@add(<span class="name">process code helper</span>)</span><br/>
<span class="in1"></span><span class="type">void</span> <span class="fn">writeMacroClass</span>(<br/>
<span class="in2"></span><span class="type">std</span>::<span class="var">ostream</span> &amp;<span class="var">out</span>,<br/>
<span class="in2"></span><span class="type">const</span> <span class="type">char</span> *<span class="var">name</span><br/>
<span class="in1"></span>) {<br/>
<span class="in2"></span><span class="var">out</span> &lt;&lt; <span class="str">"&lt;span class=\""</span> &lt;&lt;<br/>
<span class="in3"></span><span class="var">name</span> &lt;&lt; <span class="str">"\"&gt;"</span>;<br/>
<span class="in1"></span>}<br/>
<span class="macro">@end(<span class="name">process code helper</span>)</span><br/>
</code></div>
<ul><li>
Öffnet ein <code>&lt;<span class="var">span</span>&gt;</code>-Tag mit einer bestimmten Klasse
</li></ul>
</div>
<div><div>
<code>
<span class="macro">@add(<span class="name">process code helper</span>)</span><br/>
<span class="in1"></span><span class="type">void</span> <span class="fn">writeMacroHeader</span>(<br/>
<span class="in2"></span><span class="type">std</span>::<span class="var">ostream</span> &amp;<span class="var">out</span>,<br/>
<span class="in2"></span><span class="type">const</span> <span class="type">std</span>::<span class="type">string</span> &amp;<span class="var">name</span><br/>
<span class="in1"></span>) {<br/>
<span class="in2"></span><span class="fn">writeMacroClass</span>(<span class="var">out</span>, <span class="str">"macro"</span>);<br/>
<span class="in2"></span><span class="var">out</span> &lt;&lt; <span class="str">'@'</span> &lt;&lt; <span class="var">name</span> &lt;&lt; <span class="str">"(&lt;span class=\"name\"&gt;"</span>;<br/>
<span class="in1"></span>}<br/>
<span class="macro">@end(<span class="name">process code helper</span>)</span><br/>
</code></div>
<ul><li>
Öffnet ein Makro mit einem bestimmetn Namen
</li></ul>
</div>
</div>
<h1>Notizen</h1>
<div class="slides">
<div><div>
<h1>Notizen</h1>
</div>
<ul><li>
Zu den Folien können Notizen mit <code>*</code> markiert werden
</li><li>
Notizen sind Teil einer Seite, aber nicht Teil einer Folie
</li></ul>
</div>
<div><div>
<code>
<span class="macro">@add(<span class="name">html state enums</span>)</span><br/>
<span class="in1"></span>, <span class="var">inNotes</span><br/>
<span class="macro">@end(<span class="name">html state enums</span>)</span><br/>
</code></div>
<ul><li>
Notizen sind ein eigener Zustand
</li><li>
Da sie mehrzeilig sein können
</li></ul>
</div>
<div><div>
<code>
<span class="macro">@add(<span class="name">process line</span>)</span><br/>
<span class="in1"></span><span class="keyword">if</span> (<br/>
<span class="in2"></span><span class="var">line</span>[<span class="num">0</span>] == <span class="str">'*'</span> ||<br/>
<span class="in2"></span><span class="var">status</span>.<span class="var">state</span> == <span class="type">HtmlState</span>::<span class="var">inNotes</span><br/>
<span class="in1"></span>) {<br/>
<span class="in2"></span><span class="macro">@put(<span class="name">process note</span>)</span>;<br/>
<span class="in2"></span><span class="keyword">continue</span>;<br/>
<span class="in1"></span>}<br/>
<span class="macro">@end(<span class="name">process line</span>)</span><br/>
</code></div>
<ul><li>
Eine Notiz beginnt entweder mit <code>*</code> oder folgt einer solchen Zeile
</li></ul>
</div>
<div><div>
<code>
<span class="macro">@def(<span class="name">close specials</span>)</span><br/>
<span class="in1"></span><span class="keyword">if</span> (<br/>
<span class="in2"></span><span class="var">status</span>.<span class="var">state</span> == <span class="type">HtmlState</span>::<span class="var">inNotes</span><br/>
<span class="in1"></span>) {<br/>
<span class="in2"></span><span class="var">out</span> &lt;&lt; <span class="str">"&lt;/li&gt;&lt;/ul&gt;\n"</span>;<br/>
<span class="in1"></span>}<br/>
<span class="macro">@end(<span class="name">close specials</span>)</span><br/>
</code></div>
<ul><li>
Bei einer Leerzeile werden Notizen beendet
</li></ul>
</div>
<div><div>
<code>
<span class="macro">@def(<span class="name">process note</span>)</span><br/>
<span class="in1"></span><span class="keyword">if</span> (<span class="var">line</span>[<span class="num">0</span>] == <span class="str">'*'</span>) {<br/>
<span class="in2"></span><span class="macro">@put(<span class="name">process note line</span>)</span>;<br/>
<span class="in1"></span>} <span class="keyword">else</span> {<br/>
<span class="in2"></span><span class="fn">process_content</span>(<br/>
<span class="in3"></span><span class="var">out</span>, <span class="var">line</span>.<span class="fn">begin</span>(), <span class="var">line</span>.<span class="fn">end</span>()<br/>
<span class="in2"></span>);<br/>
<span class="in2"></span><span class="var">out</span> &lt;&lt; <span class="str">'\n'</span>;<br/>
<span class="in1"></span>}<br/>
<span class="macro">@end(<span class="name">process note</span>)</span><br/>
</code></div>
<ul><li>
Notizen die mit <code>*</code> beginnen, müssen eine neue Notiz einleiten
</li><li>
Folge-Zeilen werden direkt ausgegeben
</li></ul>
</div>
<div><div>
<code>
<span class="macro">@def(<span class="name">process note line</span>)</span><br/>
<span class="in1"></span><span class="type">auto</span> <span class="var">end</span> = <span class="var">line</span>.<span class="fn">end</span>();<br/>
<span class="in1"></span><span class="type">auto</span> <span class="var">begin</span> = <span class="var">line</span>.<span class="fn">begin</span>() + <span class="num">1</span>;<br/>
<span class="in1"></span><span class="keyword">while</span> (<br/>
<span class="in2"></span><span class="var">begin</span> != <span class="var">end</span> &amp;&amp; *<span class="var">begin</span> == <span class="str">' '</span><br/>
<span class="in1"></span>) {<br/>
<span class="in2"></span>++<span class="var">begin</span>;<br/>
<span class="in1"></span>}<br/>
<span class="macro">@end(<span class="name">process note line</span>)</span><br/>
</code></div>
<ul><li>
Die Funktion überspringt den Stern und folgende Leerzeichen
</li></ul>
</div>
<div><div>
<code>
<span class="macro">@add(<span class="name">process note line</span>)</span><br/>
<span class="in1"></span><span class="keyword">if</span> (<br/>
<span class="in2"></span><span class="var">status</span>.<span class="var">state</span> != <span class="type">HtmlState</span>::<span class="var">inNotes</span><br/>
<span class="in1"></span>) {<br/>
<span class="in2"></span><span class="macro">@put(<span class="name">switch into note mode</span>)</span>;<br/>
<span class="in1"></span>} <span class="keyword">else</span> {<br/>
<span class="in2"></span><span class="var">out</span> &lt;&lt; <span class="str">"&lt;/li&gt;&lt;li&gt;\n"</span>;<br/>
<span class="in1"></span>}<br/>
<span class="in1"></span><span class="fn">process_content</span>(<span class="var">out</span>, <span class="var">begin</span>, <span class="var">end</span>);<br/>
<span class="in1"></span><span class="var">out</span> &lt;&lt; <span class="str">'\n'</span>;<br/>
<span class="macro">@end(<span class="name">process note line</span>)</span><br/>
</code></div>
<ul><li>
Wenn noch keine Notizen geschrieben wurden, wird in den Notizen Modus
  gewechselt
</li><li>
Andernfalls wird nur eine neue Notiz geöffnet
</li></ul>
</div>
<div><div>
<code>
<span class="macro">@def(<span class="name">switch into note mode</span>)</span><br/>
<span class="in1"></span><span class="keyword">if</span> (<br/>
<span class="in2"></span><span class="var">status</span>.<span class="var">state</span> != <span class="type">HtmlState</span>::<span class="var">inSlide</span><br/>
<span class="in1"></span>) {<br/>
<span class="in2"></span><span class="var">out</span> &lt;&lt; <span class="str">"&lt;div&gt;\n"</span>;<br/>
<span class="in1"></span>}<br/>
<span class="in1"></span><span class="var">status</span>.<span class="var">state</span> = <span class="type">HtmlState</span>::<span class="var">inNotes</span>;<br/>
<span class="in1"></span><span class="var">out</span> &lt;&lt; <span class="str">"&lt;ul&gt;&lt;li&gt;\n"</span>;<br/>
<span class="macro">@end(<span class="name">switch into note mode</span>)</span><br/>
</code></div>
<ul><li>
Notizen können nur auf einer Seite erscheinen
</li><li>
Wenn noch keine Seite offen ist, dann öffnet die Funktion eine Seite
</li><li>
Die Funktion schreibt passende HTML-Tags
</li></ul>
</div>
<div><div>
<code>
<span class="macro">@def(<span class="name">process content line</span>)</span><br/>
<span class="in1"></span><span class="keyword">for</span>(; <span class="var">begin</span> != <span class="var">end</span>; ++<span class="var">begin</span>) {<br/>
<span class="in2"></span><span class="macro">@put(<span class="name">special content line</span>)</span>;<br/>
<span class="in2"></span><span class="fn">writeOneEscaped</span>(<span class="var">out</span>, *<span class="var">begin</span>);<br/>
<span class="in1"></span>}<br/>
<span class="macro">@end(<span class="name">process content line</span>)</span><br/>
</code></div>
<ul><li>
Die Zeile wird Zeichen für Zeichen abgearbeitet
</li><li>
Wenn keine Sonderbehandlung erfolgt, wird das Zeichen ausgegeben
</li></ul>
</div>
<div><div>
<code>
<span class="macro">@def(<span class="name">special content line</span>)</span><br/>
<span class="in1"></span><span class="keyword">if</span> (*<span class="var">begin</span> == <span class="str">'`'</span>) {<br/>
<span class="in2"></span><span class="macro">@put(<span class="name">inline code</span>)</span>;<br/>
<span class="in1"></span>}<br/>
<span class="macro">@end(<span class="name">special content line</span>)</span><br/>
</code></div>
<ul><li>
Ein Backtick signalisiert eingeschobene Code-Schnippsel
</li></ul>
</div>
<div><div>
<code>
<span class="macro">@def(<span class="name">inline code</span>)</span><br/>
<span class="in1"></span><span class="type">auto</span> <span class="var">w</span> = <span class="var">begin</span> + <span class="num">1</span>;<br/>
<span class="in1"></span><span class="keyword">while</span> (<span class="var">w</span> != <span class="var">end</span> &amp;&amp; *<span class="var">w</span> != <span class="str">'`'</span>) {<br/>
<span class="in2"></span>++<span class="var">w</span>;<br/>
<span class="in1"></span>}<br/>
<span class="in1"></span><span class="keyword">if</span> (<span class="var">w</span> != <span class="var">end</span>) {<br/>
<span class="in2"></span><span class="var">out</span> &lt;&lt; <span class="str">"&lt;code&gt;"</span>;<br/>
<span class="in2"></span><span class="fn">process_code</span>(<span class="var">out</span>, <span class="var">begin</span> + <span class="num">1</span>, <span class="var">w</span>);<br/>
<span class="in2"></span><span class="var">out</span> &lt;&lt; <span class="str">"&lt;/code&gt;"</span>;<br/>
<span class="in2"></span><span class="var">begin</span> = <span class="var">w</span>;<br/>
<span class="in2"></span><span class="keyword">continue</span>;<br/>
<span class="in1"></span>}<br/>
<span class="macro">@end(<span class="name">inline code</span>)</span><br/>
</code></div>
<ul><li>
Eingeschobene Code-Schnippsel werden ebenfalls mit <code><span class="fn">process_code</span></code>
  formatiert
</li></ul>
</div>
<div><div>
<code>
<span class="macro">@add(<span class="name">special content line</span>)</span><br/>
<span class="in1"></span><span class="keyword">if</span> (<br/>
<span class="in2"></span>*<span class="var">begin</span> == <span class="str">'*'</span> &amp;&amp;<br/>
<span class="in2"></span>(<span class="var">begin</span> + <span class="num">1</span>) != <span class="var">end</span> &amp;&amp;<br/>
<span class="in2"></span>*(<span class="var">begin</span> + <span class="num">1</span>) == <span class="str">'*'</span><br/>
<span class="in1"></span>) {<br/>
<span class="in2"></span><span class="macro">@put(<span class="name">bold block</span>)</span>;<br/>
<span class="in1"></span>}<br/>
<span class="macro">@end(<span class="name">special content line</span>)</span><br/>
</code></div>
<ul><li>
Zwei Sterne markieren den Start eines fetten Textes
</li></ul>
</div>
<div><div>
<code>
<span class="macro">@def(<span class="name">bold block</span>)</span><br/>
<span class="in1"></span><span class="type">auto</span> <span class="var">w</span> = <span class="var">begin</span> + <span class="num">2</span>;<br/>
<span class="in1"></span><span class="keyword">while</span> (<br/>
<span class="in2"></span><span class="var">w</span> != <span class="var">end</span> &amp;&amp; (<span class="var">w</span> + <span class="num">1</span>) != <span class="var">end</span> &amp;&amp;<br/>
<span class="in2"></span>(*<span class="var">w</span> != <span class="str">'*'</span> || *(<span class="var">w</span> + <span class="num">1</span>) != <span class="str">'*'</span>)<br/>
<span class="in1"></span>) {<br/>
<span class="in2"></span>++<span class="var">w</span>;<br/>
<span class="in1"></span>}<br/>
<span class="macro">@end(<span class="name">bold block</span>)</span><br/>
</code></div>
<ul><li>
Funktion sucht zwei weitere Sterne
</li></ul>
</div>
<div><div>
<code>
<span class="macro">@add(<span class="name">bold block</span>)</span><br/>
<span class="in1"></span><span class="keyword">if</span> (<br/>
<span class="in2"></span><span class="var">w</span> != <span class="var">end</span> &amp;&amp; (<span class="var">w</span> + <span class="num">1</span> ) != <span class="var">end</span> &amp;&amp;<br/>
<span class="in2"></span>*<span class="var">w</span> == <span class="str">'*'</span> &amp;&amp; *(<span class="var">w</span> + <span class="num">1</span>) == <span class="str">'*'</span><br/>
<span class="in1"></span>) {<br/>
<span class="in2"></span><span class="macro">@put(<span class="name">do bold</span>)</span>;<br/>
<span class="in2"></span><span class="keyword">continue</span>;<br/>
<span class="in1"></span>}<br/>
<span class="macro">@end(<span class="name">bold block</span>)</span><br/>
</code></div>
<ul><li>
Wenn Ende-Markierung gefunden wurde, wird der Text dazwischen fett
  formatiert
</li></ul>
</div>
<div><div>
<code>
<span class="macro">@def(<span class="name">do bold</span>)</span><br/>
<span class="in1"></span><span class="var">out</span> &lt;&lt; <span class="str">"&lt;b&gt;"</span>;<br/>
<span class="in1"></span><span class="fn">writeEscaped</span>(<br/>
<span class="in2"></span><span class="var">out</span>, <span class="type">std</span>::<span class="type">string</span> {<span class="var">begin</span> + <span class="num">2</span>, <span class="var">w</span>}<br/>
<span class="in1"></span>);<br/>
<span class="in1"></span><span class="var">out</span> &lt;&lt; <span class="str">"&lt;/b&gt;"</span>;<br/>
<span class="in1"></span><span class="var">begin</span> = <span class="var">w</span> + <span class="num">1</span>;<br/>
<span class="macro">@end(<span class="name">do bold</span>)</span><br/>
</code></div>
<ul><li>
Formatiert Text fett
</li></ul>
</div>
</div>
<h1>Absätze</h1>
<div class="slides">
<div><div>
<h1>Absätze</h1>
</div>
<ul><li>
Zwischen Folien verarbeitet <code><span class="var">hex</span></code> Absätze mit normalen Text
</li></ul>
</div>
<div><div>
<code>
<span class="macro">@add(<span class="name">html state enums</span>)</span><br/>
<span class="in1"></span>, <span class="var">inPara</span><br/>
<span class="macro">@end(<span class="name">html state enums</span>)</span><br/>
</code></div>
<ul><li>
Absätze sind ein eigener Zustand
</li><li>
Da sie mehrzeilig sein können
</li></ul>
</div>
<div><div>
<code>
<span class="macro">@add(<span class="name">process line</span>)</span><br/>
<span class="in1"></span><span class="macro">@put(<span class="name">process para</span>)</span>;<br/>
<span class="macro">@end(<span class="name">process line</span>)</span><br/>
</code></div>
<ul><li>
Wenn nichts anderes bearbeitet wurde, dann verarbeitet der Renderer
  einen Absatz
</li></ul>
</div>
<div><div>
<code>
<span class="macro">@add(<span class="name">close specials</span>)</span><br/>
<span class="in1"></span><span class="keyword">if</span> (<br/>
<span class="in2"></span><span class="var">status</span>.<span class="var">state</span> == <span class="type">HtmlState</span>::<span class="var">inPara</span><br/>
<span class="in1"></span>) {<br/>
<span class="in2"></span><span class="var">out</span> &lt;&lt; <span class="str">"&lt;/p&gt;\n"</span>;<br/>
<span class="in2"></span><span class="var">status</span>.<span class="var">state</span> =<br/>
<span class="in3"></span><span class="type">HtmlState</span>::<span class="var">afterSlides</span>;<br/>
<span class="in1"></span>}<br/>
<span class="macro">@end(<span class="name">close specials</span>)</span><br/>
</code></div>
<ul><li>
Bei einer Leerzeile werden Absätze beendet beendet
</li></ul>
</div>
<div><div>
<code>
<span class="macro">@def(<span class="name">process para</span>)</span><br/>
<span class="in1"></span><span class="keyword">if</span> (<span class="var">status</span>.<span class="var">state</span> == <span class="type">HtmlState</span>::<span class="var">afterSlide</span>) {<br/>
<span class="in2"></span><span class="var">out</span> &lt;&lt; <span class="str">"&lt;/div&gt;\n"</span>;<br/>
<span class="in1"></span>}<br/>
<span class="in1"></span><span class="keyword">if</span> (<br/>
<span class="in2"></span><span class="var">status</span>.<span class="var">state</span> != <span class="type">HtmlState</span>::<span class="var">inPara</span><br/>
<span class="in1"></span>) {<br/>
<span class="in2"></span><span class="var">out</span> &lt;&lt; <span class="str">"&lt;p&gt;"</span>;<br/>
<span class="in2"></span><span class="var">status</span>.<span class="var">state</span> = <span class="type">HtmlState</span>::<span class="var">inPara</span>;<br/>
<span class="in1"></span>}<br/>
<span class="in1"></span><span class="fn">process_content</span>(<br/>
<span class="in2"></span><span class="var">out</span>, <span class="var">line</span>.<span class="fn">begin</span>(), <span class="var">line</span>.<span class="fn">end</span>()<br/>
<span class="in1"></span>);<br/>
<span class="in1"></span><span class="var">out</span> &lt;&lt; <span class="str">'\n'</span>;<br/>
<span class="macro">@end(<span class="name">process para</span>)</span><br/>
</code></div>
<ul><li>
Am Anfang wird ein Absatz geöffnet
</li><li>
Danach gibt <code><span class="var">hex</span></code> die Zeilen aus
</li></ul>
</div>
</body>
</html>
