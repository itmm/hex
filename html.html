<!doctype html>
<html lang="de"l>
<head>
<meta charset="utf-8">
<title>HTML-Präsentation generieren</title><link rel="stylesheet" type="text/css" href="slides/slides.css"></head>
<body>
<h1>HTML-Präsentation generieren</h1>
<div class="slides">
<div><div>
<h1>HTML-Präsentation generieren</h1>
</div>

<ul><li>
 Diese Datei beschreibt Code, um aus den <code>x</code>-Quelldateien
  HTML-Präsentationen zu erzeugen
</li></ul></div>

<div><div>
<code>

<span class="add">@globdef(<span class="name">write HTML file</span>)</span><br/>

<span class="in1"></span><span class="keyword">for</span> (<span class="var">auto</span> &amp;<span class="var">cur</span> : <span class="var">used</span>) {<br/>

<span class="in2"></span><span class="expand">@expand(<span class="name">write cur HTML file</span>)</span>;<br/>

<span class="in1"></span>}<br/>

<span class="in1"></span><span class="var">used</span>.<span class="fn">clear</span>();<br/>

<span class="end">@end(<span class="name">write HTML file</span>)</span><br/>

</code>
</div>

<ul><li>
 Alle bisher prozessierten Dateien werden erneut durchgegangen
</li><li>
 Nach der Abarbeitung einer Datei wird deren Speicher freigegeben
</li></ul></div>

<div><div>
<code>

<span class="add">@def(<span class="name">write cur HTML file</span>)</span><br/>

<span class="in1"></span><span class="type">const</span> <span class="var">std</span>::<span class="var">string</span> &amp;<span class="var">name</span> = <span class="var">cur</span>-&gt;<span class="var">name</span>;<br/>

<span class="in1"></span><span class="var">std</span>::<span class="var">string</span> <span class="var">outPath</span> =<br/>

<span class="in2"></span><span class="var">name</span>.<span class="fn">substr</span>(<span class="num">0</span>, <span class="var">name</span>.<span class="fn">size</span>() - <span class="num">2</span>) +<br/>

<span class="in2"></span><span class="str">".html"</span>;<br/>

<span class="in1"></span><span class="type">FILE</span> *<span class="var">out</span> = <span class="fn">fopen</span>(<span class="var">outPath</span>.<span class="fn">c_str</span>(), <span class="str">"w"</span>);<br/>

<span class="in1"></span><span class="fn">ASSERT</span>(<span class="var">out</span>);<br/>

<span class="in1"></span><span class="expand">@expand(<span class="name">write cur HTML file to out</span>)</span>;<br/>

<span class="in1"></span><span class="fn">fclose</span>(<span class="var">out</span>);<br/>

<span class="end">@end(<span class="name">write cur HTML file</span>)</span><br/>

</code>
</div>

<ul><li>
 Die HTML hat den gleichen Pfad mit der Endung <code>.html</code> anstatt <code>.x</code>
</li></ul></div>

<div><div>
<code>

<span class="add">@def(<span class="name">write cur HTML file to out</span>)</span> <br/>

<span class="in1"></span><span class="type">FILE</span> *<span class="keyword">in</span> = <span class="fn">fopen</span>(<span class="var">cur</span>-&gt;<span class="var">name</span>.<span class="fn">c_str</span>(), <span class="str">"r"</span>);<br/>

<span class="in1"></span><span class="fn">ASSERT</span>(<span class="keyword">in</span>);<br/>

<span class="in1"></span><span class="expand">@expand(<span class="name">write HTML file from in to out</span>)</span>;<br/>

<span class="in1"></span><span class="fn">fclose</span>(<span class="keyword">in</span>);<br/>

<span class="end">@end(<span class="name">write cur HTML file to out</span>)</span><br/>

</code>
</div>

<ul><li>
 Zuerst wird die Eingabe-Datei zum Lesen geöffnet
</li></ul></div>

<div><div>
<code>

<span class="add">@globadd(<span class="name">global elements</span>)</span><br/>

<span class="in1"></span><span class="type">enum</span> <span class="var">class</span> <span class="type">HtmlState</span> {<br/>

<span class="in2"></span><span class="var">nothingWritten</span>,<br/>

<span class="in2"></span><span class="var">inSlide</span>,<br/>

<span class="var">afterSlide</span><br/>

<span class="in4"></span><span class="expand">@expand(<span class="name">html state enums</span>)</span><br/>

<span class="in1"></span>};<br/>

<span class="end">@end(<span class="name">global elements</span>)</span><br/>

</code>
</div>

<ul><li>
 In einem Zustands-Automaten wird abgelegt, in welchem Modus sich die
  gerade generierte HTML-Datei befindet
</li><li>
 Vor dem ersten Element muss der HTML-Header geschrieben werden
</li><li>
 Ansonsten wird unterschieden, ob eine Folie bereits geöffnet wurde
</li><li>
 Oder ob gerade keine Folie offen ist
</li></ul></div>

<div><div>
<code>

<span class="add">@globadd(<span class="name">global elements</span>)</span><br/>

<span class="in1"></span><span class="type">struct</span> <span class="type">HtmlStatus</span> {<br/>

<span class="in2"></span><span class="expand">@expand(<span class="name">html state elements</span>)</span><br/>

<span class="in1"></span>};<br/>

<span class="end">@end(<span class="name">global elements</span>)</span><br/>

</code>
</div>

<ul><li>
 Der aktuelle Status wird in <code>HtmlStatus</code> abgelegt
</li></ul></div>

<div><div>
<code>

<span class="add">@def(<span class="name">html state elements</span>)</span><br/>

<span class="in1"></span><span class="fn">HtmlStatus</span>();<br/>

<span class="in1"></span><span class="type">HtmlState</span> <span class="var">state</span>;<br/>

<span class="end">@end(<span class="name">html state elements</span>)</span><br/>

</code>
</div>

<ul><li>
 Der aktuelle Zustand wird im Status abgelegt
</li></ul></div>

<div><div>
<code>

<span class="add">@globadd(<span class="name">global elements</span>)</span><br/>

<span class="in1"></span><span class="var">inline</span> <span class="type">HtmlStatus</span>::<span class="fn">HtmlStatus</span>():<br/>

<span class="in2"></span><span class="fn">state</span>(<span class="type">HtmlState</span>::<span class="var">nothingWritten</span>)<br/>

<span class="in2"></span><span class="expand">@expand(<span class="name">init html status</span>)</span><br/>

<span class="in1"></span>{ }<br/>

<span class="end">@end(<span class="name">global elements</span>)</span><br/>

</code>
</div>


</div>
<div><div>
<code>

<span class="add">@globadd(<span class="name">includes</span>)</span><br/>

<span class="in1"></span>#<span class="var">include</span> &lt;<span class="var">set</span>&gt;<br/>

<span class="in1"></span>#<span class="var">include</span> &lt;<span class="var">string</span>&gt;<br/>

<span class="end">@end(<span class="name">includes</span>)</span><br/>

</code>
</div>


</div>
<div><div>
<code>

<span class="add">@def(<span class="name">write HTML file from in to out</span>)</span> {<br/>

<span class="in1"></span><span class="type">HtmlStatus</span> <span class="var">status</span>;<br/>

<span class="in1"></span><span class="type">bool</span> <span class="var">newline</span> = <span class="num">true</span>;<br/>

<span class="in1"></span><span class="var">std</span>::<span class="var">string</span> <span class="var">ident</span>;<br/>

<span class="in1"></span><span class="keyword">for</span> (;;) {<br/>

<span class="in2"></span><span class="type">int</span> <span class="var">ch</span> = <span class="fn">fgetc</span>(<span class="keyword">in</span>);<br/>

<span class="in2"></span><span class="expand">@expand(<span class="name">process ch for HTML</span>)</span>;<br/>

<span class="in2"></span><span class="keyword">if</span> (<span class="var">ch</span> == <span class="num">EOF</span>) { <span class="keyword">break</span>; }<br/>

<span class="in2"></span><span class="expand">@multiple(<span class="name">move ch to last</span>)</span>;<br/>

<span class="in1"></span>}<br/>

} <span class="end">@end(<span class="name">write HTML file from in to out</span>)</span><br/>

</code>
</div>

<ul><li>
 Beim Schreiben einer Datei wird zuerst der Status initialisiert
</li><li>
 Wir befinden uns am Anfang einer Zeile
</li><li>
 Jedes Zeichen wird prozessiert
</li><li>
 Bis das Datei-Ende erreicht ist
</li></ul></div>

</div>
<h1>Überschriften</h1>
<div class="slides">
<div><div>
<h1>Überschriften</h1>
</div>


</div>
<div><div>
<code>

<span class="add">@def(<span class="name">html state enums</span>)</span><br/>

<span class="in1"></span>, <span class="var">inHeader</span><br/>

<span class="end">@end(<span class="name">html state enums</span>)</span><br/>

</code>
</div>

<ul><li>
 Es gibt einen eigenen Zustand, wenn eine Überschrift gelesen wird
</li></ul></div>

<div><div>
<code>

<span class="add">@def(<span class="name">move ch to last</span>)</span><br/>

<span class="in1"></span><span class="var">newline</span> = <span class="var">ch</span> == <span class="str">'\n'</span>;<br/>

<span class="in1"></span><span class="keyword">if</span> (<span class="var">status</span>.<span class="var">state</span> != <span class="type">HtmlState</span>::<span class="var">inHeader</span>) {<br/>

<span class="in2"></span><span class="type">char</span> <span class="var">xx</span> = <span class="var">ch</span>;<br/>

<span class="in2"></span><span class="fn">writeEscaped</span>(<span class="var">out</span>, &amp;<span class="var">xx</span>, &amp;<span class="var">xx</span> + <span class="num">1</span>);<br/>

<span class="in1"></span>}<br/>

<span class="end">@end(<span class="name">move ch to last</span>)</span><br/>

</code>
</div>

<ul><li>
 Beim Kopieren des Zeichens wird <code>EOF</code> durch <code>'\0'</code> ersetzt
</li></ul></div>

<div><div>
<code>

<span class="add">@globadd(<span class="name">global elements</span>)</span><br/>

<span class="in1"></span><span class="type">bool</span> <span class="fn">isOutOfHtmlSpecial</span>(<br/>

<span class="in2"></span><span class="type">HtmlStatus</span> *<span class="var">s</span><br/>

<span class="in1"></span>) {<br/>

<span class="in2"></span><span class="expand">@expand(<span class="name">check html special state</span>)</span>;<br/>

<span class="in2"></span><span class="keyword">return</span> <span class="num">true</span>;<br/>

<span class="in1"></span>}<br/>

<span class="end">@end(<span class="name">global elements</span>)</span><br/>

</code>
</div>

<ul><li>
 Die Funktion <code>{isOutOfHtmlSpecial}</code> liefert <code>true</code>, wenn sich
  der Zustands-Automat gerade nicht in einem Sonder-Modus (Überschrift,
  Code, Notizen) befindet
</li></ul></div>

<div><div>
<code>

<span class="add">@def(<span class="name">check html special state</span>)</span><br/>

<span class="in1"></span><span class="keyword">if</span> (<span class="var">s</span>-&gt;<span class="var">state</span> == <span class="type">HtmlState</span>::<span class="var">inHeader</span>) {<br/>

<span class="in2"></span><span class="keyword">return</span> <span class="num">false</span>;<br/>

<span class="in1"></span>}<br/>

<span class="end">@end(<span class="name">check html special state</span>)</span><br/>

</code>
</div>

<ul><li>
 Die Überschrift ist ein Sonder-Modus
</li></ul></div>

<div><div>
<code>

<span class="add">@add(<span class="name">html state elements</span>)</span><br/>

<span class="in1"></span><span class="type">int</span> <span class="var">headerLevel</span>;<br/>

<span class="in1"></span><span class="var">std</span>::<span class="var">string</span> <span class="var">headerName</span>;<br/>

<span class="in1"></span><span class="type">HtmlState</span> <span class="var">headerState</span>;<br/>

<span class="end">@end(<span class="name">html state elements</span>)</span><br/>

</code>
</div>

<ul><li>
 Für Überschriften wird abgelegt, auf welchem Level sie vorkommen
</li><li>
 Und der Titel der Überschrift wird gespeichert
</li><li>
 Und der Zustand in dem sich der Parser beim Auftreten der Überschrift
  befunden hat
</li></ul></div>

<div><div>
<code>

<span class="add">@def(<span class="name">init html status</span>)</span><br/>

<span class="in1"></span>, <span class="fn">headerLevel</span>(<span class="num">0</span>)<br/>

<span class="in1"></span>, <span class="fn">headerName</span>()<br/>

<span class="end">@end(<span class="name">init html status</span>)</span><br/>

</code>
</div>

<ul><li>
 Level und Name werden leer initialisiert
</li></ul></div>

<div><div>
<code>

<span class="add">@def(<span class="name">process ch for HTML</span>)</span> <br/>

<span class="in1"></span><span class="keyword">if</span> (<span class="var">ch</span> == <span class="str">'#'</span> &amp;&amp; <span class="var">newline</span>) {<br/>

<span class="in2"></span><span class="keyword">if</span> (<span class="fn">isOutOfHtmlSpecial</span>(&amp;<span class="var">status</span>) ||<br/>

<span class="in3"></span><span class="var">status</span>.<span class="var">state</span> == <span class="type">HtmlState</span>::<span class="var">inHeader</span><br/>

<span class="in2"></span>) {<br/>

<span class="in3"></span>++<span class="var">status</span>.<span class="var">headerLevel</span>;<br/>

<span class="in3"></span><span class="keyword">if</span> (<span class="var">status</span>.<span class="var">state</span> != <span class="type">HtmlState</span>::<span class="var">inHeader</span>) {<br/>

<span class="in4"></span><span class="var">status</span>.<span class="var">headerState</span> =<br/>

<span class="in5"></span><span class="var">status</span>.<span class="var">state</span>;<br/>

<span class="in3"></span>}<br/>

<span class="in3"></span><span class="var">status</span>.<span class="var">state</span> = <span class="type">HtmlState</span>::<span class="var">inHeader</span>;<br/>

<span class="in3"></span><span class="keyword">continue</span>;<br/>

<span class="in2"></span>}<br/>

<span class="in1"></span>}<br/>

<span class="end">@end(<span class="name">process ch for HTML</span>)</span><br/>

</code>
</div>

<ul><li>
 Wenn am Anfang einer Zeile eine Raute gelesen wird, dann beginnt eine
  Überschrift
</li><li>
 Solange weitere Rauten folgen, wird der Level erhöht
</li><li>
 Bei der ersten Raute muss der alte Zustand gesichert werden
</li></ul></div>

<div><div>
<code>

<span class="add">@add(<span class="name">process ch for HTML</span>)</span> <br/>

<span class="in1"></span><span class="keyword">if</span> (<span class="var">status</span>.<span class="var">state</span> == <span class="type">HtmlState</span>::<span class="var">inHeader</span>) {<br/>

<span class="in2"></span><span class="keyword">if</span> (<span class="var">ch</span> == <span class="str">'\n'</span>) {<br/>

<span class="in3"></span><span class="expand">@expand(<span class="name">process header in HTML</span>)</span>;<br/>

<span class="in3"></span><span class="expand">@expand(<span class="name">reset header state</span>)</span>;<br/>

<span class="in3"></span><span class="expand">@multiple(<span class="name">move ch to last</span>)</span>;<br/>

<span class="in3"></span><span class="keyword">continue</span>;<br/>

<span class="in2"></span>}<br/>

<span class="in1"></span>}<br/>

<span class="end">@end(<span class="name">process ch for HTML</span>)</span><br/>

</code>
</div>

<ul><li>
 Wenn die Zeile mit der Überschrift beendet wurde, wird die
  Überschrift ausgegeben
</li></ul></div>

<div><div>
<code>

<span class="add">@def(<span class="name">reset header state</span>)</span> <br/>

<span class="in1"></span><span class="var">status</span>.<span class="var">state</span> = <span class="type">HtmlState</span>::<span class="var">inSlide</span>;<br/>

<span class="in1"></span><span class="var">status</span>.<span class="var">headerLevel</span> = <span class="num">0</span>;<br/>

<span class="in1"></span><span class="var">status</span>.<span class="var">headerName</span>.<span class="fn">clear</span>();<br/>

<span class="in1"></span><span class="var">status</span>.<span class="var">headerState</span> = <span class="type">HtmlState</span>::<span class="var">inSlide</span>;<br/>

<span class="end">@end(<span class="name">reset header state</span>)</span><br/>

</code>
</div>

<ul><li>
 Beim Zurücksetzen des Zustands wird sichergestellt, das der Level und
  Name der Überschrift zurückgesetzt sind
</li></ul></div>

<div><div>
<code>

<span class="add">@add(<span class="name">process ch for HTML</span>)</span> <br/>

<span class="in1"></span><span class="keyword">if</span> (<span class="var">status</span>.<span class="var">state</span> == <span class="type">HtmlState</span>::<span class="var">inHeader</span>) {<br/>

<span class="in2"></span><span class="keyword">if</span> (! <span class="var">status</span>.<span class="var">headerName</span>.<span class="fn">empty</span>()) {<br/>

<span class="in3"></span><span class="var">status</span>.<span class="var">headerName</span>.<span class="fn">push_back</span>(<span class="var">ch</span>);<br/>

<span class="in3"></span><span class="expand">@multiple(<span class="name">move ch to last</span>)</span>;<br/>

<span class="in3"></span><span class="keyword">continue</span>;<br/>

<span class="in2"></span>}<br/>

<span class="in1"></span>}<br/>

<span class="end">@end(<span class="name">process ch for HTML</span>)</span><br/>

</code>
</div>

<ul><li>
 Innerhalb der Überschrift wird das aktuelle Zeichen zur Überschrift
  hinzugefügt
</li></ul></div>

<div><div>
<code>

<span class="add">@add(<span class="name">process ch for HTML</span>)</span> <br/>

<span class="in1"></span><span class="keyword">if</span> (<span class="var">status</span>.<span class="var">state</span> == <span class="type">HtmlState</span>::<span class="var">inHeader</span>) {<br/>

<span class="in2"></span><span class="keyword">if</span> (<span class="var">ch</span> &gt; <span class="str">' '</span> &amp;&amp; <span class="var">status</span>.<span class="var">headerName</span>.<span class="fn">empty</span>()) {<br/>

<span class="in3"></span><span class="var">status</span>.<span class="var">headerName</span>.<span class="fn">push_back</span>(<span class="var">ch</span>);<br/>

<span class="in3"></span><span class="expand">@multiple(<span class="name">move ch to last</span>)</span>;<br/>

<span class="in3"></span><span class="keyword">continue</span>;<br/>

<span class="in2"></span>}<br/>

<span class="in1"></span>}<br/>

<span class="end">@end(<span class="name">process ch for HTML</span>)</span><br/>

</code>
</div>

<ul><li>
 Leerzeichen zwischen den Rauten und der Überschrift werden ignoriert
</li></ul></div>

<div><div>
<code>

<span class="add">@def(<span class="name">process header in HTML</span>)</span> <br/>

<span class="in1"></span><span class="fn">ASSERT</span>(! <span class="var">status</span>.<span class="var">headerName</span>.<span class="fn">empty</span>());<br/>

<span class="in1"></span><span class="expand">@expand(<span class="name">close previous HTML page</span>)</span>;<br/>

<span class="in1"></span><span class="expand">@multiple(<span class="name">write header tag</span>)</span>;<br/>

<span class="in1"></span><span class="fn">fprintf</span>(<span class="var">out</span>, <span class="str">"&lt;div class=\"slides\"&gt;\n"</span>);<br/>

<span class="in1"></span><span class="fn">fprintf</span>(<span class="var">out</span>, <span class="str">"&lt;div&gt;&lt;div&gt;\n"</span>);<br/>

<span class="in1"></span><span class="expand">@multiple(<span class="name">write header tag</span>)</span>;<br/>

<span class="in1"></span><span class="fn">fprintf</span>(<span class="var">out</span>, <span class="str">"&lt;/div&gt;\n"</span>);<br/>

<span class="end">@end(<span class="name">process header in HTML</span>)</span><br/>

</code>
</div>

<ul><li>
 Falls schon eine Seite offen ist, dann wird diese geschlossen
</li><li>
 Dann wird eine HTML-Überschrift ausgegeben
</li><li>
 Und eine Folie mit einer HTML-Überschrift wird erzeugt
</li></ul></div>

<div><div>
<code>

<span class="add">@globadd(<span class="name">global elements</span>)</span> <br/>

<span class="in1"></span><span class="var">template</span> &lt;<span class="var">typename</span> <span class="var">T</span>&gt;<br/>

<span class="in1"></span><span class="type">void</span> <span class="fn">writeEscaped</span>(<br/>

<span class="in2"></span><span class="type">FILE</span> *<span class="var">out</span>, <span class="var">T</span> <span class="var">str</span>, <span class="var">T</span> <span class="var">end</span><br/>

<span class="in1"></span>) {<br/>

<span class="in2"></span><span class="fn">ASSERT</span>(<span class="var">out</span>);<br/>

<span class="in2"></span><span class="keyword">for</span> (; *<span class="var">str</span> &amp;&amp; <span class="var">str</span> != <span class="var">end</span>; ++<span class="var">str</span>) {<br/>

<span class="in3"></span><span class="keyword">switch</span> (*<span class="var">str</span>) {<br/>

<span class="in4"></span><span class="expand">@expand(<span class="name">escape special</span>)</span><br/>

<span class="in4"></span><span class="keyword">default</span>:<br/>

<span class="in5"></span><span class="fn">fputc</span>(*<span class="var">str</span>, <span class="var">out</span>);<br/>

<span class="in3"></span>}<br/>

<span class="in2"></span>}<br/>

<span class="in1"></span>}<br/>

<span class="end">@end(<span class="name">global elements</span>)</span><br/>

</code>
</div>

<ul><li>
 Zeichen, die einen HTML-Befehl einleiten können, werden durch passende
  Entitäten ersetzt
</li></ul></div>

<div><div>
<code>

<span class="add">@def(<span class="name">escape special</span>)</span><br/>

<span class="in1"></span><span class="keyword">case</span> <span class="str">'&lt;'</span>:<br/>

<span class="in2"></span><span class="fn">fprintf</span>(<span class="var">out</span>, <span class="str">"&amp;lt;"</span>);<br/>

<span class="in2"></span><span class="keyword">break</span>;<br/>

<span class="in1"></span><span class="keyword">case</span> <span class="str">'&gt;'</span>:<br/>

<span class="in2"></span><span class="fn">fprintf</span>(<span class="var">out</span>, <span class="str">"&amp;gt;"</span>);<br/>

<span class="in2"></span><span class="keyword">break</span>;<br/>

<span class="in1"></span><span class="keyword">case</span> <span class="str">'&amp;'</span>:<br/>

<span class="in2"></span><span class="fn">fprintf</span>(<span class="var">out</span>, <span class="str">"&amp;amp;"</span>);<br/>

<span class="in2"></span><span class="keyword">break</span>;<br/>

<span class="end">@end(<span class="name">escape special</span>)</span><br/>

</code>
</div>

<ul><li>
 Die Zeichen <code>&lt;</code>, <code>&gt;</code> und <code>&amp;</code> müssen ersetzt werden
</li></ul></div>

<div><div>
<code>

<span class="add">@def(<span class="name">write header tag</span>)</span> <br/>

<span class="in1"></span><span class="fn">fprintf</span>(<span class="var">out</span>, <span class="str">"&lt;h%d&gt;"</span>, <span class="var">status</span>.<span class="var">headerLevel</span>);<br/>

<span class="in1"></span><span class="fn">writeEscaped</span>(<br/>

<span class="in2"></span><span class="var">out</span>,<br/>

<span class="in2"></span><span class="var">status</span>.<span class="var">headerName</span>.<span class="fn">begin</span>(),<br/>

<span class="in2"></span><span class="var">status</span>.<span class="var">headerName</span>.<span class="fn">end</span>()<br/>

<span class="in1"></span>);<br/>

<span class="in1"></span><span class="fn">fprintf</span>(<span class="var">out</span>, <span class="str">"&lt;/h%d&gt;\n"</span>, <span class="var">status</span>.<span class="var">headerLevel</span>);<br/>

<span class="end">@end(<span class="name">write header tag</span>)</span><br/>

</code>
</div>

<ul><li>
 Die HTML-Überschrift enthält den eingelesenen Level
</li></ul></div>

<div><div>
<code>

<span class="add">@def(<span class="name">close previous HTML page</span>)</span> <br/>

<span class="in1"></span><span class="keyword">switch</span> (<span class="var">status</span>.<span class="var">headerState</span>) {<br/>

<span class="in2"></span><span class="keyword">case</span> <span class="type">HtmlState</span>::<span class="var">nothingWritten</span>: {<br/>

<span class="in3"></span><span class="expand">@expand(<span class="name">write HTML header</span>)</span>;<br/>

<span class="in3"></span><span class="keyword">break</span>;<br/>

<span class="in2"></span>}<br/>

<span class="in2"></span><span class="keyword">case</span> <span class="type">HtmlState</span>::<span class="var">inSlide</span>: {<br/>

<span class="in3"></span><span class="fn">fprintf</span>(<span class="var">out</span>, <span class="str">"&lt;/div&gt;\n"</span>);<br/>

<span class="in3"></span><span class="fn">fprintf</span>(<span class="var">out</span>, <span class="str">"&lt;/div&gt;\n"</span>);<br/>

<span class="in3"></span><span class="keyword">break</span>;<br/>

<span class="in2"></span>}<br/>

<span class="in2"></span><span class="keyword">default</span>: {<br/>

<span class="in3"></span><span class="fn">fprintf</span>(<span class="var">out</span>, <span class="str">"&lt;/div&gt;\n"</span>);<br/>

<span class="in2"></span>}<br/>

<span class="in1"></span>}<br/>

<span class="end">@end(<span class="name">close previous HTML page</span>)</span><br/>

</code>
</div>

<ul><li>
 Je nach Zustand müssen unterschiedlich viele HTML-Tags geschlossen
  werden
</li></ul></div>

<div><div>
<code>

<span class="add">@def(<span class="name">write HTML header</span>)</span> <br/>

<span class="in1"></span><span class="fn">fprintf</span>(<span class="var">out</span>, <span class="str">"&lt;!doctype html&gt;\n"</span>);<br/>

<span class="in1"></span><span class="fn">fprintf</span>(<span class="var">out</span>, <span class="str">"&lt;html lang=\"de\"l&gt;\n"</span>);<br/>

<span class="in1"></span><span class="fn">fprintf</span>(<span class="var">out</span>, <span class="str">"&lt;head&gt;\n"</span>);<br/>

<span class="in1"></span><span class="expand">@expand(<span class="name">write HTML header entries</span>)</span>;<br/>

<span class="in1"></span><span class="fn">fprintf</span>(<span class="var">out</span>, <span class="str">"&lt;/head&gt;\n"</span>);<br/>

<span class="in1"></span><span class="fn">fprintf</span>(<span class="var">out</span>, <span class="str">"&lt;body&gt;\n"</span>);<br/>

<span class="end">@end(<span class="name">write HTML header</span>)</span><br/>

</code>
</div>

<ul><li>
 Dies wird am Anfang der HTML-Datei ausgegeben
</li><li>
 Dafür muss jede <code>.x</code>-Datei mit einer Überschrift beginnen
</li><li>
 Diese Überschrift ist dann auch der Titel der HTML-Datei
</li></ul></div>

<div><div>
<code>

<span class="add">@def(<span class="name">write HTML header entries</span>)</span> <br/>

<span class="in1"></span><span class="fn">fprintf</span>(<br/>

<span class="in2"></span><span class="var">out</span>, <span class="str">"&lt;meta charset=\"utf-8\"&gt;\n"</span><br/>

<span class="in1"></span>);<br/>

<span class="in1"></span><span class="fn">fprintf</span>(<span class="var">out</span>, <span class="str">"&lt;title&gt;"</span>);<br/>

<span class="in1"></span><span class="fn">writeEscaped</span>(<br/>

<span class="in2"></span><span class="var">out</span>,<br/>

<span class="in2"></span><span class="var">status</span>.<span class="var">headerName</span>.<span class="fn">begin</span>(),<br/>

<span class="in2"></span><span class="var">status</span>.<span class="var">headerName</span>.<span class="fn">end</span>()<br/>

<span class="in1"></span>);<br/>

<span class="in1"></span><span class="fn">fprintf</span>(<span class="var">out</span>, <span class="str">"&lt;/title&gt;"</span>);<br/>

<span class="in1"></span><span class="fn">fprintf</span>(<br/>

<span class="in2"></span><span class="var">out</span>, <span class="str">"&lt;link rel=\"stylesheet\" "</span><br/>

<span class="in2"></span><span class="str">"type=\"text/css\" href=\"%s\"&gt;"</span>,<br/>

<span class="var">stylesheet</span><br/>

<span class="in3"></span>);<br/>

<span class="end">@end(<span class="name">write HTML header entries</span>)</span><br/>

</code>
</div>

<ul><li>
 Im Header wird das Zeichenformat auf UTF-8 gesetzt
</li><li>
 Und der Titel ausgegeben
</li><li>
 Und die Stylesheet-Datei eingebunden
</li></ul></div>

</div>
<h1>Code formatieren</h1>
<div class="slides">
<div><div>
<h1>Code formatieren</h1>
</div>

<ul><li>
 Code kann auf Seiten oder in den Notizen ausgegeben werden
</li></ul></div>

<div><div>
<code>

<span class="add">@add(<span class="name">html state enums</span>)</span><br/>

<span class="in1"></span>, <span class="var">inCode</span><br/>

<span class="end">@end(<span class="name">html state enums</span>)</span><br/>

</code>
</div>

<ul><li>
 Es gibt einen eigenen Zustand, wenn Code ausgegeben wird
</li></ul></div>

<div><div>
<code>

<span class="add">@add(<span class="name">check html special state</span>)</span><br/>

<span class="in1"></span><span class="keyword">if</span> (<span class="var">s</span>-&gt;<span class="var">state</span> == <span class="type">HtmlState</span>::<span class="var">inCode</span>) {<br/>

<span class="in2"></span><span class="keyword">return</span> <span class="num">false</span>;<br/>

<span class="in1"></span>}<br/>

<span class="end">@end(<span class="name">check html special state</span>)</span><br/>

</code>
</div>

<ul><li>
 Die Code-Ausgabe ist ein besonderer Zustand
</li></ul></div>

<div><div>
<code>

<span class="add">@add(<span class="name">html state elements</span>)</span><br/>

<span class="in1"></span><span class="type">int</span> <span class="var">codeOpening</span>;<br/>

<span class="end">@end(<span class="name">html state elements</span>)</span><br/>

</code>
</div>

<ul><li>
 Der Code-Block wird mit drei Backticks betreten und verlassen
</li><li>
 Die Anzahl der bisher gelesenen Backticks wird in <code>codeOpening</code>
  festgehalten
</li></ul></div>

<div><div>
<code>

<span class="add">@add(<span class="name">html state elements</span>)</span><br/>

<span class="in1"></span><span class="type">int</span> <span class="var">codeIndent</span>;<br/>

<span class="end">@end(<span class="name">html state elements</span>)</span><br/>

</code>
</div>

<ul><li>
 Tabs am Anfang der Zeile werden durch passenden HTML-Elemente ersetzt
</li><li>
 Um die Einrückung nachzubilden
</li><li>
 In <code>codeIndent</code> wird der Einrück-Level gespeichert
</li></ul></div>

<div><div>
<code>

<span class="add">@add(<span class="name">html state elements</span>)</span><br/>

<span class="in1"></span><span class="type">char</span> <span class="var">codeSpecial</span>;<br/>

<span class="in1"></span><span class="type">char</span> <span class="var">codeName</span>[<span class="num">100</span>];<br/>

<span class="in1"></span><span class="type">char</span> *<span class="var">codeNameEnd</span>;<br/>

<span class="end">@end(<span class="name">html state elements</span>)</span><br/>

</code>
</div>

<ul><li>
 Wenn ein Befehl gelesen wurde, dann enthält <code>codeSpecial</code> den
  Code des Befehls
</li><li>
 In <code>codeName</code> wird bis zu <code>codeEnd</code> das Argument abgelegt
</li></ul></div>

<div><div>
<code>

<span class="add">@add(<span class="name">init html status</span>)</span><br/>

<span class="in1"></span>, <span class="fn">codeOpening</span>(<span class="num">0</span>)<br/>

<span class="in1"></span>, <span class="fn">codeIndent</span>(<span class="num">0</span>)<br/>

<span class="in1"></span>, <span class="fn">codeSpecial</span>(<span class="str">'\0'</span>)<br/>

<span class="in1"></span>, <span class="fn">codeNameEnd</span>(<span class="num">nullptr</span>)<br/>

<span class="end">@end(<span class="name">init html status</span>)</span><br/>

</code>
</div>

<ul><li>
 Zur Initialisierung werden die Parameter auf <code>0</code> gesetzt
</li><li>
 Das Code-Argument <code>codeName</code> wird nicht zurückgesetzt
</li></ul></div>

<div><div>
<code>

<span class="add">@add(<span class="name">process ch for HTML</span>)</span> <br/>

<span class="in1"></span><span class="keyword">if</span> (<span class="var">newline</span> &amp;&amp; <span class="var">ch</span> == <span class="str">'`'</span>) {<br/>

<span class="in2"></span><span class="keyword">if</span> (<span class="fn">isOutOfHtmlSpecial</span>(&amp;<span class="var">status</span>) ||<br/>

<span class="in3"></span><span class="var">status</span>.<span class="var">state</span> == <span class="type">HtmlState</span>::<span class="var">inCode</span><br/>

<span class="in2"></span>) {<br/>

<span class="in3"></span>++<span class="var">status</span>.<span class="var">codeOpening</span>;<br/>

<span class="in3"></span><span class="keyword">continue</span>;<br/>

<span class="in2"></span>}<br/>

<span class="in1"></span>}<br/>

<span class="end">@end(<span class="name">process ch for HTML</span>)</span><br/>

</code>
</div>

<ul><li>
 Wenn am Anfang der Zeile Backticks kommen, dann werden sie gezählt
</li></ul></div>

<div><div>
<code>

<span class="add">@add(<span class="name">process ch for HTML</span>)</span> <br/>

<span class="in1"></span><span class="keyword">if</span> (<br/>

<span class="in2"></span><span class="var">ch</span> == <span class="str">'\n'</span> &amp;&amp; <span class="var">status</span>.<span class="var">codeOpening</span> == <span class="num">3</span><br/>

<span class="in1"></span>) {<br/>

<span class="in2"></span><span class="var">status</span>.<span class="var">codeOpening</span> = <span class="num">0</span>;<br/>

<span class="in2"></span><span class="keyword">if</span> (<span class="fn">isOutOfHtmlSpecial</span>(&amp;<span class="var">status</span>)) {<br/>

<span class="in3"></span><span class="expand">@expand(<span class="name">open code page</span>)</span>;<br/>

<span class="in3"></span><span class="keyword">continue</span>;<br/>

<span class="in2"></span>} <span class="keyword">else</span> <span class="keyword">if</span> (<br/>

<span class="in3"></span><span class="var">status</span>.<span class="var">state</span> == <span class="type">HtmlState</span>::<span class="var">inCode</span><br/>

<span class="in2"></span>) {<br/>

<span class="in3"></span><span class="expand">@expand(<span class="name">close code page</span>)</span>;<br/>

<span class="in3"></span><span class="keyword">continue</span>;<br/>

<span class="in2"></span>}<br/>

<span class="in1"></span>}<br/>

<span class="end">@end(<span class="name">process ch for HTML</span>)</span><br/>

</code>
</div>

<ul><li>
 Wenn die Anzahl der Backticks genau <code>3</code> war, dann wird der
  Code-Modus betreten oder verlassen
</li></ul></div>

<div><div>
<code>

<span class="add">@add(<span class="name">process ch for HTML</span>)</span><br/>

<span class="in1"></span><span class="keyword">if</span> (<span class="var">status</span>.<span class="var">codeOpening</span> == <span class="num">1</span>) {<br/>

<span class="in2"></span><span class="keyword">if</span> (! <span class="var">status</span>.<span class="var">codeSpecial</span> &amp;&amp; <span class="var">status</span>.<span class="var">state</span> == <span class="type">HtmlState</span>::<span class="var">inCode</span>) {<br/>

<span class="in3"></span><span class="var">status</span>.<span class="var">codeSpecial</span> = <span class="str">'`'</span>;<br/>

<span class="in3"></span><span class="var">status</span>.<span class="var">codeNameEnd</span> = <span class="var">status</span>.<span class="var">codeName</span>;<br/>

<span class="in3"></span><span class="expand">@multiple(<span class="name">flush pending</span>)</span>;<br/>

<span class="in3"></span><span class="keyword">if</span> (<span class="var">status</span>.<span class="var">codeIndent</span>) {<br/>

<span class="in4"></span><span class="fn">fprintf</span>(<br/>

<span class="in5"></span><span class="var">out</span>,<br/>

<span class="in5"></span><span class="str">"&lt;span class=\"in%d\"&gt;&lt;/span&gt;"</span>,<br/>

<span class="in5"></span><span class="var">status</span>.<span class="var">codeIndent</span><br/>

<span class="in4"></span>);<br/>

<span class="in4"></span><span class="var">status</span>.<span class="var">codeIndent</span> = <span class="num">0</span>;<br/>

<span class="in3"></span>}<br/>

<span class="in3"></span><span class="fn">fprintf</span>(<span class="var">out</span>, <span class="str">"&lt;span class=\"str\"&gt;`"</span>);<br/>

<span class="in2"></span>} <span class="keyword">else</span> <span class="keyword">if</span> (<br/>

<span class="in3"></span><span class="var">status</span>.<span class="var">codeSpecial</span> == <span class="str">'`'</span> &amp;&amp; <span class="var">status</span>.<span class="var">codeNameEnd</span>[-<span class="num">1</span>] != <span class="str">'\x5c'</span><br/>

<span class="in2"></span>) {<br/>

<span class="in3"></span><span class="expand">@multiple(<span class="name">flush pending</span>)</span>;<br/>

<span class="in3"></span><span class="fn">writeEscaped</span>(<span class="var">out</span>, <span class="var">status</span>.<span class="var">codeName</span>, <span class="var">status</span>.<span class="var">codeNameEnd</span>);<br/>

<span class="in3"></span><span class="fn">fprintf</span>(<span class="var">out</span>, <span class="str">"`&lt;/span&gt;"</span>);<br/>

<span class="in3"></span><span class="var">status</span>.<span class="var">codeSpecial</span> = <span class="num">0</span>;<br/>

<span class="in3"></span><span class="var">status</span>.<span class="var">codeNameEnd</span> = <span class="num">nullptr</span>;<br/>

<span class="in2"></span>}<br/>

<span class="in1"></span>}<br/>

<span class="end">@end(<span class="name">process ch for HTML</span>)</span><br/>

</code>
</div>


</div>
<div><div>
<code>

<span class="add">@add(<span class="name">process ch for HTML</span>)</span><br/>

<span class="in1"></span><span class="var">status</span>.<span class="var">codeOpening</span> = <span class="num">0</span>;<br/>

<span class="end">@end(<span class="name">process ch for HTML</span>)</span><br/>

</code>
</div>


</div>
<div><div>
<code>

<span class="add">@def(<span class="name">open code page</span>)</span><br/>

<span class="in1"></span><span class="keyword">if</span> (<span class="var">status</span>.<span class="var">state</span> == <span class="type">HtmlState</span>::<span class="var">inSlide</span>) {<br/>

<span class="in2"></span><span class="fn">fprintf</span>(<span class="var">out</span>, <span class="str">"&lt;/div&gt;\n"</span>);<br/>

<span class="in1"></span>}<br/>

<span class="in1"></span><span class="fn">fprintf</span>(<span class="var">out</span>, <span class="str">"&lt;div&gt;&lt;div&gt;\n"</span>);<br/>

<span class="in1"></span><span class="fn">fprintf</span>(<span class="var">out</span>, <span class="str">"&lt;code&gt;\n"</span>);<br/>

<span class="in1"></span><span class="var">status</span>.<span class="var">state</span> = <span class="type">HtmlState</span>::<span class="var">inCode</span>;<br/>

<span class="in1"></span><span class="expand">@multiple(<span class="name">move ch to last</span>)</span>;<br/>

<span class="end">@end(<span class="name">open code page</span>)</span><br/>

</code>
</div>

<ul><li>
 Beim Betreten wird eine Seite mit einem <code>&lt;code&gt;</code>-Tag geöffnet
</li><li>
 Und der Zustand passend gesetzt
</li></ul></div>

<div><div>
<code>

<span class="add">@def(<span class="name">close code page</span>)</span><br/>

<span class="in1"></span><span class="fn">fprintf</span>(<span class="var">out</span>, <span class="str">"&lt;/code&gt;\n"</span>);<br/>

<span class="in1"></span><span class="fn">fprintf</span>(<span class="var">out</span>, <span class="str">"&lt;/div&gt;\n"</span>);<br/>

<span class="in1"></span><span class="var">status</span>.<span class="var">state</span> = <span class="type">HtmlState</span>::<span class="var">inSlide</span>;<br/>

<span class="in1"></span><span class="var">status</span>.<span class="var">codeIndent</span> = <span class="num">0</span>;<br/>

<span class="in1"></span><span class="var">status</span>.<span class="var">codeSpecial</span> = <span class="str">'\0'</span>;<br/>

<span class="in1"></span><span class="expand">@multiple(<span class="name">move ch to last</span>)</span>;<br/>

<span class="end">@end(<span class="name">close code page</span>)</span><br/>

</code>
</div>

<ul><li>
 Beim Verlassen wird die Folie (aber nicht die Seite) geschlossen
</li></ul></div>

<div><div>
<code>

<span class="add">@add(<span class="name">process ch for HTML</span>)</span><br/>

<span class="in1"></span><span class="keyword">if</span> (<span class="var">status</span>.<span class="var">state</span> == <span class="type">HtmlState</span>::<span class="var">inCode</span>) {<br/>

<span class="in2"></span><span class="keyword">if</span> (<span class="var">ch</span> == <span class="num">EOF</span>) {<br/>

<span class="in3"></span><span class="fn">fprintf</span>(<br/>

<span class="in4"></span><span class="var">stderr</span>,<br/>

<span class="in4"></span><span class="str">"unterminated code block\n"</span><br/>

<span class="in3"></span>);<br/>

<span class="in3"></span><span class="keyword">break</span>;<br/>

<span class="in2"></span>}<br/>

<span class="in1"></span>}<br/>

<span class="end">@end(<span class="name">process ch for HTML</span>)</span><br/>

</code>
</div>

<ul><li>
 Wenn wir beim Beenden des Parsens noch im Code-Modus sind, dann
  stimmt etwas nicht
</li><li>
 Eine Fehlermeldung wird ausgegeben
</li></ul></div>

<div><div>
<code>

<span class="add">@globadd(<span class="name">includes</span>)</span><br/>

<span class="in1"></span>#<span class="var">include</span> &lt;<span class="var">ctype</span>.<span class="var">h</span>&gt;<br/>

<span class="end">@end(<span class="name">includes</span>)</span><br/>

</code>
</div>


</div>
<div><div>
<code>

<span class="add">@add(<span class="name">process ch for HTML</span>)</span><br/>

<span class="in1"></span><span class="keyword">if</span> (<span class="var">status</span>.<span class="var">state</span> == <span class="type">HtmlState</span>::<span class="var">inCode</span>) {<br/>

<span class="in2"></span><span class="keyword">if</span> (! <span class="var">status</span>.<span class="var">codeSpecial</span> &amp;&amp; (<span class="fn">isalnum</span>(<span class="var">ch</span>) || <span class="var">ch</span> == <span class="str">'_'</span>)) {<br/>

<span class="in3"></span><span class="var">ident</span>.<span class="fn">push_back</span>(<span class="var">ch</span>);<br/>

<span class="in3"></span><span class="keyword">continue</span>;<br/>

<span class="in2"></span>}<br/>

<span class="in1"></span>}<br/>

<span class="end">@end(<span class="name">process ch for HTML</span>)</span><br/>

</code>
</div>


</div>
<div><div>
<code>

<span class="add">@globadd(<span class="name">global elements</span>)</span><br/>

<span class="in1"></span><span class="type">void</span> <span class="fn">escapeIdent</span>(<br/>

<span class="in2"></span><span class="type">FILE</span> *<span class="var">out</span>,<br/>

<span class="in2"></span><span class="type">const</span> <span class="type">char</span> *<span class="var">cls</span>,<br/>

<span class="in2"></span><span class="type">const</span> <span class="var">std</span>::<span class="var">string</span> &amp;<span class="var">s</span><br/>

<span class="in1"></span>) {<br/>

<span class="in2"></span><span class="fn">fprintf</span>(<br/>

<span class="in3"></span><span class="var">out</span>,<br/>

<span class="in3"></span><span class="str">"&lt;span class=\"%s\"&gt;%.*s&lt;/span&gt;"</span>,<br/>

<span class="in3"></span><span class="var">cls</span>,<br/>

<span class="in3"></span>(<span class="type">int</span>) <span class="var">s</span>.<span class="fn">size</span>(),<br/>

<span class="in3"></span><span class="var">s</span>.<span class="fn">data</span>()<br/>

<span class="in2"></span>);<br/>

<span class="in1"></span>}<br/>

<span class="end">@end(<span class="name">global elements</span>)</span><br/>

</code>
</div>


</div>
<div><div>
<code>

<span class="add">@globadd(<span class="name">global elements</span>)</span><br/>

<span class="in1"></span><span class="type">bool</span> <span class="fn">isKeyword</span>(<span class="type">const</span> <span class="var">std</span>::<span class="var">string</span> &amp;<span class="var">s</span>) {<br/>

<span class="in2"></span><span class="keyword">static</span> <span class="var">std</span>::<span class="var">set</span>&lt;<span class="var">std</span>::<span class="var">string</span>&gt; <span class="var">reserved</span> {<br/>

<span class="in3"></span><span class="str">"break"</span>, <span class="str">"case"</span>, <span class="str">"catch"</span>, <span class="str">"continue"</span>,<br/>

<span class="in3"></span><span class="str">"default"</span>, <span class="str">"delete"</span>, <span class="str">"else"</span>, <span class="str">"for"</span>,<br/>

<span class="in3"></span><span class="str">"if"</span>, <span class="str">"in"</span>, <span class="str">"new"</span>, <span class="str">"return"</span>, <span class="str">"static"</span>,<br/>

<span class="in3"></span><span class="str">"switch"</span>, <span class="str">"try"</span>, <span class="str">"typeof"</span>, <span class="str">"while"</span><br/>

<span class="in2"></span>};<br/>

<span class="in2"></span><span class="keyword">return</span> <span class="var">reserved</span>.<span class="fn">find</span>(<span class="var">s</span>) != <span class="var">reserved</span>.<span class="fn">end</span>();<br/>

<span class="in1"></span>}<br/>

<span class="end">@end(<span class="name">global elements</span>)</span><br/>

</code>
</div>


</div>
<div><div>
<code>

<span class="add">@globadd(<span class="name">global elements</span>)</span><br/>

<span class="in1"></span><span class="type">bool</span> <span class="fn">isType</span>(<span class="type">const</span> <span class="var">std</span>::<span class="var">string</span> &amp;<span class="var">s</span>) {<br/>

<span class="in2"></span><span class="keyword">static</span> <span class="var">std</span>::<span class="var">set</span>&lt;<span class="var">std</span>::<span class="var">string</span>&gt; <span class="var">reserved</span> {<br/>

<span class="in3"></span><span class="str">"FILE"</span>,<br/>

<span class="in3"></span><span class="str">"bool"</span>, <span class="str">"char"</span>, <span class="str">"const"</span>, <span class="str">"enum"</span>,<br/>

<span class="in3"></span><span class="str">"int"</span>, <span class="str">"let"</span>, <span class="str">"long"</span>, <span class="str">"signed"</span>, <span class="str">"struct"</span>,<br/>

<span class="in3"></span><span class="str">"union"</span>, <span class="str">"unsigned"</span>, <span class="str">"void"</span><br/>

<span class="in2"></span>};<br/>

<span class="in2"></span><span class="keyword">if</span> (<span class="var">reserved</span>.<span class="fn">find</span>(<span class="var">s</span>) != <span class="var">reserved</span>.<span class="fn">end</span>()) {<br/>

<span class="in3"></span><span class="keyword">return</span> <span class="num">true</span>;<br/>

<span class="in2"></span>}<br/>

<span class="in2"></span><span class="keyword">if</span> (<span class="var">s</span>.<span class="fn">size</span>() &gt;= <span class="num">2</span>) {<br/>

<span class="in3"></span><span class="keyword">if</span> (<span class="fn">isupper</span>(<span class="var">s</span>[<span class="num">0</span>]) &amp;&amp; <span class="fn">islower</span>(<span class="var">s</span>[<span class="num">1</span>])) {<br/>

<span class="in4"></span><span class="keyword">return</span> <span class="num">true</span>;<br/>

<span class="in3"></span>}<br/>

<span class="in2"></span>}<br/>

<span class="in2"></span><span class="keyword">return</span> <span class="num">false</span>;<br/>

<span class="in1"></span>}<br/>

<span class="end">@end(<span class="name">global elements</span>)</span><br/>

</code>
</div>


</div>
<div><div>
<code>

<span class="add">@globadd(<span class="name">global elements</span>)</span><br/>

<span class="in1"></span><span class="type">bool</span> <span class="fn">isNum</span>(<span class="type">const</span> <span class="var">std</span>::<span class="var">string</span> &amp;<span class="var">s</span>) {<br/>

<span class="in2"></span><span class="keyword">static</span> <span class="var">std</span>::<span class="var">set</span>&lt;<span class="var">std</span>::<span class="var">string</span>&gt; <span class="var">reserved</span> {<br/>

<span class="in3"></span><span class="str">"EOF"</span>, <span class="str">"NULL"</span>, <span class="str">"nullptr"</span>,<br/>

<span class="in3"></span><span class="str">"false"</span>, <span class="str">"null"</span>, <span class="str">"true"</span>, <span class="str">"undefined"</span><br/>

<span class="in2"></span>};<br/>

<span class="in2"></span><span class="keyword">if</span> (<span class="fn">isdigit</span>(<span class="var">s</span>[<span class="num">0</span>])) { <span class="keyword">return</span> <span class="num">true</span>; }<br/>

<span class="in2"></span><span class="keyword">return</span> <span class="var">reserved</span>.<span class="fn">find</span>(<span class="var">s</span>) != <span class="var">reserved</span>.<span class="fn">end</span>();<br/>

<span class="in1"></span>}<br/>

<span class="end">@end(<span class="name">global elements</span>)</span><br/>

</code>
</div>


</div>
<div><div>
<code>

<span class="add">@def(<span class="name">flush pending</span>)</span><br/>

<span class="in1"></span><span class="keyword">if</span> (! <span class="var">ident</span>.<span class="fn">empty</span>()) {<br/>

<span class="in2"></span><span class="keyword">if</span> (<span class="var">ch</span> == <span class="str">'('</span>) {<br/>

<span class="in3"></span><span class="fn">escapeIdent</span>(<span class="var">out</span>, <span class="str">"fn"</span>, <span class="var">ident</span>);<br/>

<span class="in2"></span>} <span class="keyword">else</span> <span class="keyword">if</span> (<span class="fn">isKeyword</span>(<span class="var">ident</span>)) {<br/>

<span class="in3"></span><span class="fn">escapeIdent</span>(<span class="var">out</span>, <span class="str">"keyword"</span>, <span class="var">ident</span>);<br/>

<span class="in2"></span>} <span class="keyword">else</span> <span class="keyword">if</span> (<span class="fn">isType</span>(<span class="var">ident</span>)) {<br/>

<span class="in3"></span><span class="fn">escapeIdent</span>(<span class="var">out</span>, <span class="str">"type"</span>, <span class="var">ident</span>);<br/>

<span class="in2"></span>} <span class="keyword">else</span> <span class="keyword">if</span> (<span class="fn">isNum</span>(<span class="var">ident</span>)) {<br/>

<span class="in3"></span><span class="fn">escapeIdent</span>(<span class="var">out</span>, <span class="str">"num"</span>, <span class="var">ident</span>);<br/>

<span class="in2"></span>} <span class="keyword">else</span> {<br/>

<span class="in3"></span><span class="fn">escapeIdent</span>(<span class="var">out</span>, <span class="str">"var"</span>, <span class="var">ident</span>);<br/>

<span class="in2"></span>}<br/>

<span class="in2"></span><span class="var">ident</span>.<span class="fn">clear</span>();<br/>

<span class="in1"></span>}<br/>

<span class="end">@end(<span class="name">flush pending</span>)</span><br/>

</code>
</div>


</div>
<div><div>
<code>

<span class="add">@add(<span class="name">process ch for HTML</span>)</span><br/>

<span class="in1"></span><span class="keyword">if</span> (<span class="var">status</span>.<span class="var">state</span> == <span class="type">HtmlState</span>::<span class="var">inCode</span>) {<br/>

<span class="in2"></span><span class="expand">@expand(<span class="name">process ch in HTML code</span>)</span>;<br/>

<span class="in2"></span><span class="expand">@multiple(<span class="name">flush pending</span>)</span>;<br/>

<span class="in2"></span><span class="expand">@multiple(<span class="name">move ch to last</span>)</span>;<br/>

<span class="in2"></span><span class="keyword">continue</span>;<br/>

<span class="in1"></span>}<br/>

<span class="end">@end(<span class="name">process ch for HTML</span>)</span><br/>

</code>
</div>

<ul><li>
 Zeichen wird im Code-Modus verarbeitet
</li></ul></div>

<div><div>
<code>

<span class="add">@def(<span class="name">process ch in HTML code</span>)</span> <br/>

<span class="in1"></span><span class="keyword">if</span> (<span class="var">ch</span> == <span class="str">'\n'</span>) {<br/>

<span class="in2"></span><span class="expand">@multiple(<span class="name">flush pending</span>)</span>;<br/>

<span class="in2"></span><span class="fn">fprintf</span>(<span class="var">out</span>, <span class="str">"&lt;br/&gt;\n"</span>);<br/>

<span class="in2"></span><span class="expand">@multiple(<span class="name">move ch to last</span>)</span>;<br/>

<span class="in2"></span><span class="keyword">continue</span>;<br/>

<span class="in1"></span>}<br/>

<span class="end">@end(<span class="name">process ch in HTML code</span>)</span><br/>

</code>
</div>

<ul><li>
 Bei Zeilen-Umbrüchen wird ein <code>&lt;br/&gt;</code>-Tag gesendet
</li></ul></div>

<div><div>
<code>

<span class="add">@add(<span class="name">process ch in HTML code</span>)</span> <br/>

<span class="in1"></span><span class="keyword">if</span> (<span class="var">newline</span> &amp;&amp; <span class="var">ch</span> == <span class="str">'\t'</span>) {<br/>

<span class="in2"></span>++<span class="var">status</span>.<span class="var">codeIndent</span>;<br/>

<span class="in2"></span><span class="keyword">continue</span>;<br/>

<span class="in1"></span>}<br/>

<span class="end">@end(<span class="name">process ch in HTML code</span>)</span><br/>

</code>
</div>

<ul><li>
 Am Anfang der Zeile werden Tabulatoren gezählt
</li></ul></div>

<div><div>
<code>

<span class="add">@add(<span class="name">process ch in HTML code</span>)</span> <br/>

<span class="in1"></span><span class="keyword">if</span> (<span class="var">status</span>.<span class="var">codeIndent</span>) {<br/>

<span class="in2"></span><span class="fn">fprintf</span>(<br/>

<span class="in3"></span><span class="var">out</span>,<br/>

<span class="in3"></span><span class="str">"&lt;span class=\"in%d\"&gt;&lt;/span&gt;"</span>,<br/>

<span class="in3"></span><span class="var">status</span>.<span class="var">codeIndent</span><br/>

<span class="in2"></span>);<br/>

<span class="in2"></span><span class="var">status</span>.<span class="var">codeIndent</span> = <span class="num">0</span>;<br/>

<span class="in1"></span>}<br/>

<span class="end">@end(<span class="name">process ch in HTML code</span>)</span><br/>

</code>
</div>

<ul><li>
 Wenn es Tabulatoren gab, dann werden sie als Span-Element ausgegeben
</li></ul></div>

<div><div>
<code>

<span class="add">@add(<span class="name">process ch in HTML code</span>)</span><br/>

<span class="in1"></span><span class="keyword">if</span> (! <span class="var">status</span>.<span class="var">codeSpecial</span> &amp;&amp; (<span class="var">ch</span> == <span class="str">'\''</span> || <span class="var">ch</span> == <span class="str">'"'</span> || <span class="var">ch</span> == <span class="str">'`'</span>)) {<br/>

<span class="in2"></span><span class="var">status</span>.<span class="var">codeSpecial</span> = <span class="var">ch</span>;<br/>

<span class="in2"></span><span class="var">status</span>.<span class="var">codeNameEnd</span> = <span class="var">status</span>.<span class="var">codeName</span>;<br/>

<span class="in2"></span><span class="fn">fprintf</span>(<span class="var">out</span>, <span class="str">"&lt;span class=\"str\"&gt;%c"</span>, <span class="var">ch</span>);<br/>

<span class="in2"></span><span class="keyword">continue</span>;<br/>

<span class="in1"></span>}<br/>

<span class="end">@end(<span class="name">process ch in HTML code</span>)</span><br/>

</code>
</div>


</div>
<div><div>
<code>

<span class="add">@add(<span class="name">process ch in HTML code</span>)</span><br/>

<span class="in1"></span><span class="expand">@multiple(<span class="name">escape HTML code tag</span>)</span>;<br/>

<span class="end">@end(<span class="name">process ch in HTML code</span>)</span><br/>

</code>
</div>

<ul><li>
 Ansonsten werden Befehle in HTML-Tags expandiert
</li></ul></div>

<div><div>
<code>

<span class="add">@def(<span class="name">escape HTML code tag</span>)</span><br/>

<span class="in1"></span><span class="keyword">if</span> (<span class="var">ch</span> == <span class="str">'{'</span> &amp;&amp; <span class="var">ident</span>.<span class="fn">size</span>() == <span class="num">1</span>) {<br/>

<span class="in2"></span><span class="type">char</span> <span class="var">lc</span> = <span class="var">ident</span>.<span class="fn">front</span>();<br/>

<span class="in2"></span><span class="keyword">switch</span> (<span class="var">lc</span>) {<br/>

<span class="in3"></span><span class="expand">@expand(<span class="name">escape html frag</span>)</span><br/>

<span class="in3"></span><span class="keyword">default</span>: <span class="keyword">break</span>;<br/>

<span class="in2"></span>}<br/>

<span class="in2"></span><span class="keyword">if</span> (<span class="var">status</span>.<span class="var">codeSpecial</span>) {<br/>

<span class="in3"></span><span class="var">ident</span>.<span class="fn">clear</span>();<br/>

<span class="in3"></span><span class="var">newline</span> = <span class="num">false</span>;<br/>

<span class="in3"></span><span class="keyword">continue</span>;<br/>

<span class="in2"></span>}<br/>

<span class="in1"></span>}<br/>

<span class="end">@end(<span class="name">escape HTML code tag</span>)</span><br/>

</code>
</div>

<ul><li>
 Bei einer öffnenden Mengenklammer wird geprüft, ob ein bekannter
  Befehls-Code im vorherigen Zeichen liegt
</li><li>
 In diesem Fall wird die weiter Abarbeitung abgebrochen
</li><li>
 Statt dessen wurden passende Tags generiert und die nächsten Zeichen
  sind das Argument des Befehls
</li><li>
 Diese werden direkt kopiert
</li></ul></div>

<div><div>
<code>

<span class="add">@add(<span class="name">escape HTML code tag</span>)</span><br/>

<span class="in1"></span><span class="keyword">if</span> (<br/>

<span class="in2"></span>(<br/>

<span class="in3"></span><span class="var">ch</span> == <span class="str">'}'</span> &amp;&amp;<br/>

<span class="in3"></span><span class="var">status</span>.<span class="var">codeSpecial</span> &amp;&amp;<br/>

<span class="in3"></span><span class="var">status</span>.<span class="var">codeSpecial</span> != <span class="str">'\''</span> &amp;&amp;<br/>

<span class="in3"></span><span class="var">status</span>.<span class="var">codeSpecial</span> != <span class="str">'"'</span> &amp;&amp;<br/>

<span class="in3"></span><span class="var">status</span>.<span class="var">codeSpecial</span> != <span class="str">'`'</span><br/>

<span class="in2"></span>) <br/>

<span class="in1"></span>||<br/>

<span class="in2"></span>(<br/>

<span class="in3"></span>(<br/>

<span class="in4"></span><span class="var">status</span>.<span class="var">codeSpecial</span> == <span class="str">'\''</span> ||<br/>

<span class="in4"></span><span class="var">status</span>.<span class="var">codeSpecial</span> == <span class="str">'"'</span> ||<br/>

<span class="in4"></span><span class="var">status</span>.<span class="var">codeSpecial</span> == <span class="str">'`'</span><br/>

<span class="in3"></span>) &amp;&amp;<br/>

<span class="in3"></span><span class="var">ch</span> == <span class="var">status</span>.<span class="var">codeSpecial</span> &amp;&amp;<br/>

<span class="in3"></span><span class="var">status</span>.<span class="var">codeNameEnd</span>[-<span class="num">1</span>] != <span class="str">'\x5c'</span><br/>

<span class="in2"></span>)<br/>

<span class="in1"></span>) {<br/>

<span class="in2"></span><span class="expand">@multiple(<span class="name">flush pending</span>)</span>;<br/>

<span class="in2"></span><span class="var">ident</span>.<span class="fn">clear</span>();<br/>

<span class="in2"></span><span class="var">newline</span> = <span class="num">false</span>;<br/>

<span class="in2"></span><span class="keyword">if</span> (<span class="var">status</span>.<span class="var">codeSpecial</span> != <span class="str">'i'</span>) {<br/>

<span class="in3"></span><span class="fn">writeEscaped</span>(<span class="var">out</span>, <span class="var">status</span>.<span class="var">codeName</span>, <span class="var">status</span>.<span class="var">codeNameEnd</span>);<br/>

<span class="in2"></span>}<br/>

<span class="in2"></span><span class="keyword">switch</span> (<span class="var">status</span>.<span class="var">codeSpecial</span>) {<br/>

<span class="in3"></span><span class="expand">@expand(<span class="name">handle special codes</span>)</span><br/>

<span class="in2"></span>}<br/>

<span class="in2"></span><span class="keyword">if</span> (<span class="var">status</span>.<span class="var">codeSpecial</span> != <span class="str">'b'</span>) {<br/>

<span class="in3"></span><span class="fn">fprintf</span>(<span class="var">out</span>, <span class="str">"&lt;/span&gt;"</span>);<br/>

<span class="in2"></span>}<br/>

<span class="in2"></span><span class="var">status</span>.<span class="var">codeSpecial</span> = <span class="num">0</span>;<br/>

<span class="in2"></span><span class="var">status</span>.<span class="var">codeNameEnd</span> = <span class="num">nullptr</span>;<br/>

<span class="in2"></span><span class="keyword">continue</span>;<br/>

<span class="in1"></span>}<br/>

<span class="end">@end(<span class="name">escape HTML code tag</span>)</span><br/>

</code>
</div>

<ul><li>
 Nach dem Lesen eines Arguments muss das HTML-Tag wieder geschlossen
  werden
</li><li>
 Bei besonderen Befehlen müssen mehrere Tags geschlossen werden
</li></ul></div>

<div><div>
<code>

<span class="add">@def(<span class="name">handle special codes</span>)</span><br/>

<span class="in1"></span><span class="keyword">case</span> <span class="str">'i'</span>: {<br/>

<span class="in2"></span><span class="expand">@expand(<span class="name">handle html include</span>)</span>;<br/>

<span class="in2"></span><span class="keyword">break</span>;<br/>

<span class="in1"></span>}<br/>

<span class="in1"></span><span class="keyword">case</span> <span class="str">'a'</span>: <span class="keyword">case</span> <span class="str">'e'</span>: <span class="keyword">case</span> <span class="str">'E'</span>: <span class="keyword">case</span> <span class="str">'x'</span>:<br/>

<span class="in1"></span><span class="keyword">case</span> <span class="str">'g'</span>: <span class="keyword">case</span> <span class="str">'G'</span>: <span class="keyword">case</span> <span class="str">'A'</span>: <span class="keyword">case</span> <span class="str">'D'</span>:<br/>

<span class="in1"></span><span class="keyword">case</span> <span class="str">'R'</span>:<br/>

<span class="in1"></span><span class="keyword">case</span> <span class="str">'r'</span>: <span class="keyword">case</span> <span class="str">'d'</span>: <span class="keyword">case</span> <span class="str">'p'</span>: <span class="keyword">case</span> <span class="str">'m'</span>: {<br/>

<span class="in2"></span><span class="fn">fprintf</span>(<span class="var">out</span>, <span class="str">"&lt;/span&gt;)"</span>);<br/>

<span class="in2"></span><span class="keyword">break</span>;<br/>

<span class="in1"></span>}<br/>

<span class="in1"></span><span class="keyword">case</span> <span class="str">'\''</span>: <span class="keyword">case</span> <span class="str">'"'</span>: <span class="keyword">case</span> <span class="str">'`'</span>: {<br/>

<span class="in2"></span><span class="fn">fputc</span>(<span class="var">status</span>.<span class="var">codeSpecial</span>, <span class="var">out</span>);<br/>

<span class="in2"></span><span class="keyword">break</span>;<br/>

<span class="in1"></span>}<br/>

<span class="end">@end(<span class="name">handle special codes</span>)</span><br/>

</code>
</div>

<ul><li>
 <code>@include</code>-Befehle haben eine Sonderbehandlung, da sie einen Link
  generieren
</li><li>
 Ansonsten werden alle Befehle, die nicht der Formatierung gelten mit
  zwei schließenden Tags abgeschlossen
</li></ul></div>

<div><div>
<code>

<span class="add">@def(<span class="name">handle html include</span>)</span><br/>

<span class="in1"></span><span class="fn">ASSERT</span>(<br/>

<span class="in2"></span><span class="var">status</span>.<span class="var">codeNameEnd</span> &lt;<br/>

<span class="in2"></span><span class="var">status</span>.<span class="var">codeName</span> +<br/>

<span class="in3"></span><span class="fn">sizeof</span>(<span class="var">status</span>.<span class="var">codeName</span>)<br/>

<span class="in1"></span>);<br/>

<span class="in1"></span>*<span class="var">status</span>.<span class="var">codeNameEnd</span> = <span class="str">'\0'</span>;<br/>

<span class="in1"></span><span class="keyword">while</span> (<br/>

<span class="in2"></span><span class="var">status</span>.<span class="var">codeNameEnd</span> &gt;= <span class="var">status</span>.<span class="var">codeName</span><br/>

<span class="in2"></span>&amp;&amp; *<span class="var">status</span>.<span class="var">codeNameEnd</span> != <span class="str">'.'</span><br/>

<span class="in1"></span>) {<br/>

<span class="in2"></span>--<span class="var">status</span>.<span class="var">codeNameEnd</span>;<br/>

<span class="in1"></span>}<br/>

<span class="end">@end(<span class="name">handle html include</span>)</span><br/>

</code>
</div>

<ul><li>
 Bei der Behandlung von Includes wurde der Dateiname in <code>codeName</code>
  abgelegt
</li><li>
 Hier wird von hinten alles bis zum ersten Punkt abgeschnitten
</li><li>
 Also wird die Dateiextension aus dem Namen entfernt
</li></ul></div>

<div><div>
<code>

<span class="add">@add(<span class="name">handle html include</span>)</span><br/>

<span class="in1"></span><span class="fn">ASSERT</span>(<br/>

<span class="in2"></span><span class="var">status</span>.<span class="var">codeNameEnd</span> &gt;= <span class="var">status</span>.<span class="var">codeName</span>,<br/>

<span class="in2"></span><span class="str">"no period"</span><br/>

<span class="in1"></span>);<br/>

<span class="in1"></span>*<span class="var">status</span>.<span class="var">codeNameEnd</span> = <span class="str">'\0'</span>;<br/>

<span class="in1"></span><span class="fn">fprintf</span>(<span class="var">out</span>,<br/>

<span class="in2"></span><span class="str">"&lt;a href=\"%s.html\"&gt;"</span>,<br/>

<span class="in2"></span><span class="var">status</span>.<span class="var">codeName</span><br/>

<span class="in1"></span>);<br/>

<span class="in1"></span>*<span class="var">status</span>.<span class="var">codeNameEnd</span> = <span class="str">'.'</span>;<br/>

<span class="in1"></span><span class="fn">fprintf</span>(<span class="var">out</span>,<br/>

<span class="in2"></span><span class="str">"%s&lt;/a&gt;)&lt;/span&gt;"</span>, <span class="var">status</span>.<span class="var">codeName</span><br/>

<span class="in1"></span>);<br/>

<span class="in1"></span><span class="var">status</span>.<span class="var">codeNameEnd</span> = <span class="num">nullptr</span>;<br/>

<span class="end">@end(<span class="name">handle html include</span>)</span><br/>

</code>
</div>

<ul><li>
 Statt der ursprünglichen <code>.x</code>-Datei verweist der Link auf eine
  HTML-Datei
</li><li>
 Mit dem gleichen Basis-Namen
</li></ul></div>

<div><div>
<code>

<span class="add">@add(<span class="name">process ch in HTML code</span>)</span><br/>

<span class="in1"></span><span class="keyword">if</span> (<span class="var">ch</span> != <span class="num">EOF</span> &amp;&amp; <span class="var">status</span>.<span class="var">codeNameEnd</span>) {<br/>

<span class="in2"></span><span class="fn">ASSERT</span>(<br/>

<span class="in3"></span><span class="var">status</span>.<span class="var">codeNameEnd</span> &lt;<br/>

<span class="in4"></span><span class="var">status</span>.<span class="var">codeName</span> +<br/>

<span class="in5"></span><span class="fn">sizeof</span>(<span class="var">status</span>.<span class="var">codeName</span>),<br/>

<span class="in3"></span><span class="str">" [%c], [%.*s]"</span>, <span class="var">status</span>.<span class="var">codeSpecial</span>,<br/>

<span class="in3"></span>(<span class="type">int</span>) <span class="fn">sizeof</span>(<span class="var">status</span>.<span class="var">codeName</span>), <span class="var">status</span>.<span class="var">codeName</span><br/>

<span class="in2"></span>);<br/>

<span class="in2"></span>*<span class="var">status</span>.<span class="var">codeNameEnd</span>++ = <span class="var">ch</span>;<br/>

<span class="in2"></span><span class="keyword">continue</span>;<br/>

<span class="in1"></span>}<br/>

<span class="end">@end(<span class="name">process ch in HTML code</span>)</span><br/>

</code>
</div>

<ul><li>
 Wenn das Argument gespeichert werden soll (d.h. wenn <code>codeNameEnd</code>
  nicht <code>nullptr</code>)
</li><li>
 Wird das aktuelle Zeichen im <code>codeName</code> gespeichert
</li></ul></div>

<div><div>
<code>

<span class="add">@def(<span class="name">escape html frag</span>)</span><br/>

<span class="in1"></span><span class="keyword">case</span> <span class="str">'d'</span>:<br/>

<span class="in2"></span><span class="fn">fprintf</span>(<span class="var">out</span>,<br/>

<span class="in3"></span><span class="str">"&lt;span class=\"add\"&gt;@def("</span><br/>

<span class="in2"></span>);<br/>

<span class="in2"></span><span class="fn">fprintf</span>(<span class="var">out</span>,<br/>

<span class="in3"></span><span class="str">"&lt;span class=\"name\"&gt;"</span><br/>

<span class="in2"></span>);<br/>

<span class="in2"></span><span class="var">status</span>.<span class="var">codeSpecial</span> = <span class="var">lc</span>;<br/>

<span class="in2"></span><span class="var">status</span>.<span class="var">codeNameEnd</span> = <span class="var">status</span>.<span class="var">codeName</span>;<br/>

<span class="in2"></span><span class="keyword">break</span>;<br/>

<span class="end">@end(<span class="name">escape html frag</span>)</span><br/>

</code>
</div>


</div>
<div><div>
<code>

<span class="add">@add(<span class="name">escape html frag</span>)</span><br/>

<span class="in1"></span><span class="keyword">case</span> <span class="str">'D'</span>:<br/>

<span class="in2"></span><span class="fn">fprintf</span>(<span class="var">out</span>,<br/>

<span class="in3"></span><span class="str">"&lt;span class=\"add\"&gt;@globdef("</span><br/>

<span class="in2"></span>);<br/>

<span class="in2"></span><span class="fn">fprintf</span>(<span class="var">out</span>,<br/>

<span class="in3"></span><span class="str">"&lt;span class=\"name\"&gt;"</span><br/>

<span class="in2"></span>);<br/>

<span class="in2"></span><span class="var">status</span>.<span class="var">codeSpecial</span> = <span class="var">lc</span>;<br/>

<span class="in2"></span><span class="var">status</span>.<span class="var">codeNameEnd</span> = <span class="var">status</span>.<span class="var">codeName</span>;<br/>

<span class="in2"></span><span class="keyword">break</span>;<br/>

<span class="end">@end(<span class="name">escape html frag</span>)</span><br/>

</code>
</div>


</div>
<div><div>
<code>

<span class="add">@add(<span class="name">escape html frag</span>)</span><br/>

<span class="in1"></span><span class="keyword">case</span> <span class="str">'a'</span>:<br/>

<span class="in2"></span><span class="fn">fprintf</span>(<span class="var">out</span>,<br/>

<span class="in3"></span><span class="str">"&lt;span class=\"add\"&gt;@add("</span><br/>

<span class="in2"></span>);<br/>

<span class="in2"></span><span class="fn">fprintf</span>(<span class="var">out</span>,<br/>

<span class="in3"></span><span class="str">"&lt;span class=\"name\"&gt;"</span><br/>

<span class="in2"></span>);<br/>

<span class="in2"></span><span class="var">status</span>.<span class="var">codeSpecial</span> = <span class="var">lc</span>;<br/>

<span class="in2"></span><span class="var">status</span>.<span class="var">codeNameEnd</span> = <span class="var">status</span>.<span class="var">codeName</span>;<br/>

<span class="in2"></span><span class="keyword">break</span>;<br/>

<span class="end">@end(<span class="name">escape html frag</span>)</span><br/>

</code>
</div>


</div>
<div><div>
<code>

<span class="add">@add(<span class="name">escape html frag</span>)</span><br/>

<span class="in1"></span><span class="keyword">case</span> <span class="str">'A'</span>:<br/>

<span class="in2"></span><span class="fn">fprintf</span>(<span class="var">out</span>,<br/>

<span class="in3"></span><span class="str">"&lt;span class=\"add\"&gt;@globadd("</span><br/>

<span class="in2"></span>);<br/>

<span class="in2"></span><span class="fn">fprintf</span>(<span class="var">out</span>,<br/>

<span class="in3"></span><span class="str">"&lt;span class=\"name\"&gt;"</span><br/>

<span class="in2"></span>);<br/>

<span class="in2"></span><span class="var">status</span>.<span class="var">codeSpecial</span> = <span class="var">lc</span>;<br/>

<span class="in2"></span><span class="var">status</span>.<span class="var">codeNameEnd</span> = <span class="var">status</span>.<span class="var">codeName</span>;<br/>

<span class="in2"></span><span class="keyword">break</span>;<br/>

<span class="end">@end(<span class="name">escape html frag</span>)</span><br/>

</code>
</div>


</div>
<div><div>
<code>

<span class="add">@add(<span class="name">escape html frag</span>)</span><br/>

<span class="in1"></span><span class="keyword">case</span> <span class="str">'r'</span>:<br/>

<span class="in2"></span><span class="fn">fprintf</span>(<span class="var">out</span>,<br/>

<span class="in3"></span><span class="str">"&lt;span class=\"add\"&gt;@replace("</span><br/>

<span class="in2"></span>);<br/>

<span class="in2"></span><span class="fn">fprintf</span>(<span class="var">out</span>,<br/>

<span class="in3"></span><span class="str">"&lt;span class=\"name\"&gt;"</span><br/>

<span class="in2"></span>);<br/>

<span class="in2"></span><span class="var">status</span>.<span class="var">codeSpecial</span> = <span class="var">lc</span>;<br/>

<span class="in2"></span><span class="var">status</span>.<span class="var">codeNameEnd</span> = <span class="var">status</span>.<span class="var">codeName</span>;<br/>

<span class="in2"></span><span class="keyword">break</span>;<br/>

<span class="end">@end(<span class="name">escape html frag</span>)</span><br/>

</code>
</div>


</div>
<div><div>
<code>

<span class="add">@add(<span class="name">escape html frag</span>)</span><br/>

<span class="in1"></span><span class="keyword">case</span> <span class="str">'R'</span>:<br/>

<span class="in2"></span><span class="fn">fprintf</span>(<span class="var">out</span>,<br/>

<span class="in3"></span><span class="str">"&lt;span class=\"add\"&gt;@globreplace("</span><br/>

<span class="in2"></span>);<br/>

<span class="in2"></span><span class="fn">fprintf</span>(<span class="var">out</span>,<br/>

<span class="in3"></span><span class="str">"&lt;span class=\"name\"&gt;"</span><br/>

<span class="in2"></span>);<br/>

<span class="in2"></span><span class="var">status</span>.<span class="var">codeSpecial</span> = <span class="var">lc</span>;<br/>

<span class="in2"></span><span class="var">status</span>.<span class="var">codeNameEnd</span> = <span class="var">status</span>.<span class="var">codeName</span>;<br/>

<span class="in2"></span><span class="keyword">break</span>;<br/>

<span class="end">@end(<span class="name">escape html frag</span>)</span><br/>

</code>
</div>


</div>
<div><div>
<code>

<span class="add">@add(<span class="name">escape html frag</span>)</span><br/>

<span class="in1"></span><span class="keyword">case</span> <span class="str">'x'</span>:<br/>

<span class="in2"></span><span class="fn">fprintf</span>(<span class="var">out</span>,<br/>

<span class="in3"></span><span class="str">"&lt;span class=\"end\"&gt;@end("</span><br/>

<span class="in2"></span>);<br/>

<span class="in2"></span><span class="fn">fprintf</span>(<span class="var">out</span>,<br/>

<span class="in3"></span><span class="str">"&lt;span class=\"name\"&gt;"</span><br/>

<span class="in2"></span>);<br/>

<span class="in2"></span><span class="var">status</span>.<span class="var">codeSpecial</span> = <span class="var">lc</span>;<br/>

<span class="in2"></span><span class="var">status</span>.<span class="var">codeNameEnd</span> = <span class="var">status</span>.<span class="var">codeName</span>;<br/>

<span class="in2"></span><span class="keyword">break</span>;<br/>

<span class="end">@end(<span class="name">escape html frag</span>)</span><br/>

</code>
</div>


</div>
<div><div>
<code>

<span class="add">@add(<span class="name">escape html frag</span>)</span><br/>

<span class="in1"></span><span class="keyword">case</span> <span class="str">'e'</span>:<br/>

<span class="in2"></span><span class="fn">fprintf</span>(<span class="var">out</span>,<br/>

<span class="in3"></span><span class="str">"&lt;span class=\"expand\"&gt;@expand("</span><br/>

<span class="in2"></span>);<br/>

<span class="in2"></span><span class="fn">fprintf</span>(<span class="var">out</span>,<br/>

<span class="in3"></span><span class="str">"&lt;span class=\"name\"&gt;"</span><br/>

<span class="in2"></span>);<br/>

<span class="in2"></span><span class="var">status</span>.<span class="var">codeSpecial</span> = <span class="var">lc</span>;<br/>

<span class="in2"></span><span class="var">status</span>.<span class="var">codeNameEnd</span> = <span class="var">status</span>.<span class="var">codeName</span>;<br/>

<span class="in2"></span><span class="keyword">break</span>;<br/>

<span class="end">@end(<span class="name">escape html frag</span>)</span><br/>

</code>
</div>


</div>
<div><div>
<code>

<span class="add">@add(<span class="name">escape html frag</span>)</span><br/>

<span class="in1"></span><span class="keyword">case</span> <span class="str">'E'</span>:<br/>

<span class="in2"></span><span class="fn">fprintf</span>(<span class="var">out</span>,<br/>

<span class="in3"></span><span class="str">"&lt;span class=\"expand\"&gt;@multiple("</span><br/>

<span class="in2"></span>);<br/>

<span class="in2"></span><span class="fn">fprintf</span>(<span class="var">out</span>,<br/>

<span class="in3"></span><span class="str">"&lt;span class=\"name\"&gt;"</span><br/>

<span class="in2"></span>);<br/>

<span class="in2"></span><span class="var">status</span>.<span class="var">codeSpecial</span> = <span class="var">lc</span>;<br/>

<span class="in2"></span><span class="var">status</span>.<span class="var">codeNameEnd</span> = <span class="var">status</span>.<span class="var">codeName</span>;<br/>

<span class="in2"></span><span class="keyword">break</span>;<br/>

<span class="end">@end(<span class="name">escape html frag</span>)</span><br/>

</code>
</div>


</div>
<div><div>
<code>

<span class="add">@add(<span class="name">escape html frag</span>)</span><br/>

<span class="in1"></span><span class="keyword">case</span> <span class="str">'g'</span>:<br/>

<span class="in2"></span><span class="fn">fprintf</span>(<span class="var">out</span>,<br/>

<span class="in3"></span><span class="str">"&lt;span class=\"expand\"&gt;"</span><br/>

<span class="in4"></span><span class="str">"@globexpand("</span><br/>

<span class="in2"></span>);<br/>

<span class="in2"></span><span class="fn">fprintf</span>(<span class="var">out</span>,<br/>

<span class="in3"></span><span class="str">"&lt;span class=\"name\"&gt;"</span><br/>

<span class="in2"></span>);<br/>

<span class="in2"></span><span class="var">status</span>.<span class="var">codeSpecial</span> = <span class="var">lc</span>;<br/>

<span class="in2"></span><span class="var">status</span>.<span class="var">codeNameEnd</span> = <span class="var">status</span>.<span class="var">codeName</span>;<br/>

<span class="in2"></span><span class="keyword">break</span>;<br/>

<span class="end">@end(<span class="name">escape html frag</span>)</span><br/>

</code>
</div>


</div>
<div><div>
<code>

<span class="add">@add(<span class="name">escape html frag</span>)</span><br/>

<span class="in1"></span><span class="keyword">case</span> <span class="str">'G'</span>:<br/>

<span class="in2"></span><span class="fn">fprintf</span>(<span class="var">out</span>,<br/>

<span class="in3"></span><span class="str">"&lt;span class=\"expand\"&gt;"</span><br/>

<span class="in4"></span><span class="str">"@globmult("</span><br/>

<span class="in2"></span>);<br/>

<span class="in2"></span><span class="fn">fprintf</span>(<span class="var">out</span>,<br/>

<span class="in3"></span><span class="str">"&lt;span class=\"name\"&gt;"</span><br/>

<span class="in2"></span>);<br/>

<span class="in2"></span><span class="var">status</span>.<span class="var">codeSpecial</span> = <span class="var">lc</span>;<br/>

<span class="in2"></span><span class="var">status</span>.<span class="var">codeNameEnd</span> = <span class="var">status</span>.<span class="var">codeName</span>;<br/>

<span class="in2"></span><span class="keyword">break</span>;<br/>

<span class="end">@end(<span class="name">escape html frag</span>)</span><br/>

</code>
</div>


</div>
<div><div>
<code>

<span class="add">@add(<span class="name">escape html frag</span>)</span><br/>

<span class="in1"></span><span class="keyword">case</span> <span class="str">'i'</span>:<br/>

<span class="in2"></span><span class="fn">fprintf</span>(<span class="var">out</span>,<br/>

<span class="in3"></span><span class="str">"&lt;span class=\"include\"&gt;@include("</span><br/>

<span class="in2"></span>);<br/>

<span class="in2"></span><span class="fn">fprintf</span>(<span class="var">out</span>,<br/>

<span class="in3"></span><span class="str">"&lt;span class=\"name\"&gt;"</span><br/>

<span class="in2"></span>);<br/>

<span class="in2"></span><span class="var">status</span>.<span class="var">codeSpecial</span> = <span class="var">lc</span>;<br/>

<span class="in2"></span><span class="var">status</span>.<span class="var">codeNameEnd</span> = <span class="var">status</span>.<span class="var">codeName</span>;<br/>

<span class="in2"></span><span class="keyword">break</span>;<br/>

<span class="end">@end(<span class="name">escape html frag</span>)</span><br/>

</code>
</div>


</div>
<div><div>
<code>

<span class="add">@add(<span class="name">escape html frag</span>)</span><br/>

<span class="in1"></span><span class="keyword">case</span> <span class="str">'t'</span>:<br/>

<span class="in2"></span><span class="fn">fprintf</span>(<span class="var">out</span>, <span class="str">"&lt;span class=\"type\"&gt;"</span>);<br/>

<span class="in2"></span><span class="var">status</span>.<span class="var">codeSpecial</span> = <span class="var">lc</span>;<br/>

<span class="in2"></span><span class="var">status</span>.<span class="var">codeNameEnd</span> = <span class="var">status</span>.<span class="var">codeName</span>;<br/>

<span class="in2"></span><span class="keyword">break</span>;<br/>

<span class="end">@end(<span class="name">escape html frag</span>)</span><br/>

</code>
</div>


</div>
<div><div>
<code>

<span class="add">@add(<span class="name">escape html frag</span>)</span><br/>

<span class="in1"></span><span class="keyword">case</span> <span class="str">'v'</span>:<br/>

<span class="in2"></span><span class="fn">fprintf</span>(<span class="var">out</span>, <span class="str">"&lt;span class=\"var\"&gt;"</span>);<br/>

<span class="in2"></span><span class="var">status</span>.<span class="var">codeSpecial</span> = <span class="var">lc</span>;<br/>

<span class="in2"></span><span class="var">status</span>.<span class="var">codeNameEnd</span> = <span class="var">status</span>.<span class="var">codeName</span>;<br/>

<span class="in2"></span><span class="keyword">break</span>;<br/>

<span class="end">@end(<span class="name">escape html frag</span>)</span><br/>

</code>
</div>


</div>
<div><div>
<code>

<span class="add">@add(<span class="name">escape html frag</span>)</span><br/>

<span class="in1"></span><span class="keyword">case</span> <span class="str">'f'</span>:<br/>

<span class="in2"></span><span class="fn">fprintf</span>(<span class="var">out</span>, <span class="str">"&lt;span class=\"fn\"&gt;"</span>);<br/>

<span class="in2"></span><span class="var">status</span>.<span class="var">codeSpecial</span> = <span class="var">lc</span>;<br/>

<span class="in2"></span><span class="var">status</span>.<span class="var">codeNameEnd</span> = <span class="var">status</span>.<span class="var">codeName</span>;<br/>

<span class="in2"></span><span class="keyword">break</span>;<br/>

<span class="end">@end(<span class="name">escape html frag</span>)</span><br/>

</code>
</div>


</div>
<div><div>
<code>

<span class="add">@add(<span class="name">escape html frag</span>)</span><br/>

<span class="in1"></span><span class="keyword">case</span> <span class="str">'k'</span>:<br/>

<span class="in2"></span><span class="fn">fprintf</span>(<span class="var">out</span>, <span class="str">"&lt;span class=\"keyword\"&gt;"</span>);<br/>

<span class="in2"></span><span class="var">status</span>.<span class="var">codeSpecial</span> = <span class="var">lc</span>;<br/>

<span class="in2"></span><span class="var">status</span>.<span class="var">codeNameEnd</span> = <span class="var">status</span>.<span class="var">codeName</span>;<br/>

<span class="in2"></span><span class="keyword">break</span>;<br/>

<span class="end">@end(<span class="name">escape html frag</span>)</span><br/>

</code>
</div>


</div>
<div><div>
<code>

<span class="add">@add(<span class="name">escape html frag</span>)</span><br/>

<span class="in1"></span><span class="keyword">case</span> <span class="str">'s'</span>:<br/>

<span class="in2"></span><span class="fn">fprintf</span>(<span class="var">out</span>, <span class="str">"&lt;span class=\"str\"&gt;"</span>);<br/>

<span class="in2"></span><span class="var">status</span>.<span class="var">codeSpecial</span> = <span class="var">lc</span>;<br/>

<span class="in2"></span><span class="var">status</span>.<span class="var">codeNameEnd</span> = <span class="var">status</span>.<span class="var">codeName</span>;<br/>

<span class="in2"></span><span class="keyword">break</span>;<br/>

<span class="end">@end(<span class="name">escape html frag</span>)</span><br/>

</code>
</div>


</div>
<div><div>
<code>

<span class="add">@add(<span class="name">escape html frag</span>)</span><br/>

<span class="in1"></span><span class="keyword">case</span> <span class="str">'n'</span>:<br/>

<span class="in2"></span><span class="fn">fprintf</span>(<span class="var">out</span>, <span class="str">"&lt;span class=\"num\"&gt;"</span>);<br/>

<span class="in2"></span><span class="var">status</span>.<span class="var">codeSpecial</span> = <span class="var">lc</span>;<br/>

<span class="in2"></span><span class="var">status</span>.<span class="var">codeNameEnd</span> = <span class="var">status</span>.<span class="var">codeName</span>;<br/>

<span class="in2"></span><span class="keyword">break</span>;<br/>

<span class="end">@end(<span class="name">escape html frag</span>)</span><br/>

</code>
</div>


</div>
<div><div>
<code>

<span class="add">@add(<span class="name">escape html frag</span>)</span><br/>

<span class="in1"></span><span class="keyword">case</span> <span class="str">'p'</span>:<br/>

<span class="in2"></span><span class="fn">fprintf</span>(<span class="var">out</span>,<br/>

<span class="in3"></span><span class="str">"&lt;span class=\"type\"&gt;"</span><br/>

<span class="in4"></span><span class="str">"@priv(&lt;span&gt;"</span><br/>

<span class="in2"></span>);<br/>

<span class="in2"></span><span class="var">status</span>.<span class="var">codeSpecial</span> = <span class="var">lc</span>;<br/>

<span class="in2"></span><span class="var">status</span>.<span class="var">codeNameEnd</span> = <span class="var">status</span>.<span class="var">codeName</span>;<br/>

<span class="in2"></span><span class="keyword">break</span>;<br/>

<span class="end">@end(<span class="name">escape html frag</span>)</span><br/>

</code>
</div>


</div>
<div><div>
<code>

<span class="add">@add(<span class="name">escape html frag</span>)</span><br/>

<span class="in1"></span><span class="keyword">case</span> <span class="str">'m'</span>:<br/>

<span class="in2"></span><span class="fn">fprintf</span>(<br/>

<span class="in3"></span><span class="var">out</span>,<br/>

<span class="in3"></span><span class="str">"&lt;span class=\"num\"&gt;"</span><br/>

<span class="in4"></span><span class="str">"@magic(&lt;span&gt;"</span><br/>

<span class="in2"></span>);<br/>

<span class="in2"></span><span class="var">status</span>.<span class="var">codeSpecial</span> = <span class="var">lc</span>;<br/>

<span class="in2"></span><span class="var">status</span>.<span class="var">codeNameEnd</span> = <span class="var">status</span>.<span class="var">codeName</span>;<br/>

<span class="in2"></span><span class="keyword">break</span>;<br/>

<span class="end">@end(<span class="name">escape html frag</span>)</span><br/>

</code>
</div>

<ul><li>
 <code>@magic</code>-Befehle werden als Zahlen formatiert
</li></ul></div>

<div><div>
<code>

<span class="add">@add(<span class="name">escape html frag</span>)</span><br/>

<span class="in1"></span><span class="keyword">case</span> <span class="str">'b'</span>:<br/>

<span class="in2"></span><span class="fn">fprintf</span>(<span class="var">out</span>, <span class="str">"&lt;span class=\"virt\"&gt;&lt;/span&gt;&lt;br/&gt;"</span>);<br/>

<span class="in2"></span><span class="var">status</span>.<span class="var">codeSpecial</span> = <span class="var">lc</span>;<br/>

<span class="in2"></span><span class="var">status</span>.<span class="var">codeNameEnd</span> = <span class="var">status</span>.<span class="var">codeName</span>;<br/>

<span class="in2"></span><span class="keyword">break</span>;<br/>

<span class="end">@end(<span class="name">escape html frag</span>)</span><br/>

</code>
</div>

<ul><li>
 <code>@magic</code>-Befehle werden als Zahlen formatiert
</li></ul></div>

</div>
<h1>Notizen</h1>
<div class="slides">
<div><div>
<h1>Notizen</h1>
</div>


</div>
<div><div>
<code>

<span class="add">@add(<span class="name">html state elements</span>)</span><br/>

<span class="in1"></span><span class="type">bool</span> <span class="var">noteInCode</span>;<br/>

<span class="in1"></span><span class="type">bool</span> <span class="var">noteInBold</span>;<br/>

<span class="end">@end(<span class="name">html state elements</span>)</span><br/>

</code>
</div>


</div>
<div><div>
<code>

<span class="add">@add(<span class="name">init html status</span>)</span><br/>

<span class="in1"></span>, <span class="fn">noteInCode</span>(<span class="num">false</span>)<br/>

<span class="in1"></span>, <span class="fn">noteInBold</span>(<span class="num">false</span>)<br/>

<span class="end">@end(<span class="name">init html status</span>)</span><br/>

</code>
</div>


</div>
<div><div>
<code>

<span class="add">@add(<span class="name">html state enums</span>)</span><br/>

<span class="in1"></span>, <span class="var">inNotes</span><br/>

<span class="end">@end(<span class="name">html state enums</span>)</span><br/>

</code>
</div>


</div>
<div><div>
<code>

<span class="add">@add(<span class="name">check html special state</span>)</span><br/>

<span class="in1"></span><span class="keyword">if</span> (<span class="var">s</span>-&gt;<span class="var">state</span> == <span class="type">HtmlState</span>::<span class="var">inNotes</span>) {<br/>

<span class="in2"></span><span class="keyword">return</span> <span class="num">false</span>;<br/>

<span class="in1"></span>}<br/>

<span class="end">@end(<span class="name">check html special state</span>)</span><br/>

</code>
</div>


</div>
<div><div>
<code>

<span class="add">@add(<span class="name">process ch for HTML</span>)</span> <br/>

<span class="in1"></span><span class="keyword">if</span> (<br/>

<span class="in2"></span><span class="var">newline</span> &amp;&amp;<br/>

<span class="in2"></span><span class="var">status</span>.<span class="var">state</span> == <span class="type">HtmlState</span>::<span class="var">inNotes</span><br/>

<span class="in1"></span>) {<br/>

<span class="in2"></span><span class="keyword">if</span> (<span class="var">ch</span> == <span class="str">'*'</span>) {<br/>

<span class="in3"></span><span class="fn">fprintf</span>(<span class="var">out</span>, <span class="str">"&lt;/li&gt;&lt;li&gt;\n"</span>);<br/>

<span class="in3"></span><span class="var">ident</span>.<span class="fn">clear</span>();<br/>

<span class="in3"></span><span class="var">newline</span> = <span class="num">false</span>;<br/>

<span class="in3"></span><span class="keyword">continue</span>;<br/>

<span class="in2"></span>} <span class="keyword">else</span> <span class="keyword">if</span> (<span class="var">ch</span> != <span class="str">' '</span> &amp;&amp; <span class="var">ch</span> != <span class="str">'\t'</span>) {<br/>

<span class="in3"></span><span class="fn">fprintf</span>(<span class="var">out</span>, <span class="str">"&lt;/li&gt;&lt;/ul&gt;&lt;/div&gt;\n"</span>);<br/>

<span class="in3"></span><span class="var">status</span>.<span class="var">state</span> = <span class="type">HtmlState</span>::<span class="var">afterSlide</span>;<br/>

<span class="in3"></span><span class="expand">@multiple(<span class="name">move ch to last</span>)</span>;<br/>

<span class="in3"></span><span class="keyword">continue</span>;<br/>

<span class="in2"></span>}<br/>

<span class="in1"></span>}<br/>

<span class="end">@end(<span class="name">process ch for HTML</span>)</span><br/>

</code>
</div>


</div>
<div><div>
<code>

<span class="add">@add(<span class="name">process ch for HTML</span>)</span> <br/>

<span class="in1"></span><span class="keyword">if</span> (<span class="var">newline</span> &amp;&amp; <span class="var">ch</span> == <span class="str">'*'</span>) {<br/>

<span class="in2"></span><span class="keyword">if</span> (<span class="fn">isOutOfHtmlSpecial</span>(&amp;<span class="var">status</span>)) {<br/>

<span class="in3"></span><span class="keyword">if</span> (<span class="var">status</span>.<span class="var">state</span> != <span class="type">HtmlState</span>::<span class="var">inSlide</span>) {<br/>

<span class="in4"></span><span class="fn">fprintf</span>(<span class="var">out</span>, <span class="str">"&lt;div&gt;\n"</span>);<br/>

<span class="in3"></span>}<br/>

<span class="in3"></span><span class="var">status</span>.<span class="var">state</span> = <span class="type">HtmlState</span>::<span class="var">inNotes</span>;<br/>

<span class="in3"></span><span class="fn">fprintf</span>(<span class="var">out</span>, <span class="str">"&lt;ul&gt;&lt;li&gt;\n"</span>);<br/>

<span class="in3"></span><span class="var">ident</span>.<span class="fn">clear</span>();<br/>

<span class="in3"></span><span class="var">newline</span> = <span class="num">false</span>;<br/>

<span class="in3"></span><span class="keyword">continue</span>;<br/>

<span class="in2"></span>}<br/>

<span class="in1"></span>}<br/>

<span class="end">@end(<span class="name">process ch for HTML</span>)</span><br/>

</code>
</div>


</div>
<div><div>
<code>

<span class="add">@add(<span class="name">process ch for HTML</span>)</span> <br/>

<span class="in1"></span><span class="keyword">if</span> (<br/>

<span class="in2"></span><span class="var">ch</span> == <span class="str">'`'</span> &amp;&amp;<br/>

<span class="in2"></span><span class="var">status</span>.<span class="var">state</span> == <span class="type">HtmlState</span>::<span class="var">inNotes</span><br/>

<span class="in1"></span>) {<br/>

<span class="in2"></span><span class="expand">@multiple(<span class="name">flush pending</span>)</span>;<br/>

<span class="in2"></span><span class="keyword">if</span> (<span class="var">status</span>.<span class="var">noteInCode</span>) {<br/>

<span class="in3"></span><span class="fn">fprintf</span>(<span class="var">out</span>, <span class="str">"&lt;/code&gt;"</span>);<br/>

<span class="in2"></span>} <span class="keyword">else</span> {<br/>

<span class="in3"></span><span class="fn">fprintf</span>(<span class="var">out</span>, <span class="str">"&lt;code&gt;"</span>);<br/>

<span class="in2"></span>}<br/>

<span class="in2"></span><span class="var">status</span>.<span class="var">noteInCode</span> = ! <span class="var">status</span>.<span class="var">noteInCode</span>;<br/>

<span class="in2"></span><span class="var">ident</span>.<span class="fn">clear</span>();<br/>

<span class="in2"></span><span class="var">newline</span> = <span class="num">false</span>;<br/>

<span class="in2"></span><span class="keyword">continue</span>;<br/>

<span class="in1"></span>}<br/>

<span class="end">@end(<span class="name">process ch for HTML</span>)</span><br/>

</code>
</div>


</div>
<div><div>
<code>

<span class="add">@add(<span class="name">process ch for HTML</span>)</span> <br/>

<span class="in1"></span><span class="keyword">if</span> (<span class="var">status</span>.<span class="var">state</span> == <span class="type">HtmlState</span>::<span class="var">inNotes</span> &amp;&amp;<br/>

<span class="in1"></span><span class="var">status</span>.<span class="var">noteInCode</span>) {<br/>

<span class="in2"></span><span class="expand">@multiple(<span class="name">escape HTML code tag</span>)</span>;<br/>

<span class="in1"></span>}<br/>

<span class="end">@end(<span class="name">process ch for HTML</span>)</span><br/>

</code>
</div>


</div>
<div><div>
<code>

<span class="add">@add(<span class="name">process ch for HTML</span>)</span> <br/>

<span class="in1"></span><span class="keyword">if</span> (<br/>

<span class="in2"></span><span class="num">false</span> &amp;&amp;<br/>

<span class="in2"></span><span class="var">ch</span> == <span class="str">'*'</span> &amp;&amp; /*<span class="var">last</span> == <span class="str">'*'</span> &amp;&amp; */<br/>

<span class="in2"></span><span class="var">status</span>.<span class="var">state</span> == <span class="type">HtmlState</span>::<span class="var">inNotes</span><br/>

<span class="in1"></span>) {<br/>

<span class="in2"></span><span class="keyword">if</span> (<span class="var">status</span>.<span class="var">noteInBold</span>) {<br/>

<span class="in3"></span><span class="fn">fprintf</span>(<span class="var">out</span>, <span class="str">"&lt;/b&gt;"</span>);<br/>

<span class="in2"></span>} <span class="keyword">else</span> {<br/>

<span class="in3"></span><span class="fn">fprintf</span>(<span class="var">out</span>, <span class="str">"&lt;b&gt;"</span>);<br/>

<span class="in2"></span>}<br/>

<span class="in2"></span><span class="var">status</span>.<span class="var">noteInBold</span> =<br/>

<span class="in3"></span>! <span class="var">status</span>.<span class="var">noteInBold</span>;<br/>

<span class="in2"></span><span class="var">newline</span> = <span class="num">false</span>;<br/>

<span class="in2"></span><span class="keyword">continue</span>;<br/>

<span class="in1"></span>}<br/>

<span class="end">@end(<span class="name">process ch for HTML</span>)</span><br/>

</code>
</div>


</div>
<div><div>
<code>

<span class="add">@add(<span class="name">process ch for HTML</span>)</span> <br/>

<span class="in1"></span><span class="keyword">if</span> (<span class="var">status</span>.<span class="var">state</span> == <span class="type">HtmlState</span>::<span class="var">inNotes</span>) {<br/>

<span class="in2"></span><span class="expand">@multiple(<span class="name">flush pending</span>)</span>;<br/>

<span class="in2"></span><span class="expand">@multiple(<span class="name">move ch to last</span>)</span>;<br/>

<span class="in2"></span><span class="keyword">continue</span>;<br/>

<span class="in1"></span>}<br/>

<span class="end">@end(<span class="name">process ch for HTML</span>)</span><br/>

</code>
</div>

