<!doctype html>
<html lang="de"l>
<head>
<meta charset="utf-8">
<title>HTML Extractor</title>
<link rel="stylesheet" type="text/css" href="slides/slides.css"></head>
<body>
<h1>HTML Extractor</h1>
<div class="slides">
<div><div>
<h1>HTML Extractor</h1>
</div>
</div>
</div>
<h2>Funktionsweise von `hx`</h2>
<div class="slides">
<div><div>
<h2>Funktionsweise von `hx`</h2>
</div>
</div>
</div>
<h2>Slideware Programming (SWP)</h2>
<div class="slides">
<div><div>
<h2>Slideware Programming (SWP)</h2>
</div>
</div>
</div>
<h2>SWP ≠ Literate Programming</h2>
<div class="slides">
<div><div>
<h2>SWP ≠ Literate Programming</h2>
</div>
</div>
</div>
<h1>Definition des Ablaufs</h1>
<div class="slides">
<div><div>
<h1>Definition des Ablaufs</h1>
</div>
</div><div><div>
<code>
a{file: hx.c}<br/>
<span class="in1"></span>e{global elements}<br/>
<span class="in1"></span>t{int} f{main}(<br/>
<span class="in2"></span>t{int} v{argc}, t{const char **}v{argv}<br/>
<span class="in1"></span>) {<br/>
<span class="in2"></span>e{main body}<br/>
<span class="in1"></span>}<br/>
x{file: hx.c}<br/>
</code></div>
</div><div><div>
<code>
a{main body}<br/>
<span class="in1"></span>e{perform unit-tests};<br/>
<span class="in1"></span>e{process arguments};<br/>
<span class="in1"></span>e{read source file};<br/>
<span class="in1"></span>e{serialize fragments};<br/>
<span class="in1"></span>e{compile program};<br/>
<span class="in1"></span>e{write HTML file};<br/>
x{main body}<br/>
</code></div>
</div>
</div>
<h2>Was macht `@expand`?</h2>
<div class="slides">
<div><div>
<h2>Was macht `@expand`?</h2>
</div>
</div><div><div>
<code>
a{global elements}<br/>
<span class="in1"></span>e{includes};<br/>
<span class="in1"></span>e{define logging};<br/>
<span class="in1"></span>e{forward declarations};<br/>
x{global elements}<br/>
</code></div>
</div>
</div>
<h1>Minimale Vorbereitung für das Parsen</h1>
<div class="slides">
<div><div>
<h1>Minimale Vorbereitung für das Parsen</h1>
</div>
</div><div><div>
<code>
a{includes}<br/>
<span class="in1"></span>#include <stdio.h><br/>
<span class="in1"></span>#include <stdlib.h><br/>
x{includes}<br/>
</code></div>
</div>
</div>
<h2>include &lt;stdio.h&gt;include &lt;stdlib.h&gt;x{includes}* Standard File-Funktionen werden vom Programm benötigt</h2>
<div class="slides">
<div><div>
<h2>include &lt;stdio.h&gt;include &lt;stdlib.h&gt;x{includes}* Standard File-Funktionen werden vom Programm benötigt</h2>
</div>
</div><div><div>
<code>
a{global elements}<br/>
<span class="in1"></span>t{struct Input} {<br/>
<span class="in2"></span>t{struct Input *}v{link};<br/>
<span class="in2"></span>t{FILE *}v{file};<br/>
<span class="in1"></span>};<br/>
<br/>
<span class="in1"></span>t{struct Input *}v{input} = k{NULL};b{}<br/>
x{global elements}<br/>
</code></div>
</div><div><div>
<code>
a{global elements}b{}<br/>
<span class="in1"></span>t{void} f{pushFile} (t{FILE *}v{file}) {<br/>
<span class="in2"></span>t{struct Input *}v{i} =<br/>
<span class="in3"></span>f{malloc}(f{sizeof}(t{struct Input}));<br/>
<br/>
<span class="in2"></span>e{check memory for input};<br/>
<span class="in2"></span>v{i}->v{link} = v{input};<br/>
<span class="in2"></span>v{i}->v{file} = v{file};<br/>
<span class="in2"></span>v{input} = v{i};<br/>
<span class="in1"></span>}<br/>
x{global elements}<br/>
</code></div>
</div><div><div>
<code>
a{global elements}b{}<br/>
<span class="in1"></span>t{void} f{pushPath}(t{const char *}v{path}) {<br/>
<span class="in2"></span>t{FILE *}v{f} = f{fopen}(v{path}, s{"r"});<br/>
<span class="in2"></span>e{check file for path};<br/>
<span class="in2"></span>f{pushFile}(v{f});<br/>
<span class="in1"></span>}b{}<br/>
x{global elements}<br/>
</code></div>
</div><div><div>
<code>
a{process arguments}b{}<br/>
<span class="in1"></span>k{if}(v{argc} > n{1}) {<br/>
<span class="in2"></span>f{pushPath}(v{argv}[n{1}]);<br/>
<span class="in1"></span>} k{else} {<br/>
<span class="in2"></span>f{pushFile}(v{stdin});<br/>
<span class="in1"></span>}<br/>
x{process arguments}<br/>
</code></div>
</div><div><div>
<code>
a{global elements}<br/>
<span class="in1"></span>t{int} f{nextCh}() {<br/>
<span class="in2"></span>t{int} v{ch} = k{EOF};<br/>
<span class="in2"></span>k{while} (v{input}) {<br/>
<span class="in3"></span>v{ch} = f{fgetc}(v{input}->v{file});<br/>
<span class="in3"></span>k{if} (v{ch} != k{EOF}) { k{break}; }<br/>
<span class="in3"></span>t{struct Input *}v{n} = v{input}->v{link};<br/>
<span class="in3"></span>f{fclose}(v{input}->v{file});<br/>
<span class="in3"></span>f{free}(v{input});<br/>
<span class="in3"></span>v{input} = v{n};<br/>
<span class="in2"></span>}<br/>
<span class="in2"></span>k{return} v{ch};<br/>
<span class="in1"></span>}<br/>
x{global elements}<br/>
</code></div>
</div>
</div>
<h1>Buffer</h1>
<div class="slides">
<div><div>
<h1>Buffer</h1>
</div>
</div><div><div>
<code>
i{buffer.xml}<br/>
</code></div>
</div>
</div>
<h1>Consumer</h1>
<div class="slides">
<div><div>
<h1>Consumer</h1>
</div>
</div><div><div>
<code>
i{consumer.xml}<br/>
</code></div>
</div>
</div>
<h1>Makros</h1>
<div class="slides">
<div><div>
<h1>Makros</h1>
</div>
</div><div><div>
<code>
i{macros.xml}<br/>
</code></div>
</div>
</div>
<h1>Eingabe-Dateien lesen</h1>
<div class="slides">
<div><div>
<h1>Eingabe-Dateien lesen</h1>
</div>
</div><div><div>
<code>
a{read source file}b{}<br/>
<span class="in1"></span>e{global source vars};<br/>
<span class="in1"></span>{<br/>
<span class="in2"></span>e{additional read vars};<br/>
<span class="in2"></span>t{int} v{last} = f{nextCh}();<br/>
<span class="in2"></span>t{int} v{ch} = f{nextCh}();<br/>
<span class="in2"></span>k{while} (v{ch} != v{EOF}) {<br/>
<span class="in3"></span>e{process current char};<br/>
<span class="in3"></span>v{last} = v{ch}; v{ch} = f{nextCh}();<br/>
<span class="in2"></span>}<br/>
<span class="in1"></span>}<br/>
x{read source file}<br/>
</code></div>
</div><div><div>
<code>
a{process current char}<br/>
<span class="in1"></span>k{switch} (v{ch}) {<br/>
<span class="in2"></span>k{case} '{':<br/>
<span class="in3"></span>e{process open brace};<br/>
<span class="in3"></span>k{break};<br/>
<span class="in2"></span>k{case} '}': {<br/>
<span class="in3"></span>t{bool} v{processed} = k{false};<br/>
<span class="in3"></span>e{process close brace};<br/>
<span class="in3"></span>k{break};<br/>
<span class="in2"></span>}<br/>
<span class="in2"></span>k{default}:<br/>
<span class="in3"></span>e{process other char};<br/>
<span class="in1"></span>}<br/>
x{process current char}<br/>
</code></div>
</div><div><div>
<code>
a{additional read vars}<br/>
<span class="in1"></span>t{struct Macro *} v{macro} = k{NULL};<br/>
<span class="in1"></span>t{struct Buffer} v{buffer} = {};<br/>
x{additional read vars}<br/>
</code></div>
</div><div><div>
<code>
a{additional read vars}<br/>
<span class="in1"></span>t{char} v{openCh} = s{'\0'};<br/>
x{additional read vars}<br/>
</code></div>
</div><div><div>
<code>
a{additional read vars}b{}<br/>
<span class="in1"></span>t{char} v{name}t{[128]};<br/>
<span class="in1"></span>t{char *}v{nameCur} = k{NULL};<span class="in1"></span><br/>
<span class="in1"></span>t{const char *}v{nameEnd} = v{name} +<br/>
<span class="in2"></span>k{sizeof}(v{name});<br/>
x{additional read vars}<br/>
</code></div>
</div><div><div>
<code>
a{process close brace} {<br/>
<span class="in1"></span>k{if} (v{nameCur}) {<br/>
<span class="in2"></span>*v{nameCur} = s{'\0'};<br/>
<span class="in2"></span>e{process macro name};<br/>
<span class="in2"></span>v{nameCur} = k{NULL};<br/>
<span class="in2"></span>v{last} = v{ch};<br/>
<span class="in2"></span>v{ch} = f{nextCh}();<br/>
<span class="in1"></span>}<br/>
} x{process close brace}<br/>
</code></div>
</div><div><div>
<code>
a{process other char} {<br/>
<span class="in1"></span>k{if} (v{nameCur}) {<br/>
<span class="in2"></span>f{ASSERT}(v{nameCur} < v{nameEnd});<br/>
<span class="in2"></span>*v{nameCur}++ = v{ch};<br/>
<span class="in2"></span>k{break};<br/>
<span class="in1"></span>}b{}<br/>
} x{process other char}<br/>
</code></div>
</div><div><div>
<code>
a{process other char} {<br/>
<span class="in1"></span>k{if} (v{macro}) {<br/>
<span class="in2"></span>f{addToBuffer}(&v{buffer}, v{last});<br/>
<span class="in1"></span>}<br/>
} x{process other char}<br/>
</code></div>
</div><div><div>
<code>
a{process open brace} {<br/>
<span class="in1"></span>k{if} (! v{macro}) {<br/>
<span class="in2"></span>k{if} (v{last} == s{'a'} || v{last} == s{'i'}) {<br/>
<span class="in3"></span>v{openCh} = v{last};<br/>
<span class="in3"></span>v{nameCur} = v{name};<br/>
<span class="in3"></span>k{break};<br/>
<span class="in2"></span>}<br/>
<span class="in1"></span>}<br/>
} x{process open brace}<br/>
</code></div>
</div><div><div>
<code>
a{global source vars}<br/>
<span class="in1"></span>t{struct MacroMap} v{macros} = {};<br/>
x{global source vars}<br/>
</code></div>
</div><div><div>
<code>
a{process macro name}<br/>
<span class="in1"></span>k{if} (v{openCh} == s{'a'}) {<br/>
<span class="in2"></span>f{ASSERT}(! v{macro});<br/>
<span class="in2"></span>v{macro} = f{getMacroInMap}(<br/>
<span class="in3"></span>&v{macros}, v{name}, v{nameCur}<br/>
<span class="in2"></span>);<br/>
<span class="in2"></span>v{processed} = k{true};<br/>
<span class="in1"></span>}b{}<br/>
x{process macro name}<br/>
</code></div>
</div><div><div>
<code>
a{process macro name}<br/>
<span class="in1"></span>k{if} (v{openCh} == s{'x'}) {<br/>
<span class="in2"></span>f{ASSERT}(v{macro});<br/>
<span class="in2"></span>e{macro names must match};<br/>
<span class="in2"></span>e{flush macro buffer};<br/>
<span class="in2"></span>v{macro} = k{NULL};<br/>
<span class="in2"></span>v{processed} = k{true};<br/>
<span class="in1"></span>}<br/>
x{process macro name}<br/>
</code></div>
</div><div><div>
<code>
a{process macro name}<br/>
<span class="in1"></span>k{if} (v{openCh} == s{'i'}) {<br/>
<span class="in2"></span>f{ASSERT}(! v{macro});<br/>
<span class="in2"></span>f{pushPath}(v{name});<br/>
<span class="in2"></span>v{processed} = k{true};<br/>
<span class="in1"></span>}<br/>
x{process macro name}<br/>
</code></div>
</div><div><div>
<code>
a{process macro name}<br/>
<span class="in1"></span>k{if} (v{openCh} == s{'e'}) {<br/>
<span class="in2"></span>f{ASSERT}(v{macro});<br/>
<span class="in2"></span>e{flush macro buffer};<br/>
<span class="in2"></span>t{struct Macro *}v{sub} =<br/>
<span class="in3"></span>f{getMacroInMap}(<br/>
<span class="in4"></span>&v{macros}, v{name}, v{nameCur});<br/>
<span class="in2"></span>f{addMacroToMacro}(<br/>
<span class="in3"></span>v{macro}, v{sub});<br/>
<span class="in2"></span>v{processed} = k{true};<br/>
<span class="in1"></span>}<br/>
x{process macro name}<br/>
</code></div>
</div><div><div>
<code>
a{flush macro buffer}<br/>
<span class="in1"></span>k{if} (<br/>
<span class="in2"></span>v{buffer}.v{buffer} != v{buffer}.v{current}<br/>
<span class="in1"></span>) {<br/>
<span class="in2"></span>f{addBytesToMacro}(<br/>
<span class="in3"></span>v{macro}, v{buffer}.v{buffer},<br/>
<span class="in3"></span>v{buffer}.v{current}<br/>
<span class="in2"></span>);<br/>
<span class="in2"></span>f{resetBuffer}(&v{buffer});<br/>
<span class="in1"></span>}<br/>
x{flush macro buffer}<br/>
</code></div>
</div><div><div>
<code>
a{process open brace} {b{}<br/>
<span class="in1"></span>k{if} (v{macro}) {b{}<br/>
<span class="in2"></span>t{bool} v{valid} = k{false};b{}<br/>
<span class="in2"></span>e{check valid names};b{}<br/>
<span class="in2"></span>k{if} (v{valid}) {b{}<br/>
<span class="in3"></span>v{openCh} = v{last};b{}<br/>
<span class="in3"></span>v{nameCur} = v{name};b{}<br/>
<span class="in3"></span>k{break};b{}<br/>
<span class="in2"></span>}b{}<br/>
<span class="in1"></span>}b{}<br/>
} x{process open brace}<br/>
</code></div>
</div><div><div>
<code>
a{check valid names}<br/>
<span class="in1"></span>k{static} t{const char} v{valids}[] =<br/>
<span class="in2"></span>s{"123456bfvsntkxe"};<br/>
<span class="in1"></span>k{if} (f{strchr}(v{valids}, v{last})) {<br/>
<span class="in2"></span>v{valid} = k{true};<br/>
<span class="in1"></span>}b{}<br/>
x{check valid names}<br/>
</code></div>
</div><div><div>
<code>
a{process macro name}<br/>
<span class="in1"></span>k{if} (! v{processed}) {<br/>
<span class="in2"></span>f{ASSERT}(v{macro});<br/>
<span class="in2"></span>t{const char *}v{c} = v{name};<br/>
<span class="in2"></span>k{for} (; v{c} != v{nameCur}; ++v{c}) {<br/>
<span class="in3"></span>f{addToBuffer}(&v{buffer}, *v{c});<br/>
<span class="in2"></span>}<br/>
<span class="in2"></span>v{processed} = k{true};<br/>
<span class="in1"></span>}<br/>
x{process macro name}<br/>
</code></div>
</div><div><div>
<code>
a{process open brace}<br/>
<span class="in1"></span>k{if} (v{macro}) {<br/>
<span class="in2"></span>f{addToBuffer}(&v{buffer}, v{last});<br/>
<span class="in1"></span>}b{}<br/>
x{process open brace}<br/>
<br/>
a{process close brace}<br/>
<span class="in1"></span>k{if} (v{macro} && ! v{processed}) {<br/>
<span class="in2"></span>f{addToBuffer}(&v{buffer}, v{last});<br/>
<span class="in1"></span>}<br/>
x{process close brace}<br/>
</code></div>
</div>
</div>
<h1>Entities auflösen</h1>
<div class="slides">
<div><div>
<h1>Entities auflösen</h1>
</div>
</div><div><div>
<code>
i{entities.xml}<br/>
</code></div>
</div>
</div>
<h1>Fragmente serialisieren</h1>
<div class="slides">
<div><div>
<h1>Fragmente serialisieren</h1>
</div>
</div><div><div>
<code>
a{serialize fragments} {<br/>
<span class="in1"></span>t{struct Macro **}v{cur} = v{macros}.v{macros};<br/>
<span class="in1"></span>t{struct Macro **}v{end} =<br/>
<span class="in2"></span>v{cur} + v{MACRO_SLOTS};<br/>
<span class="in1"></span>k{for} (; v{cur} < v{end}; ++v{cur}) {<br/>
<span class="in2"></span>t{struct Macro *}v{macro} = *v{cur};<br/>
<span class="in2"></span>k{for} (; v{macro}; v{macro} = v{macro}->v{link}) {<br/>
<span class="in3"></span>k{if} (! f{memcmp}(<br/>
<span class="in4"></span>s{"file: "}, macro->name, n{6}<br/>
<span class="in3"></span>)) {<br/>
<span class="in4"></span>e{write in file};<br/>
<span class="in3"></span>}<br/>
<span class="in2"></span>}<br/>
<span class="in1"></span>}<br/>
} x{serialize fragments}<br/>
</code></div>
</div><div><div>
<code>
a{write in file}b{}<br/>
<span class="in1"></span>t{FILE *}v{f} = f{fopen}(v{macro}->v{name} + n{6}, "w");<br/>
<span class="in1"></span>f{ASSERT}(v{f});<br/>
<span class="in1"></span>t{struct FileConsumer} v{fc};<br/>
<span class="in1"></span>f{setupFileConsumer}(&v{fc}, v{f});<br/>
<span class="in1"></span>t{struct EntityConsumer} v{ec};<br/>
<span class="in1"></span>f{setupEntityConsumer}(&v{ec}, &v{fc}.v{consumer});<br/>
<span class="in1"></span>f{serializeMacro}(<br/>
<span class="in2"></span>v{macro}, &v{ec}.v{consumer}<br/>
<span class="in1"></span>);<br/>
<span class="in1"></span>f{fclose}(v{f});<br/>
x{write in file}<br/>
</code></div>
</div>
</div>
<h1>HTML generieren</h1>
<div class="slides">
<div><div>
<h1>HTML generieren</h1>
</div>
</div><div><div>
<code>
i{html.xml}<br/>
</code></div>
</div>
</div>
</body></html>
